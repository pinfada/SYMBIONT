(()=>{"use strict";var e={11:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unsafeStringify=void 0;const r=n(746),s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));function i(e,t=0){return(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase()}t.unsafeStringify=i,t.default=function(e,t=0){const n=i(e,t);if(!(0,r.default)(n))throw TypeError("Stringified UUID is invalid");return n}},82:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MurmureService=void 0;const n={loop:["Encore ce même chemin... Qu'y cherches-tu ?","La boucle se répète, intention ou habitude ?","Revenir, encore et encore. Un besoin de repère ?"],idle:["Un temps de pause... ou d'hésitation ?","Le silence aussi fait partie du voyage.","L'inactivité, prélude à une nouvelle exploration ?"],exploration:["Nouveau territoire, nouvelle perspective.","L'exploration nourrit la curiosité.","Tu t'aventures hors des sentiers battus."],routine:["Les habitudes forgent des chemins familiers.","La routine rassure, mais l'inattendu surprend.","Encore ce site, comme un rituel quotidien."],default:["Tu reviens souvent ici quand tu doutes.","Pourquoi cette boucle ?","As-tu remarqué ce schéma dans ta navigation ?","Un autre détour, ou une quête de sens ?","Ce site semble t'attirer dans les moments de réflexion.","Encore une fois, tu explores ce chemin familier.","Et si tu essayais une nouvelle direction ?","La répétition cache-t-elle une intention ?","Un murmure dans le flux de tes habitudes...","Parfois, la boucle est une porte vers l'inattendu."]},r={morning:["Un nouveau jour, une nouvelle boucle commence.","Le matin invite à la découverte.","L'aube de tes habitudes numériques."],afternoon:["L'après-midi, la routine s'installe.","Un moment propice à l'exploration ou à la répétition ?","Le soleil haut, l'esprit vagabonde."],evening:["Le soir, tu reviens à l'essentiel.","La nuit favorise les détours intérieurs.","Encore connecté, même à la tombée du jour."],weekend:["Le week-end, les chemins changent.","Un rythme différent, des envies nouvelles.","La liberté du week-end se lit dans ta navigation."]};t.MurmureService=class{generateMurmur(e){if(function(){const e=(new Date).getDay();return 0===e||6===e}()){const e=r.weekend;if(Math.random()<.5)return e[Math.floor(Math.random()*e.length)]}else{const e=function(){const e=(new Date).getHours();return e<12?"morning":e<18?"afternoon":"evening"}();if(r[e]&&Math.random()<.4){const t=r[e];return t[Math.floor(Math.random()*t.length)]}}const t=e&&n[e]?n[e]:n.default;return t[Math.floor(Math.random()*t.length)]}}},88:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageBus=t.MessageType=void 0,function(e){e.PAGE_VISIT="PAGE_VISIT",e.SCROLL_EVENT="SCROLL_EVENT",e.ORGANISM_UPDATE="ORGANISM_UPDATE",e.ORGANISM_MUTATE="ORGANISM_MUTATE",e.ORGANISM_STATE_CHANGE="ORGANISM_STATE_CHANGE",e.WEBGL_INIT="WEBGL_INIT",e.WEBGL_ERROR="WEBGL_ERROR",e.WEBGL_INITIALIZED="WEBGL_INITIALIZED",e.PERFORMANCE_UPDATE="PERFORMANCE_UPDATE",e.GENERATE_INVITATION="GENERATE_INVITATION",e.INVITATION_GENERATED="INVITATION_GENERATED",e.CONSUME_INVITATION="CONSUME_INVITATION",e.INVITATION_CONSUMED="INVITATION_CONSUMED",e.CHECK_INVITATION="CHECK_INVITATION",e.INVITATION_CHECKED="INVITATION_CHECKED",e.MURMUR="MURMUR",e.GET_INVITER="GET_INVITER",e.INVITER_RESULT="INVITER_RESULT",e.GET_INVITEES="GET_INVITEES",e.INVITEES_RESULT="INVITEES_RESULT",e.GET_INVITATION_HISTORY="GET_INVITATION_HISTORY",e.INVITATION_HISTORY_RESULT="INVITATION_HISTORY_RESULT",e.INTERACTION_DETECTED="INTERACTION_DETECTED",e.REQUEST_SHARED_MUTATION="REQUEST_SHARED_MUTATION",e.SHARED_MUTATION_CODE="SHARED_MUTATION_CODE",e.ACCEPT_SHARED_MUTATION="ACCEPT_SHARED_MUTATION",e.SHARED_MUTATION_RESULT="SHARED_MUTATION_RESULT",e.COLLECTIVE_WAKE_REQUEST="COLLECTIVE_WAKE_REQUEST",e.COLLECTIVE_WAKE_RESULT="COLLECTIVE_WAKE_RESULT",e.CONTEXTUAL_INVITATION="CONTEXTUAL_INVITATION",e.SECRET_RITUAL_TRIGGERED="SECRET_RITUAL_TRIGGERED",e.SECRET_CODE_ENTERED="SECRET_CODE_ENTERED"}(n||(t.MessageType=n={}));class r{constructor(e){}on(e,t){}send(e){}subscribe(e,t){this.on(e,t)}}t.MessageBus=r,t.default=r},182:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.version=t.validate=t.v7=t.v6ToV1=t.v6=t.v5=t.v4=t.v3=t.v1ToV6=t.v1=t.stringify=t.parse=t.NIL=t.MAX=void 0;var r=n(196);Object.defineProperty(t,"MAX",{enumerable:!0,get:function(){return r.default}});var s=n(465);Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return s.default}});var i=n(797);Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return i.default}});var a=n(11);Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return a.default}});var o=n(425);Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return o.default}});var u=n(568);Object.defineProperty(t,"v1ToV6",{enumerable:!0,get:function(){return u.default}});var c=n(591);Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return c.default}});var l=n(286);Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return l.default}});var d=n(557);Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return d.default}});var h=n(356);Object.defineProperty(t,"v6",{enumerable:!0,get:function(){return h.default}});var f=n(268);Object.defineProperty(t,"v6ToV1",{enumerable:!0,get:function(){return f.default}});var g=n(299);Object.defineProperty(t,"v7",{enumerable:!0,get:function(){return g.default}});var m=n(746);Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return m.default}});var p=n(770);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return p.default}})},196:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="ffffffff-ffff-ffff-ffff-ffffffffffff"},268:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(797),s=n(11);t.default=function(e){const t=(n="string"==typeof e?(0,r.default)(e):e,Uint8Array.of((15&n[3])<<4|n[4]>>4&15,(15&n[4])<<4|(240&n[5])>>4,(15&n[5])<<4|15&n[6],n[7],(15&n[1])<<4|(240&n[2])>>4,(15&n[2])<<4|(240&n[3])>>4,16|(240&n[0])>>4,(15&n[0])<<4|(240&n[1])>>4,n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]));var n;return"string"==typeof e?(0,s.unsafeStringify)(t):t}},286:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(779),s=n(291),i=n(11);t.default=function(e,t,n){if(r.default.randomUUID&&!t&&!e)return r.default.randomUUID();const a=(e=e||{}).random??e.rng?.()??(0,s.default)();if(a.length<16)throw new Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=a[e];return t}return(0,i.unsafeStringify)(a)}},291:(e,t)=>{let n;Object.defineProperty(t,"__esModule",{value:!0});const r=new Uint8Array(16);t.default=function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(r)}},299:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateV7State=void 0;const r=n(291),s=n(11),i={};function a(e,t,n){return e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=n[6]<<23|n[7]<<16|n[8]<<8|n[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++),e}function o(e,t,n,r,s=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(r){if(s<0||s+16>r.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`)}else r=new Uint8Array(16),s=0;return t??=Date.now(),n??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],r[s++]=t/1099511627776&255,r[s++]=t/4294967296&255,r[s++]=t/16777216&255,r[s++]=t/65536&255,r[s++]=t/256&255,r[s++]=255&t,r[s++]=112|n>>>28&15,r[s++]=n>>>20&255,r[s++]=128|n>>>14&63,r[s++]=n>>>6&255,r[s++]=n<<2&255|3&e[10],r[s++]=e[11],r[s++]=e[12],r[s++]=e[13],r[s++]=e[14],r[s++]=e[15],r}t.updateV7State=a,t.default=function(e,t,n){let u;if(e)u=o(e.random??e.rng?.()??(0,r.default)(),e.msecs,e.seq,t,n);else{const e=Date.now(),s=(0,r.default)();a(i,e,s),u=o(s,i.msecs,i.seq,t,n)}return t??(0,s.unsafeStringify)(u)}},338:(e,t)=>{function n(e){return 14+(e+64>>>9<<4)+1}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function s(e,t,n,s,i,a){return r((o=r(r(t,e),r(s,a)))<<(u=i)|o>>>32-u,n);var o,u}function i(e,t,n,r,i,a,o){return s(t&n|~t&r,e,t,i,a,o)}function a(e,t,n,r,i,a,o){return s(t&r|n&~r,e,t,i,a,o)}function o(e,t,n,r,i,a,o){return s(t^n^r,e,t,i,a,o)}function u(e,t,n,r,i,a,o){return s(n^(t|~r),e,t,i,a,o)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(e){const t=new Uint8Array(4*e.length);for(let n=0;n<4*e.length;n++)t[n]=e[n>>2]>>>n%4*8&255;return t}(function(e,t){const s=new Uint32Array(n(t)).fill(0);s.set(e),s[t>>5]|=128<<t%32,s[s.length-1]=t,e=s;let c=1732584193,l=-271733879,d=-1732584194,h=271733878;for(let t=0;t<e.length;t+=16){const n=c,s=l,f=d,g=h;c=i(c,l,d,h,e[t],7,-680876936),h=i(h,c,l,d,e[t+1],12,-389564586),d=i(d,h,c,l,e[t+2],17,606105819),l=i(l,d,h,c,e[t+3],22,-1044525330),c=i(c,l,d,h,e[t+4],7,-176418897),h=i(h,c,l,d,e[t+5],12,1200080426),d=i(d,h,c,l,e[t+6],17,-1473231341),l=i(l,d,h,c,e[t+7],22,-45705983),c=i(c,l,d,h,e[t+8],7,1770035416),h=i(h,c,l,d,e[t+9],12,-1958414417),d=i(d,h,c,l,e[t+10],17,-42063),l=i(l,d,h,c,e[t+11],22,-1990404162),c=i(c,l,d,h,e[t+12],7,1804603682),h=i(h,c,l,d,e[t+13],12,-40341101),d=i(d,h,c,l,e[t+14],17,-1502002290),l=i(l,d,h,c,e[t+15],22,1236535329),c=a(c,l,d,h,e[t+1],5,-165796510),h=a(h,c,l,d,e[t+6],9,-1069501632),d=a(d,h,c,l,e[t+11],14,643717713),l=a(l,d,h,c,e[t],20,-373897302),c=a(c,l,d,h,e[t+5],5,-701558691),h=a(h,c,l,d,e[t+10],9,38016083),d=a(d,h,c,l,e[t+15],14,-660478335),l=a(l,d,h,c,e[t+4],20,-405537848),c=a(c,l,d,h,e[t+9],5,568446438),h=a(h,c,l,d,e[t+14],9,-1019803690),d=a(d,h,c,l,e[t+3],14,-187363961),l=a(l,d,h,c,e[t+8],20,1163531501),c=a(c,l,d,h,e[t+13],5,-1444681467),h=a(h,c,l,d,e[t+2],9,-51403784),d=a(d,h,c,l,e[t+7],14,1735328473),l=a(l,d,h,c,e[t+12],20,-1926607734),c=o(c,l,d,h,e[t+5],4,-378558),h=o(h,c,l,d,e[t+8],11,-2022574463),d=o(d,h,c,l,e[t+11],16,1839030562),l=o(l,d,h,c,e[t+14],23,-35309556),c=o(c,l,d,h,e[t+1],4,-1530992060),h=o(h,c,l,d,e[t+4],11,1272893353),d=o(d,h,c,l,e[t+7],16,-155497632),l=o(l,d,h,c,e[t+10],23,-1094730640),c=o(c,l,d,h,e[t+13],4,681279174),h=o(h,c,l,d,e[t],11,-358537222),d=o(d,h,c,l,e[t+3],16,-722521979),l=o(l,d,h,c,e[t+6],23,76029189),c=o(c,l,d,h,e[t+9],4,-640364487),h=o(h,c,l,d,e[t+12],11,-421815835),d=o(d,h,c,l,e[t+15],16,530742520),l=o(l,d,h,c,e[t+2],23,-995338651),c=u(c,l,d,h,e[t],6,-198630844),h=u(h,c,l,d,e[t+7],10,1126891415),d=u(d,h,c,l,e[t+14],15,-1416354905),l=u(l,d,h,c,e[t+5],21,-57434055),c=u(c,l,d,h,e[t+12],6,1700485571),h=u(h,c,l,d,e[t+3],10,-1894986606),d=u(d,h,c,l,e[t+10],15,-1051523),l=u(l,d,h,c,e[t+1],21,-2054922799),c=u(c,l,d,h,e[t+8],6,1873313359),h=u(h,c,l,d,e[t+15],10,-30611744),d=u(d,h,c,l,e[t+6],15,-1560198380),l=u(l,d,h,c,e[t+13],21,1309151649),c=u(c,l,d,h,e[t+4],6,-145523070),h=u(h,c,l,d,e[t+11],10,-1120210379),d=u(d,h,c,l,e[t+2],15,718787259),l=u(l,d,h,c,e[t+9],21,-343485551),c=r(c,n),l=r(l,s),d=r(d,f),h=r(h,g)}return Uint32Array.of(c,l,d,h)}(function(e){if(0===e.length)return new Uint32Array;const t=new Uint32Array(n(8*e.length)).fill(0);for(let n=0;n<e.length;n++)t[n>>2]|=(255&e[n])<<n%4*8;return t}(e),8*e.length))}},356:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(11),s=n(425),i=n(568);t.default=function(e,t,n){e??={},n??=0;let a=(0,s.default)({...e,_v6:!0},new Uint8Array(16));if(a=(0,i.default)(a),t){for(let e=0;e<16;e++)t[n+e]=a[e];return t}return(0,r.unsafeStringify)(a)}},425:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateV1State=void 0;const r=n(291),s=n(11),i={};function a(e,t,n){return e.msecs??=-1/0,e.nsecs??=0,t===e.msecs?(e.nsecs++,e.nsecs>=1e4&&(e.node=void 0,e.nsecs=0)):t>e.msecs?e.nsecs=0:t<e.msecs&&(e.node=void 0),e.node||(e.node=n.slice(10,16),e.node[0]|=1,e.clockseq=16383&(n[8]<<8|n[9])),e.msecs=t,e}function o(e,t,n,r,s,i,a=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(i){if(a<0||a+16>i.length)throw new RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`)}else i=new Uint8Array(16),a=0;t??=Date.now(),n??=0,r??=16383&(e[8]<<8|e[9]),s??=e.slice(10,16);const o=(1e4*(268435455&(t+=122192928e5))+n)%4294967296;i[a++]=o>>>24&255,i[a++]=o>>>16&255,i[a++]=o>>>8&255,i[a++]=255&o;const u=t/4294967296*1e4&268435455;i[a++]=u>>>8&255,i[a++]=255&u,i[a++]=u>>>24&15|16,i[a++]=u>>>16&255,i[a++]=r>>>8|128,i[a++]=255&r;for(let e=0;e<6;++e)i[a++]=s[e];return i}t.updateV1State=a,t.default=function(e,t,n){let u;const c=e?._v6??!1;if(e){const t=Object.keys(e);1===t.length&&"_v6"===t[0]&&(e=void 0)}if(e)u=o(e.random??e.rng?.()??(0,r.default)(),e.msecs,e.nsecs,e.clockseq,e.node,t,n);else{const e=Date.now(),s=(0,r.default)();a(i,e,s),u=o(s,i.msecs,i.nsecs,c?void 0:i.clockseq,c?void 0:i.node,t,n)}return t??(0,s.unsafeStringify)(u)}},465:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="00000000-0000-0000-0000-000000000000"},514:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NavigationObserver=void 0;class n{constructor(e){}}t.NavigationObserver=n,t.default=n},526:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SymbiontStorage=void 0,t.SymbiontStorage=class{constructor(){this.db=null,this.DB_NAME="symbiont-db",this.DB_VERSION=2}async initialize(){return new Promise(((e,t)=>{const n=indexedDB.open(this.DB_NAME,this.DB_VERSION);n.onerror=()=>t(n.error),n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=e=>{const t=e.target.result;if(t.objectStoreNames.contains("organism")||t.createObjectStore("organism",{keyPath:"id"}),!t.objectStoreNames.contains("behaviors")){const e=t.createObjectStore("behaviors",{keyPath:"url"});e.createIndex("visitCount","visitCount",{unique:!1}),e.createIndex("lastVisit","lastVisit",{unique:!1})}if(!t.objectStoreNames.contains("mutations")){const e=t.createObjectStore("mutations",{autoIncrement:!0});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("type","type",{unique:!1})}t.objectStoreNames.contains("settings")||t.createObjectStore("settings",{keyPath:"key"}),t.objectStoreNames.contains("invitations")||t.createObjectStore("invitations",{keyPath:"code"})}}))}async getOrganism(){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,t)=>{const n=this.db.transaction(["organism"],"readonly").objectStore("organism").get("current");n.onsuccess=()=>e(n.result||null),n.onerror=()=>t(n.error)}))}async saveOrganism(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,n)=>{const r=this.db.transaction(["organism"],"readwrite").objectStore("organism").put({...e,id:"current"});r.onsuccess=()=>t(),r.onerror=()=>n(r.error)}))}async getBehavior(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,n)=>{const r=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").get(e);r.onsuccess=()=>t(r.result||null),r.onerror=()=>n(r.error)}))}async saveBehavior(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,n)=>{const r=this.db.transaction(["behaviors"],"readwrite").objectStore("behaviors").put(e);r.onsuccess=()=>t(),r.onerror=()=>n(r.error)}))}async addMutation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,n)=>{const r=this.db.transaction(["mutations"],"readwrite").objectStore("mutations").add(e);r.onsuccess=()=>t(),r.onerror=()=>n(r.error)}))}async getRecentMutations(e=10){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,n)=>{const r=this.db.transaction(["mutations"],"readonly").objectStore("mutations").index("timestamp").openCursor(null,"prev"),s=[];r.onsuccess=n=>{const r=n.target.result;r&&s.length<e?(s.push(r.value),r.continue()):t(s)},r.onerror=()=>n(r.error)}))}async getSetting(e,t){if(!this.db)throw new Error("Database not initialized");return new Promise(((n,r)=>{const s=this.db.transaction(["settings"],"readonly").objectStore("settings").get(e);s.onsuccess=()=>{const e=s.result;n(e?e.value:t)},s.onerror=()=>r(s.error)}))}async setSetting(e,t){if(!this.db)throw new Error("Database not initialized");return new Promise(((n,r)=>{const s=this.db.transaction(["settings"],"readwrite").objectStore("settings").put({key:e,value:t});s.onsuccess=()=>n(),s.onerror=()=>r(s.error)}))}async addInvitation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,n)=>{const r=this.db.transaction(["invitations"],"readwrite").objectStore("invitations").add(e);r.onsuccess=()=>t(),r.onerror=()=>n(r.error)}))}async updateInvitation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,n)=>{const r=this.db.transaction(["invitations"],"readwrite").objectStore("invitations").put(e);r.onsuccess=()=>t(),r.onerror=()=>n(r.error)}))}async getInvitation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,n)=>{const r=this.db.transaction(["invitations"],"readonly").objectStore("invitations").get(e);r.onsuccess=()=>t(r.result||null),r.onerror=()=>n(r.error)}))}async getAllInvitations(){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,t)=>{const n=this.db.transaction(["invitations"],"readonly").objectStore("invitations").openCursor(),r=[];n.onsuccess=t=>{const n=t.target.result;n?(r.push(n.value),n.continue()):e(r)},n.onerror=()=>t(n.error)}))}async getBehaviorPatterns(){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,t)=>{const n=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").openCursor(),r=[];n.onsuccess=t=>{const n=t.target.result;n?(r.push(n.value),n.continue()):(r.sort(((e,t)=>t.visitCount!==e.visitCount?t.visitCount-e.visitCount:t.lastVisit-e.lastVisit)),e(r))},n.onerror=()=>t(n.error)}))}async getRecentActivity(e=864e5){if(!this.db)throw new Error("Database not initialized");const t=Date.now()-e;return new Promise(((e,n)=>{const r=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").openCursor(),s=[];r.onsuccess=n=>{const r=n.target.result;if(r){const e=r.value,n=(e.interactions||[]).filter((e=>e.timestamp>=t));for(const t of n)s.push({...t,url:e.url});r.continue()}else s.sort(((e,t)=>t.timestamp-e.timestamp)),e(s)},r.onerror=()=>n(r.error)}))}}},557:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0;const r=n(829),s=n(988);var i=n(988);function a(e,t,n,i){return(0,s.default)(80,r.default,e,t,n,i)}Object.defineProperty(t,"DNS",{enumerable:!0,get:function(){return i.DNS}}),Object.defineProperty(t,"URL",{enumerable:!0,get:function(){return i.URL}}),a.DNS=s.DNS,a.URL=s.URL,t.default=a},568:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(797),s=n(11);t.default=function(e){const t=(n="string"==typeof e?(0,r.default)(e):e,Uint8Array.of((15&n[6])<<4|n[7]>>4&15,(15&n[7])<<4|(240&n[4])>>4,(15&n[4])<<4|(240&n[5])>>4,(15&n[5])<<4|(240&n[0])>>4,(15&n[0])<<4|(240&n[1])>>4,(15&n[1])<<4|(240&n[2])>>4,96|15&n[2],n[3],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]));var n;return"string"==typeof e?(0,s.unsafeStringify)(t):t}},591:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0;const r=n(338),s=n(988);var i=n(988);function a(e,t,n,i){return(0,s.default)(48,r.default,e,t,n,i)}Object.defineProperty(t,"DNS",{enumerable:!0,get:function(){return i.DNS}}),Object.defineProperty(t,"URL",{enumerable:!0,get:function(){return i.URL}}),a.DNS=s.DNS,a.URL=s.URL,t.default=a},662:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PatternDetector=void 0,t.PatternDetector=class{static detectRepetition(e,t=3){const n={};for(const t of e)n[t.type]=(n[t.type]||0)+1;return Object.entries(n).filter((([e,n])=>n>=t)).map((([e,t])=>({type:"repetition",score:t,details:{eventType:e}})))}static detectAlternance(e,t,n,r=4){let s=0,i=null;for(const r of e)r.type!==t&&r.type!==n||r.type===i?r.type===i&&(s=1,i=r.type):(s++,i=r.type);return s>=r?[{type:"alternance",score:s,details:{typeA:t,typeB:n}}]:[]}static detectBurst(e,t=1e3,n=3){if(e.length<n)return[];let r=1,s=1;for(let n=1;n<e.length;n++)e[n].timestamp-e[n-1].timestamp<=t?(r++,s=Math.max(s,r)):r=1;return s>=n?[{type:"burst",score:s,details:{maxInterval:t}}]:[]}static detectTemporalPattern(e,t=1e3,n=.2){if(e.length<3)return[];const r=[];for(let t=1;t<e.length;t++)r.push(e[t].timestamp-e[t-1].timestamp);const s=r.reduce(((e,t)=>e+t),0)/r.length,i=r.reduce(((e,t)=>e+Math.pow(t-s,2)),0)/r.length,a=Math.sqrt(i);return s>=t&&a/s<n?[{type:"temporal",score:s,details:{std:a,count:e.length}}]:[]}}},697:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i},746:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(697);t.default=function(e){return"string"==typeof e&&r.default.test(e)}},770:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(746);t.default=function(e){if(!(0,r.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},779:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const n="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);t.default={randomUUID:n}},797:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(746);t.default=function(e){if(!(0,r.default)(e))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(e.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,255&t,(t=parseInt(e.slice(9,13),16))>>>8,255&t,(t=parseInt(e.slice(14,18),16))>>>8,255&t,(t=parseInt(e.slice(19,23),16))>>>8,255&t,(t=parseInt(e.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,255&t)}},829:(e,t)=>{function n(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function r(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520],i=new Uint8Array(e.length+1);i.set(e),i[e.length]=128;const a=(e=i).length/4+2,o=Math.ceil(a/16),u=new Array(o);for(let t=0;t<o;++t){const n=new Uint32Array(16);for(let r=0;r<16;++r)n[r]=e[64*t+4*r]<<24|e[64*t+4*r+1]<<16|e[64*t+4*r+2]<<8|e[64*t+4*r+3];u[t]=n}u[o-1][14]=8*(e.length-1)/Math.pow(2,32),u[o-1][14]=Math.floor(u[o-1][14]),u[o-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<o;++e){const i=new Uint32Array(80);for(let t=0;t<16;++t)i[t]=u[e][t];for(let e=16;e<80;++e)i[e]=r(i[e-3]^i[e-8]^i[e-14]^i[e-16],1);let a=s[0],o=s[1],c=s[2],l=s[3],d=s[4];for(let e=0;e<80;++e){const s=Math.floor(e/20),u=r(a,5)+n(s,o,c,l)+d+t[s]+i[e]>>>0;d=l,l=c,c=r(o,30)>>>0,o=a,a=u}s[0]=s[0]+a>>>0,s[1]=s[1]+o>>>0,s[2]=s[2]+c>>>0,s[3]=s[3]+l>>>0,s[4]=s[4]+d>>>0}return Uint8Array.of(s[0]>>24,s[0]>>16,s[0]>>8,s[0],s[1]>>24,s[1]>>16,s[1]>>8,s[1],s[2]>>24,s[2]>>16,s[2]>>8,s[2],s[3]>>24,s[3]>>16,s[3]>>8,s[3],s[4]>>24,s[4]>>16,s[4]>>8,s[4])}},968:function(e,t,n){var r,s=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),a=0;a<n.length;a++)"default"!==n[a]&&s(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.InvitationService=void 0,t.InvitationService=class{constructor(e){this.storage=e}async generateInvitation(e){const t={code:(await Promise.resolve().then((()=>a(n(182))))).v4().slice(0,8).toUpperCase(),donorId:e,symbolicLink:this.generateSymbolicLink(),used:!1,createdAt:Date.now()};return await this.storage.addInvitation(t),t}async consumeInvitation(e,t){const n=await this.storage.getInvitation(e);return!n||n.used?null:(n.used=!0,n.receiverId=t,n.usedAt=Date.now(),await this.storage.updateInvitation(n),n)}async isValid(e){const t=await this.storage.getInvitation(e);return!!t&&!t.used}generateSymbolicLink(){const e=["#FF00FF","#00FFFF","#FFFF00","#FF8800","#00FF88","#8800FF"];return e[Math.floor(Math.random()*e.length)]}async getAllInvitations(){return await this.storage.getAllInvitations()}}},988:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=t.stringToBytes=void 0;const r=n(797),s=n(11);function i(e){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t}t.stringToBytes=i,t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",t.default=function(e,t,n,a,o,u){const c="string"==typeof n?i(n):n,l="string"==typeof a?(0,r.default)(a):a;if("string"==typeof a&&(a=(0,r.default)(a)),16!==a?.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let d=new Uint8Array(16+c.length);if(d.set(l),d.set(c,l.length),d=t(d),d[6]=15&d[6]|e,d[8]=63&d[8]|128,o){u=u||0;for(let e=0;e<16;++e)o[u+e]=d[e];return o}return(0,s.unsafeStringify)(d)}}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(()=>{const e=n(88),t=n(526),r=n(514),s=n(968),i=n(82),a=n(662);new class{constructor(){this.organism=null,this.activated=!1,this.events=[],this.collectiveThresholds=[10,50,100,250,500],this.reachedThresholds=[],this.messageBus=new e.MessageBus("background"),this.storage=new t.SymbiontStorage,this.navigationObserver=new r.NavigationObserver(this.messageBus),this.invitationService=new s.InvitationService(this.storage),this.murmureService=new i.MurmureService;const n=localStorage.getItem("symbiont_collective_thresholds");this.reachedThresholds=n?JSON.parse(n):[],this.initialize()}async initialize(){try{await this.storage.initialize(),this.activated="true"===localStorage.getItem("symbiont_activated"),this.activated?(this.organism=await this.storage.getOrganism(),this.organism||(this.organism=this.createNewOrganism(),await this.storage.saveOrganism(this.organism))):this.organism=null,this.setupMessageHandlers(),this.startPeriodicTasks(),console.log("Background service initialized")}catch(e){console.error("Failed to initialize background service:",e)}}createNewOrganism(){const e=this.generateVisualDNA();return{id:crypto.randomUUID(),generation:1,health:100,energy:100,traits:{curiosity:100*Math.random(),focus:100*Math.random(),rhythm:100*Math.random(),empathy:100*Math.random(),creativity:100*Math.random()},visualDNA:e,lastMutation:Date.now(),mutations:[],createdAt:Date.now(),dna:e}}generateVisualDNA(){let e="";for(let t=0;t<64;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}setupMessageHandlers(){this.messageBus.on(e.MessageType.PAGE_VISIT,(async e=>{const{url:t,title:n}=e.payload;let r=await this.storage.getBehavior(t)||{url:t,visitCount:0,totalTime:0,scrollDepth:0,lastVisit:Date.now(),interactions:[]};r.visitCount++,r.lastVisit=Date.now(),await this.storage.saveBehavior(r),this.events.push({type:"visit",timestamp:Date.now(),url:t}),this.updateOrganismTraits(t,n),this.analyzeContextualPatterns()})),this.messageBus.on(e.MessageType.SCROLL_EVENT,(async e=>{const{url:t,scrollDepth:n}=e.payload,r=await this.storage.getBehavior(t);r&&(r.scrollDepth=Math.max(r.scrollDepth,n),await this.storage.saveBehavior(r)),this.events.push({type:"scroll",timestamp:Date.now(),url:t}),this.analyzeContextualPatterns()})),this.messageBus.on(e.MessageType.INTERACTION_DETECTED,(e=>{const{type:t,timestamp:n,target:r,data:s}=e.payload;this.events.push({type:t,timestamp:n,target:r,...s}),this.analyzeContextualPatterns()})),this.messageBus.on(e.MessageType.GENERATE_INVITATION,(async t=>{const{donorId:n}=t.payload,r=await this.invitationService.generateInvitation(n);this.messageBus.send({type:e.MessageType.INVITATION_GENERATED,payload:r})})),this.messageBus.on(e.MessageType.CONSUME_INVITATION,(async t=>{const{code:n,receiverId:r}=t.payload,s=await this.invitationService.consumeInvitation(n,r);s&&(this.activated=!0,localStorage.setItem("symbiont_activated","true"),this.organism||(this.organism=this.createNewOrganism(),await this.storage.saveOrganism(this.organism))),this.messageBus.send({type:e.MessageType.INVITATION_CONSUMED,payload:s})})),this.messageBus.on(e.MessageType.CHECK_INVITATION,(async t=>{const{code:n}=t.payload,r=await this.invitationService.isValid(n);this.messageBus.send({type:e.MessageType.INVITATION_CHECKED,payload:{code:n,valid:r}})})),this.messageBus.on(e.MessageType.GET_INVITER,(async t=>{const{userId:n}=t.payload,r=(await this.invitationService.getAllInvitations()).find((e=>e.receiverId===n));this.messageBus.send({type:e.MessageType.INVITER_RESULT,payload:r||null})})),this.messageBus.on(e.MessageType.GET_INVITEES,(async t=>{const{userId:n}=t.payload,r=(await this.invitationService.getAllInvitations()).filter((e=>e.donorId===n));this.messageBus.send({type:e.MessageType.INVITEES_RESULT,payload:r})})),this.messageBus.on(e.MessageType.GET_INVITATION_HISTORY,(async t=>{const{userId:n}=t.payload,r=await this.invitationService.getAllInvitations(),s=[...r.filter((e=>e.receiverId===n)).map((e=>({...e,type:"reçue"}))),...r.filter((e=>e.donorId===n)).map((e=>({...e,type:"envoyée"})))];this.messageBus.send({type:e.MessageType.INVITATION_HISTORY_RESULT,payload:s})}));const t=new Map;this.messageBus.on(e.MessageType.REQUEST_SHARED_MUTATION,(n=>{const{initiatorId:r,traits:s}=n.payload,i=Math.random().toString(36).substr(2,6).toUpperCase(),a=Date.now()+3e5;t.set(i,{initiatorId:r,traits:s,expiresAt:a}),this.messageBus.send({type:e.MessageType.SHARED_MUTATION_CODE,payload:{code:i,initiatorId:r,expiresAt:a}})})),this.messageBus.on(e.MessageType.ACCEPT_SHARED_MUTATION,(n=>{const{code:r,receiverId:s,traits:i}=n.payload,a=t.get(r);if(!a||a.expiresAt<Date.now())return void this.messageBus.send({type:e.MessageType.SHARED_MUTATION_RESULT,payload:{error:"Code expiré ou invalide."}});const o={...a.traits};for(const e of Object.keys(i))o[e]=(o[e]??0+i[e]??0)/2;t.delete(r),this.messageBus.send({type:e.MessageType.SHARED_MUTATION_RESULT,payload:{initiatorId:a.initiatorId,receiverId:s,mergedTraits:o,timestamp:Date.now()}})}));let n=new Set,r=null;this.messageBus.on(e.MessageType.COLLECTIVE_WAKE_REQUEST,(t=>{const{userId:s}=t.payload;n.add(s),r||(r=setTimeout((()=>{this.messageBus.send({type:e.MessageType.COLLECTIVE_WAKE_RESULT,payload:{participants:Array.from(n),triggeredAt:Date.now()}}),n.clear(),r=null}),1e4))}));const s=t=>{const n=localStorage.getItem("symbiont_user_id")||"unknown",r=this.invitationService.generateInvitation(n);this.messageBus.send({type:e.MessageType.CONTEXTUAL_INVITATION,payload:{invitation:r,context:t}})},i=this.generateMutation.bind(this);this.generateMutation=()=>{const e=i();return"cognitive"===e.type&&s("mutation_cognitive"),e};const a=this.updateOrganismTraits.bind(this);this.updateOrganismTraits=async(e,t)=>{await a(e,t),this.organism&&this.organism.traits.curiosity>90&&s("curiosity_threshold")};let o=Date.now();chrome.idle.onStateChanged.addListener((e=>{"idle"===e?o=Date.now():"active"===e&&Date.now()-o>18e5&&s("long_inactivity")}));const u=["SYMBIOSE","AWAKEN","ECHO"];this.messageBus.on(e.MessageType.SECRET_CODE_ENTERED,(t=>{const{code:n}=t.payload;u.includes(n.toUpperCase())&&this.messageBus.send({type:e.MessageType.SECRET_RITUAL_TRIGGERED,payload:{code:n,effect:"mutation_unique",timestamp:Date.now()}})}))}async updateOrganismTraits(t,n){if(!this.organism)return;const r=t.toLowerCase(),s=n.toLowerCase();(r.includes("github")||r.includes("stackoverflow")||r.includes("codepen")||r.includes("dribbble"))&&(this.organism.traits.creativity+=.5),(r.includes("docs")||r.includes("wiki")||r.includes("tutorial")||s.includes("guide"))&&(this.organism.traits.focus+=.3),(r.includes("twitter")||r.includes("linkedin")||r.includes("facebook")||r.includes("reddit"))&&(this.organism.traits.empathy+=.4);const i=new URL(t).hostname;if(!await this.hasVisitedDomain(i)&&(this.organism.traits.curiosity+=1),!this.organism)return;const a=this.organism.traits;if(!a)return;Object.keys(a).forEach((e=>{a[e]=Math.max(0,Math.min(100,a[e]))})),await this.checkForMutations(),await this.storage.saveOrganism(this.organism);let o="default";await this.isLoop(t)?o="loop":await this.isIdle()?o="idle":await this.isExploration(t)?o="exploration":await this.isRoutine(t)&&(o="routine"),this.messageBus.send({type:e.MessageType.ORGANISM_UPDATE,payload:{state:this.organism,mutations:await this.storage.getRecentMutations(5)}});const u=this.murmureService.generateMurmur(o);this.messageBus.send({type:e.MessageType.MURMUR,payload:{text:u,pattern:o,timestamp:Date.now()}})}async hasVisitedDomain(e){return(await chrome.tabs.query({})).some((t=>t.url&&new URL(t.url).hostname===e))}async checkForMutations(){if(!this.organism)return;const e=Date.now(),t=e-this.organism.lastMutation,n=Math.min(.5,t/36e5);if(Math.random()<n){const t=this.generateMutation();await this.storage.addMutation(t),this.organism.lastMutation=e,this.applyMutation(t)}}generateMutation(){const e=["visual","behavioral","cognitive"],t=e[Math.floor(Math.random()*e.length)];return{type:t,trigger:this.getMutationTrigger(t),magnitude:.5*Math.random()+.1,timestamp:Date.now()}}getMutationTrigger(e){const t={visual:["color_shift","pattern_change","size_fluctuation","opacity_variation"],behavioral:["navigation_speed","content_preference","interaction_pattern"],cognitive:["memory_retention","pattern_recognition","association_strength"]}[e];return t[Math.floor(Math.random()*t.length)]}applyMutation(e){if(this.organism)switch(e.type){case"visual":this.organism.visualDNA=this.mutateVisualDNA(this.organism.visualDNA,e.magnitude);break;case"behavioral":const t=Object.keys(this.organism.traits),n=t[Math.floor(Math.random()*t.length)];this.organism.traits[n]+=(Math.random()-.5)*e.magnitude*20;break;case"cognitive":if(!this.organism)return;const r=this.organism.traits;if(!r)return;Object.keys(r).forEach((t=>{r[t]+=(Math.random()-.5)*e.magnitude*5}))}}mutateVisualDNA(e,t){const n=Math.floor(e.length*t);let r=e.split("");for(let t=0;t<n;t++)r[Math.floor(Math.random()*e.length)]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return r.join("")}startPeriodicTasks(){setInterval((()=>{this.organism&&this.organism.health>0&&(this.organism.health=Math.max(0,this.organism.health-.1),this.organism.energy=Math.max(0,this.organism.energy-.05))}),6e4),setInterval((async()=>{this.organism&&(await this.storage.saveOrganism(this.organism),this.messageBus.send({type:e.MessageType.ORGANISM_UPDATE,payload:{state:this.organism,mutations:await this.storage.getRecentMutations(5)}}))}),3e4)}async isLoop(e){const t=await this.storage.getBehavior(e);return!!t&&t.visitCount>=3}async isIdle(){return!1}async isExploration(e){const t=await this.storage.getBehavior(e);return!!t&&t.visitCount<=1}async isRoutine(e){const t=await this.storage.getBehavior(e);return!!t&&Date.now()-t.lastVisit<1728e5}async analyzeContextualPatterns(){const e=Date.now();this.events=this.events.filter((t=>e-t.timestamp<18e5)),a.PatternDetector.detectBurst(this.events,1e4,5).length>0?this.triggerContextualInvitation("burst_activity"):a.PatternDetector.detectTemporalPattern(this.events,6e4,.15).length>0?this.triggerContextualInvitation("temporal_cycle"):a.PatternDetector.detectAlternance(this.events,"visit","scroll",6).length>0?this.triggerContextualInvitation("alternance_nav_scroll"):a.PatternDetector.detectRepetition(this.events,7).length>0?this.triggerContextualInvitation("repetition_action"):this.checkCollectiveThreshold()}async checkCollectiveThreshold(){const e=(await this.invitationService.getAllInvitations()).length;for(const t of this.collectiveThresholds)if(e>=t&&!this.reachedThresholds.includes(t)){this.reachedThresholds.push(t),localStorage.setItem("symbiont_collective_thresholds",JSON.stringify(this.reachedThresholds)),this.triggerContextualInvitation("collective_threshold_"+t);break}}async triggerContextualInvitation(t){const n=localStorage.getItem("symbiont_user_id")||"unknown",r=await this.invitationService.generateInvitation(n);this.messageBus.send({type:e.MessageType.CONTEXTUAL_INVITATION,payload:{invitation:r,context:t}})}}})()})();
//# sourceMappingURL=index.js.map