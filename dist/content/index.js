(()=>{"use strict";var e={37:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScrollTracker=void 0,t.ScrollTracker=class{on(e,t){}detectPattern(){return"unknown"}stop(){}}},88:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageBus=t.MessageType=void 0,function(e){e.PAGE_VISIT="PAGE_VISIT",e.SCROLL_EVENT="SCROLL_EVENT",e.ORGANISM_UPDATE="ORGANISM_UPDATE",e.ORGANISM_MUTATE="ORGANISM_MUTATE",e.ORGANISM_STATE_CHANGE="ORGANISM_STATE_CHANGE",e.WEBGL_INIT="WEBGL_INIT",e.WEBGL_ERROR="WEBGL_ERROR",e.WEBGL_INITIALIZED="WEBGL_INITIALIZED",e.PERFORMANCE_UPDATE="PERFORMANCE_UPDATE",e.GENERATE_INVITATION="GENERATE_INVITATION",e.INVITATION_GENERATED="INVITATION_GENERATED",e.CONSUME_INVITATION="CONSUME_INVITATION",e.INVITATION_CONSUMED="INVITATION_CONSUMED",e.CHECK_INVITATION="CHECK_INVITATION",e.INVITATION_CHECKED="INVITATION_CHECKED",e.MURMUR="MURMUR",e.GET_INVITER="GET_INVITER",e.INVITER_RESULT="INVITER_RESULT",e.GET_INVITEES="GET_INVITEES",e.INVITEES_RESULT="INVITEES_RESULT",e.GET_INVITATION_HISTORY="GET_INVITATION_HISTORY",e.INVITATION_HISTORY_RESULT="INVITATION_HISTORY_RESULT",e.INTERACTION_DETECTED="INTERACTION_DETECTED",e.REQUEST_SHARED_MUTATION="REQUEST_SHARED_MUTATION",e.SHARED_MUTATION_CODE="SHARED_MUTATION_CODE",e.ACCEPT_SHARED_MUTATION="ACCEPT_SHARED_MUTATION",e.SHARED_MUTATION_RESULT="SHARED_MUTATION_RESULT",e.COLLECTIVE_WAKE_REQUEST="COLLECTIVE_WAKE_REQUEST",e.COLLECTIVE_WAKE_RESULT="COLLECTIVE_WAKE_RESULT",e.CONTEXTUAL_INVITATION="CONTEXTUAL_INVITATION",e.SECRET_RITUAL_TRIGGERED="SECRET_RITUAL_TRIGGERED",e.SECRET_CODE_ENTERED="SECRET_CODE_ENTERED"}(s||(t.MessageType=s={}));class n{constructor(e){}on(e,t){}send(e){}subscribe(e,t){this.on(e,t)}}t.MessageBus=n,t.default=n},350:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttentionMonitor=void 0,t.AttentionMonitor=class{on(e,t){}resume(){}pause(){}stop(){}getSessionSummary(){return{focusPeriods:[]}}}},514:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NavigationObserver=void 0;class s{constructor(e){}}t.NavigationObserver=s,t.default=s},554:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageBus=void 0;const n=s(88);class a{constructor(e){this.source=e,this.handlers=new Map,this.globalHandlers=new Set,this.filters=[],this.messageQueue=[],this.processing=!1,this.setupListeners()}setupListeners(){chrome.runtime.onMessage.addListener(((e,t,s)=>(this.shouldProcessMessage(e)&&(this.enqueueMessage(e),s({received:!0})),!1)))}shouldProcessMessage(e){return this.filters.every((t=>t(e)))}async enqueueMessage(e){this.messageQueue.push(e),this.processing||(this.processing=!0,await this.processQueue(),this.processing=!1)}async processQueue(){for(;this.messageQueue.length>0;){const e=this.messageQueue.shift();await this.processMessage(e)}}async processMessage(e){if(!function(e,t){switch(e){case n.MessageType.ORGANISM_UPDATE:return(s=t)&&"string"==typeof s.id&&"number"==typeof s.generation;case n.MessageType.ORGANISM_MUTATE:return function(e){return e&&"string"==typeof e.type&&"string"==typeof e.trigger}(t);case n.MessageType.PAGE_VISIT:case n.MessageType.SCROLL_EVENT:return function(e){return e&&"string"==typeof e.url&&"number"==typeof e.visitCount}(t);case n.MessageType.MURMUR:return function(e){return e&&"string"==typeof e.text&&"number"==typeof e.timestamp}(t);case n.MessageType.GENERATE_INVITATION:case n.MessageType.CONSUME_INVITATION:case n.MessageType.CHECK_INVITATION:return function(e){return e&&"string"==typeof e.code}(t);case n.MessageType.INVITATION_GENERATED:case n.MessageType.INVITATION_CONSUMED:case n.MessageType.INVITATION_CHECKED:return function(e){return e&&"string"==typeof e.code&&"string"==typeof e.status}(t);default:return!0}var s}(e.type,e.payload))return void console.warn(`[MessageBus] Payload non valide pour le type ${e.type}`,e.payload);for(const t of this.globalHandlers)try{await t(e)}catch(e){console.error("Error in global handler:",e)}const t=this.handlers.get(e.type);if(t)for(const s of t)try{await s(e)}catch(t){console.error(`Error in handler for ${e.type}:`,t)}}on(e,t){this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t)}off(e,t){const s=this.handlers.get(e);s&&s.delete(t)}onAny(e){this.globalHandlers.add(e)}offAny(e){this.globalHandlers.delete(e)}addFilter(e){this.filters.push(e)}async send(e){const t={...e,source:this.source,timestamp:Date.now(),id:crypto.randomUUID()};try{if("content"===this.source)await chrome.runtime.sendMessage(t);else{const e=await chrome.tabs.query({});for(const s of e)s.id&&chrome.tabs.sendMessage(s.id,t).catch((()=>{}));chrome.runtime.sendMessage(t).catch((()=>{}))}}catch(e){console.error("Error sending message:",e)}}sendToBackground(e){this.send(e)}emit(e,t){const s=this.handlers.get(e);s&&s.forEach((s=>s({type:e,payload:t})))}}t.MessageBus=a,t.default=a},824:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InteractionCollector=void 0,t.InteractionCollector=class{on(e,t){}start(e){}stop(){}}},936:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DOMAnalyzer=void 0,t.DOMAnalyzer=class{analyze(){return{wordCount:1e3,imageCount:10,videoCount:2,linkCount:20,estimatedReadingTime:5}}extractMainContent(){return{}}categorizeContent(){return"article"}}}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}(()=>{const e=s(554),t=s(514),n=s(824),a=s(936),i=s(37),r=s(350);class o{constructor(){this.pageData={startTime:Date.now(),url:window.location.href,title:document.title,interactions:[],scrollData:{maxDepth:0,totalDistance:0,pattern:"unknown"},attention:{totalActiveTime:0,distractions:0}},console.log("ðŸ” SYMBIONT Content Script initializing..."),this.messageBus=new e.MessageBus("content"),this.navigationObserver=new t.NavigationObserver,this.interactionCollector=new n.InteractionCollector,this.domAnalyzer=new a.DOMAnalyzer,this.scrollTracker=new i.ScrollTracker,this.attentionMonitor=new r.AttentionMonitor,this.initialize()}static getInstance(){return o.instance||(o.instance=new o),o.instance}initialize(){this.setupObservers(),this.setupEventListeners(),this.performInitialAnalysis(),window.addEventListener("beforeunload",this.cleanup.bind(this)),console.log("âœ… SYMBIONT Content Script ready")}setupObservers(){this.navigationObserver.observe((e=>{this.handleNavigationChange(e)})),this.interactionCollector.start({clicks:!0,keypresses:!0,forms:!0,media:!0}),this.interactionCollector.on("interaction",(e=>{this.handleInteraction(e)})),this.scrollTracker.on("scroll",(e=>{this.updateScrollData(e)})),this.attentionMonitor.on("attentionChange",(e=>{this.handleAttentionChange(e)}))}setupEventListeners(){document.addEventListener("visibilitychange",(()=>{this.handleVisibilityChange()})),window.addEventListener("focus",(()=>this.handleWindowFocus(!0))),window.addEventListener("blur",(()=>this.handleWindowFocus(!1))),"PerformanceObserver"in window&&this.setupPerformanceObserver(),chrome.runtime.onMessage.addListener(((e,t,s)=>(this.messageBus.emit(e.type,{message:e,sender:t,sendResponse:s}),!0)))}setupPerformanceObserver(){new PerformanceObserver((e=>{for(const t of e.getEntries())"largest-contentful-paint"===t.entryType&&this.handleLCP(t)})).observe({entryTypes:["largest-contentful-paint"]})}async performInitialAnalysis(){const e=await this.domAnalyzer.analyze(),t=(this.domAnalyzer.extractMainContent(),this.domAnalyzer.categorizeContent());this.messageBus.sendToBackground({type:"PAGE_ANALYSIS_COMPLETE",payload:{url:this.pageData.url,title:this.pageData.title,category:t,contentMetrics:{wordCount:e.wordCount,imageCount:e.imageCount,videoCount:e.videoCount,linkCount:e.linkCount,readingTime:e.estimatedReadingTime},performance:{loadTime:performance.now(),resourceCount:performance.getEntriesByType("resource").length}}})}handleInteraction(e){const t={...e,pageContext:{url:this.pageData.url,title:this.pageData.title,timeOnPage:Date.now()-this.pageData.startTime}};this.pageData.interactions.push(t),this.isSignificantInteraction(e)&&this.messageBus.sendToBackground({type:"INTERACTION_DETECTED",payload:t})}isSignificantInteraction(e){return"form_submit"===e.type||"video_play"===e.type||"click"===e.type&&e.data.isNavigation||"keypress"===e.type&&e.data.isShortcut}updateScrollData(e){this.pageData.scrollData.maxDepth=Math.max(this.pageData.scrollData.maxDepth,e.depth),this.pageData.scrollData.totalDistance+=Math.abs(e.delta),this.pageData.scrollData.pattern=this.scrollTracker.detectPattern()}handleAttentionChange(e){e.isActive?this.pageData.attention.totalActiveTime+=e.duration||0:this.pageData.attention.distractions++,this.messageBus.sendToBackground({type:"ATTENTION_UPDATE",payload:{url:this.pageData.url,state:e,duration:Date.now()-this.pageData.startTime}})}handleNavigationChange(e){this.finalizePage(),this.pageData={startTime:Date.now(),url:e.url,title:document.title,interactions:[],scrollData:{maxDepth:0,totalDistance:0,pattern:"unknown"},attention:{totalActiveTime:0,distractions:0}},this.performInitialAnalysis()}handleVisibilityChange(){const e="visible"===document.visibilityState;this.messageBus.sendToBackground({type:"VISIBILITY_CHANGE",payload:{url:this.pageData.url,isVisible:e,timestamp:Date.now()}}),e?this.attentionMonitor.resume():this.attentionMonitor.pause()}handleWindowFocus(e){this.messageBus.sendToBackground({type:"FOCUS_CHANGE",payload:{url:this.pageData.url,hasFocus:e,timestamp:Date.now()}})}finalizePage(){const e=Date.now()-this.pageData.startTime;if(e<1e3)return;const t={url:this.pageData.url,title:this.pageData.title,startTime:this.pageData.startTime,duration:e,interactions:this.pageData.interactions,scrollData:this.pageData.scrollData,attention:{totalActiveTime:this.pageData.attention.totalActiveTime,distractionCount:this.pageData.attention.distractions,focusPeriods:this.attentionMonitor.getSessionSummary().focusPeriods},performance:this.collectPerformanceMetrics()};this.messageBus.sendToBackground({type:"PAGE_SESSION_COMPLETE",payload:t})}collectPerformanceMetrics(){const e=performance.getEntriesByType("navigation"),t=e.length>0?e[0]:null;return{loadTime:t?t.loadEventEnd-t.startTime:0,domContentLoaded:t?t.domContentLoadedEventEnd-t.startTime:0,firstPaint:this.getFirstPaint(),firstContentfulPaint:this.getFirstContentfulPaint(),largestContentfulPaint:this.getLargestContentfulPaint(),resourceCount:performance.getEntriesByType("resource").length}}getFirstPaint(){const e=performance.getEntriesByType("paint").find((e=>"first-paint"===e.name));return e?e.startTime:0}getFirstContentfulPaint(){const e=performance.getEntriesByType("paint").find((e=>"first-contentful-paint"===e.name));return e?e.startTime:0}getLargestContentfulPaint(){const e=performance.getEntriesByType("largest-contentful-paint");return e.length>0?e[e.length-1].startTime:0}handleLCP(e){e.startTime>2500&&console.debug("Slow LCP detected:",e.startTime)}cleanup(){this.finalizePage(),this.navigationObserver.disconnect(),this.interactionCollector.stop(),this.scrollTracker.stop(),this.attentionMonitor.stop(),console.log("ðŸ§¹ SYMBIONT Content Script cleaned up")}}window.__SYMBIONT_CONTENT_SCRIPT_LOADED__||(window.__SYMBIONT_CONTENT_SCRIPT_LOADED__=!0,o.getInstance())})()})();
//# sourceMappingURL=index.js.map