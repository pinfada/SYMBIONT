"use strict";(self.webpackChunksymbiont=self.webpackChunksymbiont||[]).push([[969],{526:(e,t,s)=>{s.d(t,{p:()=>n});class n{constructor(){this.db=null,this.DB_NAME="symbiont-db",this.DB_VERSION=3,this.OPERATION_TIMEOUT=1e4,this.MAX_STORAGE_SIZE_MB=50,this.quotaWarningIssued=!1}withTimeout(e,t=this.OPERATION_TIMEOUT){return Promise.race([e,new Promise(((e,s)=>setTimeout((()=>s(new Error(`Operation timed out after ${t}ms`))),t)))])}async initialize(){try{await this.checkStorageQuota()}catch(e){console.warn("Failed to check storage quota:",e)}const e=new Promise(((e,t)=>{const s=indexedDB.open(this.DB_NAME,this.DB_VERSION);s.onerror=()=>{const e=s.error;console.error("IndexedDB open failed:",{name:e?.name,message:e?.message,code:e?.code}),t(e)},s.onsuccess=()=>{this.db=s.result,this.db.onerror=e=>{console.error("Database error:",e)},this.db.onversionchange=()=>{console.warn("Database version changed, closing connection"),this.db?.close(),this.db=null},e()},s.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("organisms")){const e=t.createObjectStore("organisms",{keyPath:"id"});e.createIndex("generation","generation",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1})}if(!t.objectStoreNames.contains("behaviors")){const e=t.createObjectStore("behaviors",{keyPath:"url"});e.createIndex("lastVisit","lastVisit",{unique:!1}),e.createIndex("visitCount","visitCount",{unique:!1})}if(!t.objectStoreNames.contains("mutations")){const e=t.createObjectStore("mutations",{keyPath:"id",autoIncrement:!0});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("type","type",{unique:!1})}if(t.objectStoreNames.contains("settings")||t.createObjectStore("settings",{keyPath:"key"}),!t.objectStoreNames.contains("invitations")){const e=t.createObjectStore("invitations",{keyPath:"code"});e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("status","status",{unique:!1})}}}));return this.withTimeout(e,15e3)}async getOrganism(e){if(!this.db)throw new Error("Database not initialized");const t=new Promise(((t,s)=>{const n=this.db.transaction(["organisms"],"readonly").objectStore("organisms");if(e){const r=n.get(e);r.onsuccess=()=>t(r.result||null),r.onerror=()=>s(r.error)}else{const e=n.openCursor();e.onsuccess=e=>{const s=e.target.result;t(s?s.value:null)},e.onerror=()=>s(e.error)}}));return this.withTimeout(t)}async saveOrganism(e){if(!this.db)throw new Error("Database not initialized");const t=new Promise(((t,s)=>{const n=this.db.transaction(["organisms"],"readwrite").objectStore("organisms").put(e);n.onsuccess=()=>t(),n.onerror=()=>s(n.error)}));return this.withTimeout(t)}async getBehavior(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").get(e);n.onsuccess=()=>t(n.result||null),n.onerror=()=>s(n.error)}))}async saveBehavior(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["behaviors"],"readwrite").objectStore("behaviors").put(e);n.onsuccess=()=>t(),n.onerror=()=>s(n.error)}))}async addMutation(e){if(!this.db)throw new Error("Database not initialized");const t={...e,timestamp:e.timestamp||Date.now()};return new Promise(((e,s)=>{const n=this.db.transaction(["mutations"],"readwrite").objectStore("mutations").add(t);n.onsuccess=()=>e(),n.onerror=()=>s(n.error)}))}async getRecentMutations(e=10){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["mutations"],"readonly").objectStore("mutations").index("timestamp").openCursor(null,"prev"),r=[];n.onsuccess=s=>{const n=s.target.result;n&&r.length<e?(r.push(n.value),n.continue()):t(r)},n.onerror=()=>s(n.error)}))}async getSetting(e,t){if(!this.db)throw new Error("Database not initialized");return new Promise(((s,n)=>{const r=this.db.transaction(["settings"],"readonly").objectStore("settings").get(e);r.onsuccess=()=>{const e=r.result;s(e?e.value:t)},r.onerror=()=>n(r.error)}))}async setSetting(e,t){if(!this.db)throw new Error("Database not initialized");return new Promise(((s,n)=>{const r=this.db.transaction(["settings"],"readwrite").objectStore("settings").put({key:e,value:t});r.onsuccess=()=>s(),r.onerror=()=>n(r.error)}))}async addInvitation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["invitations"],"readwrite").objectStore("invitations").add({...e,createdAt:e.createdAt||Date.now()});n.onsuccess=()=>t(),n.onerror=()=>s(n.error)}))}async updateInvitation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["invitations"],"readwrite").objectStore("invitations").put(e);n.onsuccess=()=>t(),n.onerror=()=>s(n.error)}))}async getInvitation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["invitations"],"readonly").objectStore("invitations").get(e);n.onsuccess=()=>t(n.result||null),n.onerror=()=>s(n.error)}))}async getAllInvitations(){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,t)=>{const s=this.db.transaction(["invitations"],"readonly").objectStore("invitations").openCursor(),n=[];s.onsuccess=t=>{const s=t.target.result;s?(n.push(s.value),s.continue()):e(n)},s.onerror=()=>t(s.error)}))}async getBehaviorPatterns(){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,t)=>{const s=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").openCursor(),n=[];s.onsuccess=t=>{const s=t.target.result;s?(n.push(s.value),s.continue()):(n.sort(((e,t)=>t.visitCount!==e.visitCount?t.visitCount-e.visitCount:t.lastVisit-e.lastVisit)),e(n))},s.onerror=()=>t(s.error)}))}async getRecentActivity(e=864e5){if(!this.db)throw new Error("Database not initialized");const t=Date.now()-e;return new Promise(((e,s)=>{const n=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").openCursor(),r=[];n.onsuccess=s=>{const n=s.target.result;if(n){const e=n.value,s=(e.interactions||[]).filter((e=>e.timestamp>=t));for(const t of s)r.push({...t,url:e.url});n.continue()}else r.sort(((e,t)=>t.timestamp-e.timestamp)),e(r)},n.onerror=()=>s(n.error)}))}async cleanup(e=30){if(!this.db)throw new Error("Database not initialized");const t=Date.now()-24*e*60*60*1e3;return new Promise(((e,s)=>{const n=this.db.transaction(["mutations"],"readwrite").objectStore("mutations").index("timestamp"),r=IDBKeyRange.upperBound(t),a=n.openCursor(r);a.onsuccess=t=>{const s=t.target.result;s?(s.delete(),s.continue()):e()},a.onerror=()=>s(a.error)}))}async checkStorageQuota(){if(navigator.storage&&navigator.storage.estimate)try{const e=await navigator.storage.estimate(),t=(e.usage||0)/1048576,s=(e.quota||0)/1048576,n=s>0?t/s*100:0;console.info("Storage quota:",{usageInMB:t.toFixed(2),quotaInMB:s.toFixed(2),usagePercent:n.toFixed(2)+"%"}),n>80&&!this.quotaWarningIssued&&(this.quotaWarningIssued=!0,console.warn("STORAGE WARNING: Usage above 80%, consider cleanup"),n>90&&(console.warn("STORAGE CRITICAL: Usage above 90%, triggering automatic cleanup"),await this.cleanup(15))),t>.9*this.MAX_STORAGE_SIZE_MB&&(console.error("STORAGE CRITICAL: Approaching maximum storage size limit"),await this.cleanup(7))}catch(e){console.error("Failed to check storage quota:",e)}else console.warn("Storage API not available, skipping quota check")}async getStorageStats(){if(!navigator.storage||!navigator.storage.estimate)return{usageInMB:0,quotaInMB:0,usagePercent:0,needsCleanup:!1};try{const e=await navigator.storage.estimate(),t=(e.usage||0)/1048576,s=(e.quota||0)/1048576,n=s>0?t/s*100:0;return{usageInMB:t,quotaInMB:s,usagePercent:n,needsCleanup:n>80}}catch(e){return console.error("Failed to get storage stats:",e),{usageInMB:0,quotaInMB:0,usagePercent:0,needsCleanup:!1}}}close(){this.db&&(this.db.close(),this.db=null)}}},969:(e,t,s)=>{s.r(t),s.d(t,{MetricsPanel:()=>v,default:()=>x});var n=s(848),r=s(540);const a=({data:e})=>e&&0!==e.length?(0,n.jsx)("div",{className:"behavior-patterns",children:(0,n.jsx)("ul",{className:"behavior-list",children:e.map((e=>(0,n.jsxs)("li",{className:"behavior-item",children:[(0,n.jsxs)("div",{className:"behavior-item__header",children:[(0,n.jsx)("span",{className:`behavior-type behavior-type--${e.type}`,children:e.type}),(0,n.jsxs)("span",{className:"behavior-confidence",children:[Math.round(100*e.confidence),"%"]})]}),(0,n.jsx)("p",{className:"behavior-description",children:e.description}),(0,n.jsx)("div",{className:"behavior-timestamp",children:i(e.lastSeen)})]},e.id)))})}):(0,n.jsx)("div",{className:"behavior-patterns--empty",children:(0,n.jsx)("p",{children:"No behavior patterns detected yet"})}),i=e=>{const t=Date.now()-e;if(t<6e4)return"just now";if(t<36e5){const e=Math.floor(t/6e4);return`${e} minute${1!==e?"s":""} ago`}if(t<864e5){const e=Math.floor(t/36e5);return`${e} hour${1!==e?"s":""} ago`}{const e=Math.floor(t/864e5);return`${e} day${1!==e?"s":""} ago`}},o=({data:e})=>{if(!e||0===e.length)return(0,n.jsx)("div",{className:"activity-timeline--empty",children:(0,n.jsx)("p",{children:"No activity recorded yet"})});const t=c(e);return(0,n.jsx)("div",{className:"activity-timeline",children:Object.entries(t).map((([e,t])=>(0,n.jsxs)("div",{className:"timeline-hour",children:[(0,n.jsx)("div",{className:"timeline-hour__header",children:(0,n.jsx)("h4",{children:l(parseInt(e))})}),(0,n.jsx)("ul",{className:"timeline-activities",children:t.map((e=>(0,n.jsxs)("li",{className:"timeline-activity",children:[(0,n.jsx)("div",{className:`activity-icon activity-icon--${e.type}`,children:h(e.type)}),(0,n.jsxs)("div",{className:"activity-content",children:[(0,n.jsx)("div",{className:"activity-title",children:m(e)}),e.duration&&(0,n.jsx)("div",{className:"activity-duration",children:u(e.duration)})]}),(0,n.jsx)("div",{className:"activity-time",children:d(e.timestamp)})]},e.id)))})]},e)))})},c=e=>{const t={};return e.forEach((e=>{const s=new Date(e.timestamp).getHours();t[s]||(t[s]=[]),t[s].push(e)})),Object.fromEntries(Object.entries(t).sort((([e],[t])=>parseInt(t)-parseInt(e))))},l=e=>`${e%12||12} ${e<12?"AM":"PM"}`,d=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),u=e=>{const t=Math.floor(e/6e4),s=Math.floor(e%6e4/1e3);return t>0?`${t}m ${s}s`:`${s}s`},h=e=>{switch(e){case"navigation":return"üß≠";case"interaction":return"üëÜ";case"search":return"üîç";case"reading":return"üìñ";case"idle":return"‚è∏Ô∏è";default:return"‚Ä¢"}},m=e=>{switch(e.type){case"navigation":return e.url?`Visited ${new URL(e.url).hostname}`:"Navigated to a page";case"interaction":return"Interacted with content";case"search":return"Searched for content";case"reading":return"Read content";case"idle":return"Idle period";default:return e.type||"Unknown activity"}};var b=s(23),g=s(526);const v=()=>{const{organism:e}=(0,b.YT)(),[t,s]=(0,r.useState)([]),[i,c]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const e=async()=>{const e=new g.p;await e.initialize();try{const t=await e.getBehaviorPatterns();s(t);const n=await e.getRecentActivity();c(n)}catch(e){s([]),c([])}};e();const t=setInterval(e,1e4);return()=>clearInterval(t)}),[]),e?(0,n.jsxs)("div",{className:"ext-metrics-panel max-w-xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8",children:[(0,n.jsxs)("section",{className:"ext-metrics-section mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-[#00e0ff] mb-2",children:"Behavior Patterns"}),(0,n.jsx)(a,{data:t})]}),(0,n.jsxs)("section",{className:"ext-metrics-section mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-[#00e0ff] mb-2",children:"Activity Timeline"}),(0,n.jsx)(o,{data:i})]}),(0,n.jsxs)("section",{className:"ext-metrics-section",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-[#00e0ff] mb-2",children:"Evolution Stats"}),(0,n.jsxs)("div",{className:"ext-evolution-stats flex gap-8 justify-center",children:[(0,n.jsxs)("div",{className:"ext-stat-item flex flex-col items-center",children:[(0,n.jsx)("span",{className:"ext-stat-label text-[#888] text-sm",children:"Total Mutations"}),(0,n.jsx)("span",{className:"ext-stat-value text-lg font-bold",children:e.mutations?.length||0})]}),(0,n.jsxs)("div",{className:"ext-stat-item flex flex-col items-center",children:[(0,n.jsx)("span",{className:"ext-stat-label text-[#888] text-sm",children:"G√©n√©ration"}),(0,n.jsx)("span",{className:"ext-stat-value text-lg font-bold",children:e.generation})]}),(0,n.jsxs)("div",{className:"ext-stat-item flex flex-col items-center",children:[(0,n.jsx)("span",{className:"ext-stat-label text-[#888] text-sm",children:"√Çge"}),(0,n.jsxs)("span",{className:"ext-stat-value text-lg font-bold",children:[Math.floor((Date.now()-(e.createdAt??0))/36e5),"h"]})]})]})]})]}):null},x=v}}]);