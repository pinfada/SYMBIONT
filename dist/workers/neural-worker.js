(()=>{"use strict";var t,e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};e.r(o),e.d(o,{default:()=>u}),function(t){t[t.TRACE=0]="TRACE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.FATAL=5]="FATAL"}(t||(t={}));class n{constructor(e={}){this.logEntries=[],this.config={level:t.INFO,enableConsole:!this.isProduction(),enableStorage:!0,maxStorageEntries:1e3,sensitiveFields:["password","token","key","secret","auth"],productionMode:this.isProduction(),...e}}static getInstance(t){return n.instance||(n.instance=new n(t)),n.instance}isProduction(){return!0}sanitizeData(t){if("string"==typeof t)return this.sanitizeString(t);if("object"==typeof t&&null!==t){if(Array.isArray(t))return t.map((t=>this.sanitizeData(t)));const e={};for(const[o,n]of Object.entries(t))this.isSensitiveField(o)?e[o]="[REDACTED]":e[o]=this.sanitizeData(n);return e}return t}sanitizeString(t){let e=t;for(const t of n.SENSITIVE_PATTERNS)e=e.replace(t,"[REDACTED]");return e}isSensitiveField(t){return this.config.sensitiveFields.some((e=>t.toLowerCase().includes(e.toLowerCase())))}formatMessage(e,o,n,r){return`[${(new Date).toISOString()}] ${t[e]}${r?` [${r}]`:""}: ${o}${n?` ${JSON.stringify(n,null,2)}`:""}`}shouldLog(t){return t>=this.config.level}log(e,o,n,r){if(!this.shouldLog(e))return;const i=n?this.sanitizeData(n):void 0,s=this.sanitizeString(o),a={timestamp:Date.now(),level:e,message:s,data:i,context:r,sanitized:!0};if(this.config.enableStorage&&(this.logEntries.push(a),this.logEntries.length>this.config.maxStorageEntries&&(this.logEntries=this.logEntries.slice(-this.config.maxStorageEntries))),this.config.enableConsole){const o=this.formatMessage(e,s,i,r);switch(e){case t.TRACE:case t.DEBUG:console.debug(o);break;case t.INFO:console.info(o);break;case t.WARN:console.warn(o);break;case t.ERROR:case t.FATAL:console.error(o)}}}trace(e,o,n){this.log(t.TRACE,e,o,n)}debug(e,o,n){this.log(t.DEBUG,e,o,n)}info(e,o,n){this.log(t.INFO,e,o,n)}warn(e,o,n){this.log(t.WARN,e,o,n)}error(e,o,n){this.log(t.ERROR,e,o,n)}fatal(e,o,n){this.log(t.FATAL,e,o,n)}setLevel(t){this.config.level=t}enableConsole(t){this.config.enableConsole=t}getLogs(t){return void 0!==t?this.logEntries.filter((e=>e.level>=t)):[...this.logEntries]}clearLogs(){this.logEntries=[]}exportLogs(){return JSON.stringify(this.logEntries,null,2)}}n.SENSITIVE_PATTERNS=[/password/i,/token/i,/key/i,/secret/i,/auth/i,/credential/i,/session/i,/cookie/i,/jwt/i,/bearer/i,/api[_-]?key/i,/access[_-]?token/i,/refresh[_-]?token/i,/private[_-]?key/i,/\b[A-Za-z0-9+/]{32,}={0,2}\b/,/\b[0-9a-f]{32,}\b/i,/\b[0-9]{4}[_-]?[0-9]{4}[_-]?[0-9]{4}[_-]?[0-9]{4}\b/,/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/];const r=n.getInstance();var i,s;r.info.bind(r),r.warn.bind(r),r.error.bind(r),r.debug.bind(r),function(t){t.CRYPTOGRAPHIC="cryptographic",t.MODERATE="moderate",t.PERFORMANCE="performance"}(i||(i={})),function(t){t.NEURAL_NETWORK="neural_network",t.WEBGL_RENDERING="webgl_rendering",t.GENETIC_MUTATIONS="genetic_mutations",t.SOCIAL_EVENTS="social_events",t.CRYPTOGRAPHIC_OPS="cryptographic_ops",t.MONITORING="monitoring"}(s||(s={}));class a{constructor(t=123456789,e=987654321){this.state0=t,this.state1=e}random(){let t=this.state0;const e=this.state1;return this.state0=e,t^=t<<23,t^=t>>>17,t^=e,t^=e>>>26,this.state1=t,(e+t>>>0)/4294967296}reseed(){if("undefined"!=typeof crypto&&crypto.getRandomValues){const t=new Uint32Array(2);crypto.getRandomValues(t),this.state0=t[0],this.state1=t[1]}}}class c{constructor(t=1e4,e=2e3){this.pool=[],this.isRefilling=!1,this.totalGenerated=0,this.totalConsumed=0,this.poolSize=t,this.refillThreshold=e}async initialize(){await this.fillPool()}async fillPool(){if(!this.isRefilling){this.isRefilling=!0;try{const t=Math.min(5e3,this.poolSize-this.pool.length),e=new Uint32Array(t);if("undefined"!=typeof crypto&&crypto.getRandomValues){crypto.getRandomValues(e);for(const t of e)this.pool.push(t/4294967296);this.totalGenerated+=t}}catch(t){r.error("RandomPool: Erreur génération batch",{error:t})}finally{this.isRefilling=!1}}}getNext(){if(0===this.pool.length)return null;const t=this.pool.pop();return this.totalConsumed++,this.pool.length<=this.refillThreshold&&!this.isRefilling&&this.fillPool(),t}getStats(){return{poolSize:this.pool.length,totalGenerated:this.totalGenerated,totalConsumed:this.totalConsumed,hitRate:this.totalConsumed>0?(this.totalConsumed-this.pool.length)/this.totalConsumed:0,isRefilling:this.isRefilling}}}class l{constructor(){this.configs=new Map([[s.CRYPTOGRAPHIC_OPS,{securityLevel:i.CRYPTOGRAPHIC,poolSize:1e3,refillThreshold:200,batchGeneration:!0,metricsEnabled:!0}],[s.NEURAL_NETWORK,{securityLevel:i.PERFORMANCE,poolSize:5e4,refillThreshold:1e4,batchGeneration:!0,metricsEnabled:!0}],[s.WEBGL_RENDERING,{securityLevel:i.PERFORMANCE,poolSize:1e4,refillThreshold:2e3,batchGeneration:!0,metricsEnabled:!1}],[s.GENETIC_MUTATIONS,{securityLevel:i.MODERATE,poolSize:5e3,refillThreshold:1e3,batchGeneration:!0,metricsEnabled:!0}]]),this.metrics={totalCalls:0,secureCalls:0,poolCalls:0,fastCalls:0,avgLatencyMs:0,lastReseedTime:Date.now()},this.securePool=new c(1e4,2e3),this.fastPRNG=new a,this.initialize()}static getInstance(){return l.instance||(l.instance=new l),l.instance}async initialize(){await this.securePool.initialize(),setInterval((()=>{this.fastPRNG.reseed(),this.metrics.lastReseedTime=Date.now()}),3e5)}random(t=s.GENETIC_MUTATIONS){const e=performance.now();this.metrics.totalCalls++;const o=this.configs.get(t)||this.configs.get(s.GENETIC_MUTATIONS);let n;switch(o.securityLevel){case i.CRYPTOGRAPHIC:n=this.getSecureRandom(),this.metrics.secureCalls++;break;case i.MODERATE:n=this.getPooledRandom(),this.metrics.poolCalls++;break;case i.PERFORMANCE:n=this.getFastRandom(),this.metrics.fastCalls++;break;default:n=this.getPooledRandom(),this.metrics.poolCalls++}if(o.metricsEnabled){const t=performance.now()-e;this.metrics.avgLatencyMs=(this.metrics.avgLatencyMs+t)/2}return n}getSecureRandom(){if("undefined"!=typeof crypto&&crypto.getRandomValues){const t=new Uint32Array(1);return crypto.getRandomValues(t),t[0]/4294967296}return r.warn("HybridRandom: crypto.getRandomValues non disponible, fallback pool"),this.getPooledRandom()}getPooledRandom(){const t=this.securePool.getNext();return null!==t?t:(r.warn("HybridRandom: Pool vide, fallback crypto direct"),this.getSecureRandom())}getFastRandom(){return this.fastPRNG.random()}neuralRandom(){return this.random(s.NEURAL_NETWORK)}renderingRandom(){return this.random(s.WEBGL_RENDERING)}cryptoRandom(){return this.random(s.CRYPTOGRAPHIC_OPS)}mutationRandom(){return this.random(s.GENETIC_MUTATIONS)}async generateBatch(t,e){const o=this.configs.get(e);if(!o?.batchGeneration)return Array.from({length:t},(()=>this.random(e)));if(o.securityLevel===i.PERFORMANCE)return Array.from({length:t},(()=>this.fastPRNG.random()));{const e=new Uint32Array(t);return"undefined"!=typeof crypto&&crypto.getRandomValues?(crypto.getRandomValues(e),Array.from(e,(t=>t/4294967296))):Array.from({length:t},(()=>this.getSecureRandom()))}}getPerformanceMetrics(){return{...this.metrics,poolStats:this.securePool.getStats(),distribution:{secure:(this.metrics.secureCalls/this.metrics.totalCalls*100).toFixed(1)+"%",pooled:(this.metrics.poolCalls/this.metrics.totalCalls*100).toFixed(1)+"%",fast:(this.metrics.fastCalls/this.metrics.totalCalls*100).toFixed(1)+"%"}}}configureContext(t,e){const o=this.configs.get(t)||this.configs.get(s.GENETIC_MUTATIONS);this.configs.set(t,{...o,...e})}shutdown(){r.info("HybridRandomProvider: Arrêt avec métriques",this.getPerformanceMetrics())}}l.getInstance();class d{static random(){const t=this.detectUsageContext();return this.provider.random(t)}static detectUsageContext(){try{const t=(new Error).stack;return t?t.includes("NeuralMesh")||t.includes("NeuralCore")||t.includes("neural")||t.includes("evolve")||t.includes("mutate")?s.NEURAL_NETWORK:t.includes("WebGL")||t.includes("render")||t.includes("draw")||t.includes("Batcher")?s.WEBGL_RENDERING:t.includes("uuid")||t.includes("UUID")||t.includes("token")||t.includes("encrypt")||t.includes("crypto")?s.CRYPTOGRAPHIC_OPS:t.includes("Social")||t.includes("Mystical")||t.includes("Collective")?s.SOCIAL_EVENTS:t.includes("Monitor")||t.includes("Health")||t.includes("metrics")?s.MONITORING:s.GENETIC_MUTATIONS:s.GENETIC_MUTATIONS}catch{return s.GENETIC_MUTATIONS}}static randomInt(t,e){if(t>=e)throw new Error("PerformanceOptimizedRandom: min doit être inférieur à max");const o=e-t,n=this.detectUsageContext();return Math.floor(this.provider.random(n)*o)+t}static randomFloat(t,e){if(t>=e)throw new Error("PerformanceOptimizedRandom: min doit être inférieur à max");const o=this.detectUsageContext();return this.provider.random(o)*(e-t)+t}static async randomBatch(t,e){const o=e||this.detectUsageContext();return this.provider.generateBatch(t,o)}static randomBytes(t){const e=this.detectUsageContext();if(e!==s.CRYPTOGRAPHIC_OPS){const o=new Uint8Array(t);for(let n=0;n<t;n++)o[n]=Math.floor(256*this.provider.random(e));return o}if("undefined"!=typeof crypto&&crypto.getRandomValues){const e=new Uint8Array(t);return crypto.getRandomValues(e),e}r.warn("PerformanceOptimizedRandom: crypto.getRandomValues non disponible");const o=new Uint8Array(t);for(let e=0;e<t;e++)o[e]=Math.floor(256*this.provider.cryptoRandom());return o}static choice(t){if(0===t.length)throw new Error("PerformanceOptimizedRandom: Le tableau ne peut pas être vide");return t[this.randomInt(0,t.length)]}static uuid(){return this.generateSecureUUID()}static generateSecureUUID(){if("undefined"!=typeof crypto&&crypto.getRandomValues){const t=new Uint8Array(16);crypto.getRandomValues(t),t[6]=15&t[6]|64,t[8]=63&t[8]|128;const e=Array.from(t,(t=>t.toString(16).padStart(2,"0"))).join("");return[e.slice(0,8),e.slice(8,12),e.slice(12,16),e.slice(16,20),e.slice(20,32)].join("-")}return r.warn("PerformanceOptimizedRandom: crypto.getRandomValues non disponible, fallback provider"),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*this.provider.cryptoRandom()|0;return("x"===t?e:3&e|8).toString(16)}))}static randomString(t,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"){let o="";for(let n=0;n<t;n++)o+=e.charAt(this.randomInt(0,e.length));return o}static randomId(t="",e=8){const o=this.randomString(e,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");return t?`${t}_${o}`:o}static neuralRandom(){return this.provider.neuralRandom()}static renderingRandom(){return this.provider.renderingRandom()}static mutationRandom(){return this.provider.mutationRandom()}static cryptoRandom(){return this.provider.cryptoRandom()}static async neuralBatch(t){return this.provider.generateBatch(t,s.NEURAL_NETWORK)}static async renderingBatch(t){return this.provider.generateBatch(t,s.WEBGL_RENDERING)}static getPerformanceMetrics(){return this.provider.getPerformanceMetrics()}static configurePerformance(t,e){this.provider.configureContext(t,{securityLevel:e})}static async warmup(){r.info("PerformanceOptimizedRandom: Initialisation pools performance..."),await Promise.all([this.provider.generateBatch(1e3,s.NEURAL_NETWORK),this.provider.generateBatch(500,s.WEBGL_RENDERING),this.provider.generateBatch(300,s.GENETIC_MUTATIONS)]),r.info("PerformanceOptimizedRandom: Warmup terminé, performance optimale prête")}static async benchmarkVsSecureRandom(t=1e4){const e=performance.now();for(let e=0;e<t;e++){const t=new Uint32Array(1);"undefined"!=typeof crypto&&crypto.getRandomValues&&(crypto.getRandomValues(t),t[0],this.MAX_UINT32)}const o=performance.now()-e,n=performance.now();for(let e=0;e<t;e++)this.neuralRandom();const r=performance.now()-n,i=o/r;return{secureRandomMs:Math.round(100*o)/100,optimizedMs:Math.round(100*r)/100,speedupRatio:Math.round(10*i)/10,recommendation:i>100?`🚀 Gain massif ${i.toFixed(0)}x - Migration recommandée`:i>10?`⚡ Gain significatif ${i.toFixed(0)}x - Migration bénéfique`:`✅ Gain modéré ${i.toFixed(1)}x - Migration optionnelle`}}}d.provider=l.getInstance(),d.MAX_UINT32=4294967295,d.random,d.randomInt,d.randomFloat,d.neuralRandom,d.renderingRandom,d.mutationRandom,d.cryptoRandom;const h=new class{constructor(){this.networks=new Map}initializeNetwork(t,e,o){const n=new Map,r=new Map,i=new Map;e.forEach((t=>{n.set(t.id,{...t}),i.set(t.id,0)})),o.forEach((t=>{r.has(t.from)||r.set(t.from,[]),r.get(t.from).push({...t})})),this.networks.set(t,{nodes:n,connections:r,activations:i})}propagateNetwork(t,e){const o=this.networks.get(t);if(!o)throw new Error(`Network ${t} not found`);Object.entries(e).forEach((([t,e])=>{o.nodes.has(t)&&o.activations.set(t,e)}));for(const[t,e]of o.nodes)"input"!==e.type&&o.activations.set(t,e.bias);for(const[t,e]of o.connections){const n=o.activations.get(t)||0;for(const t of e){if(!t.active)continue;const e=(o.activations.get(t.to)||0)+n*t.weight;o.activations.set(t.to,this.sigmoid(e))}}return Object.fromEntries(o.activations)}mutateNetwork(t,e){const o=this.networks.get(t);if(!o)throw new Error(`Network ${t} not found`);let n=!1;for(const t of o.connections.values())for(const o of t)d.random()<e&&(o.weight+=.2*(d.random()-.5),o.weight=Math.max(-2,Math.min(2,o.weight)),n=!0);for(const t of o.nodes.values())d.random()<e&&(t.bias+=.1*(d.random()-.5),t.bias=Math.max(-1,Math.min(1,t.bias)),n=!0);return n}calculateNeuralActivity(t){const e=this.networks.get(t);if(!e)throw new Error(`Network ${t} not found`);let o=0,n=0;for(const t of e.activations.values())o+=Math.abs(t),n++;const r=n>0?o/n:0;let i=0,s=0;for(const t of e.connections.values())for(const e of t)e.active&&(i+=Math.abs(e.weight),s++);return{activity:r,connectionStrength:s>0?i/s:0,nodeCount:n,connectionCount:s}}sigmoid(t){return t>10?1:t<-10?0:1/(1+Math.exp(-t))}cleanupNetwork(t){return this.networks.delete(t)}getWorkerStats(){let t=0,e=0;return this.networks.forEach((o=>{t+=o.nodes.size,e+=Array.from(o.connections.values()).reduce(((t,e)=>t+e.length),0)})),{networkCount:this.networks.size,memoryUsage:64*(t+e)}}};self.onmessage=t=>{const e=performance.now(),{type:o,id:n,payload:r}=t.data;try{let t;switch(o){case"NEURAL_INIT":h.initializeNetwork(r.networkId,r.nodes,r.connections),t={success:!0};break;case"NEURAL_PROPAGATE":t=h.propagateNetwork(r.networkId,r.inputs);break;case"NEURAL_MUTATE":t=h.mutateNetwork(r.networkId,r.rate);break;case"NEURAL_ACTIVITY":t=h.calculateNeuralActivity(r.networkId);break;default:throw new Error(`Unknown message type: ${o}`)}const i={type:"NEURAL_RESULT",id:n,payload:t,processingTime:performance.now()-e};self.postMessage(i)}catch(t){const o=performance.now()-e,r={type:"NEURAL_ERROR",id:n,payload:{message:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0},processingTime:o};self.postMessage(r)}};const u=h;var m=self;for(var f in o)m[f]=o[f];o.__esModule&&Object.defineProperty(m,"__esModule",{value:!0})})();
//# sourceMappingURL=neural-worker.js.map