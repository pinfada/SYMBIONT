"use strict";(self.webpackChunksymbiont=self.webpackChunksymbiont||[]).push([[605],{605:(t,e,a)=>{a.d(e,{RealDataService:()=>s,realDataService:()=>c});var r=a(18),i=a(513);const o={USE_REAL_DNA:"true"===localStorage.getItem("symbiont_feature_real_dna"),USE_REAL_BEHAVIOR:"true"===localStorage.getItem("symbiont_feature_real_behavior"),USE_REAL_NETWORK:"true"===localStorage.getItem("symbiont_feature_real_network"),USE_BACKEND_API:"true"===localStorage.getItem("symbiont_feature_backend_api")},n=(()=>{const t=process.env.SYMBIONT_API_URL,e=process.env.SYMBIONT_WS_URL,a=process.env.SYMBIONT_API_KEY;if(!t||!a)throw new Error("Variables d'environnement SYMBIONT_API_URL et SYMBIONT_API_KEY obligatoires en production");if(a.length<32)throw new Error("SYMBIONT_API_KEY trop courte (minimum 32 caract√®res cryptographiquement s√©curis√©s)");return{BASE_URL:t,WS_URL:e||t.replace("http","ws").replace("/api",""),API_KEY:a}})();class s{constructor(){this.behaviorMetrics={domains:new Map,sessionTime:0,totalInteractions:0,scrollPatterns:[],timePatterns:[]},this.apiHeaders={"Content-Type":"application/json",Authorization:`Bearer ${n.API_KEY}`},this.initializeBehaviorTracking()}static getInstance(){return this.instance||(this.instance=new s),this.instance}async generateRealDNA(t){if(!o.USE_REAL_DNA)return"MOCKDNA123456789ABCDEF";try{const e=await this.collectUserBehaviors(t);return this.buildDNAFromBehaviors(e)}catch(t){return i.vF.warn("Erreur g√©n√©ration ADN r√©el, fallback mock:",t),"MOCKDNA123456789ABCDEF"}}async collectUserBehaviors(t){const e=await chrome.history.search({text:"",maxResults:100}),a={domains:new Map,sessionTime:0,totalInteractions:0,scrollPatterns:[],timePatterns:[]};for(const t of e)if(t.url){const e=new URL(t.url).hostname,r=a.domains.get(e)||{visits:0,totalTime:0,lastVisit:0,category:await this.categorizeWebsite(e),interactions:[]};r.visits+=t.visitCount||1,r.lastVisit=t.lastVisitTime||Date.now(),a.domains.set(e,r)}return a}buildDNAFromBehaviors(t){const e={social:"ATCG",work:"GCTA",entertainment:"CGAT",education:"TACG",news:"AGCT",shopping:"TGCA",other:"CTAG"};let a="";const r=new Map;for(const[e,a]of t.domains){const t=r.get(a.category)||0;r.set(a.category,t+a.visits)}const i=Array.from(r.values()).reduce(((t,e)=>t+e),0);for(const[t,o]of r){const r=o/i,n=e[t]||e.other,s=Math.floor(16*r);for(let t=0;t<s;t++)a+=n[t%n.length]}return a+=Date.now().toString(36).toUpperCase().slice(-8),a.padEnd(64,"X").slice(0,64)}async categorizeWebsite(t){return{"facebook.com":"social","twitter.com":"social","linkedin.com":"social","instagram.com":"social","youtube.com":"entertainment","netflix.com":"entertainment","twitch.tv":"entertainment","github.com":"work","stackoverflow.com":"work","google.com":"other","wikipedia.org":"education","coursera.org":"education","amazon.com":"shopping","news.google.com":"news","bbc.com":"news"}[t]||"other"}async getRealInvitations(t){if(!o.USE_BACKEND_API){const{MockInvitationService:t}=await a.e(966).then(a.bind(a,966));return{userCode:await t.getUserCode(),inviter:await t.getInviter(),invitees:await t.getInvitees(),history:await t.getHistory()}}try{const e=await fetch(`${n.BASE_URL}/invitations/user/${t}`,{headers:this.apiHeaders});if(!e.ok)throw new Error("API Error");return await e.json()}catch(t){i.vF.warn("Erreur API invitations, fallback mock:",t);const{MockInvitationService:e}=await a.e(966).then(a.bind(a,966));return{userCode:await e.getUserCode(),inviter:await e.getInviter(),invitees:await e.getInvitees(),history:await e.getHistory()}}}async getRealSystemMetrics(){if(!o.USE_REAL_BEHAVIOR)return{cpu:.2*r.Dm.random(),memory:20*r.Dm.random(),latency:5*r.Dm.random()};try{const t=await this.getMemoryUsage();return{cpu:await this.getCPUUsage(),memory:t,latency:await this.getNetworkLatency()}}catch(t){return i.vF.warn("Erreur m√©triques r√©elles, fallback mock:",t),{cpu:.2*r.Dm.random(),memory:20*r.Dm.random(),latency:5*r.Dm.random()}}}async getMemoryUsage(){return"memory"in performance?(await performance.measureUserAgentSpecificMemory()).bytes/1048576:20*r.Dm.random()}async getCPUUsage(){return new Promise((t=>{const e=performance.now();for(let t=0;t<1e4;t++)r.Dm.random(),r.Dm.random();const a=performance.now()-e;t(Math.min(a/10,1))}))}async getNetworkLatency(){try{const t=performance.now();return await fetch("/favicon.ico",{method:"HEAD"}),performance.now()-t}catch{return 5*r.Dm.random()}}initializeBehaviorTracking(){o.USE_REAL_BEHAVIOR&&(chrome.runtime.onMessage.addListener(((t,e,a)=>{"behavior_data"===t.type&&(this.processBehaviorData(t.data),a({status:"received"}))})),chrome.tabs.onActivated.addListener((t=>{this.trackTabChange(t.tabId)})),chrome.webNavigation.onCompleted.addListener((t=>{0===t.frameId&&this.trackNavigation(t.url,t.tabId)})))}processBehaviorData(t){const e=t,a=new URL(e.url).hostname,r=this.behaviorMetrics.domains.get(a)||{visits:0,totalTime:0,lastVisit:Date.now(),category:"other",interactions:[]};r.totalTime+=e.timeSpent||0,r.interactions.push(...e.interactions||[]),r.lastVisit=Date.now(),this.behaviorMetrics.domains.set(a,r),this.behaviorMetrics.totalInteractions+=e.interactions?.length||0}trackTabChange(t){chrome.tabs.get(t,(t=>{t.url&&i.vF.info("Tab changed to:",new URL(t.url).hostname)}))}trackNavigation(t,e){const a=new URL(t).hostname,r=this.behaviorMetrics.domains.get(a)||{visits:0,totalTime:0,lastVisit:Date.now(),category:"other",interactions:[]};r.visits+=1,r.lastVisit=Date.now(),this.behaviorMetrics.domains.set(a,r)}static enableFeature(t){const e=this.getFeatureKey(t);localStorage.setItem(e,"true"),o[t]=!0}static disableFeature(t){const e=this.getFeatureKey(t);localStorage.setItem(e,"false"),o[t]=!1}static getFeatureKey(t){return`symbiont_feature_${t.replace("USE_","").toLowerCase()}`}static getFeatureStatus(){return{...o}}async migrateToRealData(t){i.vF.info("üöÄ D√©marrage migration vers vraies donn√©es...");try{const e=await this.generateRealDNA(t),a=JSON.parse(localStorage.getItem("symbiont_organism")||"{}"),r={...a,dna:e,visualDNA:e,lastMutation:Date.now(),mutations:[...a.mutations||[],{type:"behavioral_evolution",trigger:"real_data_migration",magnitude:.8,timestamp:Date.now(),description:"Migration vers donn√©es comportementales r√©elles"}]};localStorage.setItem("symbiont_organism",JSON.stringify(r)),i.vF.info("‚úÖ Migration r√©ussie:",e)}catch(t){throw i.vF.error("‚ùå Erreur migration:",t),t}}}const c=s.getInstance()}}]);