"use strict";(self.webpackChunksymbiont=self.webpackChunksymbiont||[]).push([[605],{605:(t,e,a)=>{a.d(e,{RealDataService:()=>n,realDataService:()=>s});const o={USE_REAL_DNA:"true"===localStorage.getItem("symbiont_feature_real_dna"),USE_REAL_BEHAVIOR:"true"===localStorage.getItem("symbiont_feature_real_behavior"),USE_REAL_NETWORK:"true"===localStorage.getItem("symbiont_feature_real_network"),USE_BACKEND_API:"true"===localStorage.getItem("symbiont_feature_backend_api")},r=process.env.SYMBIONT_API_URL||"http://localhost:3001/api",i=(process.env.SYMBIONT_WS_URL,process.env.SYMBIONT_API_KEY||"demo-key");class n{constructor(){this.behaviorMetrics={domains:new Map,sessionTime:0,totalInteractions:0,scrollPatterns:[],timePatterns:[]},this.apiHeaders={"Content-Type":"application/json",Authorization:`Bearer ${i}`},this.initializeBehaviorTracking()}static getInstance(){return this.instance||(this.instance=new n),this.instance}async generateRealDNA(t){if(!o.USE_REAL_DNA)return"MOCKDNA123456789ABCDEF";try{const e=await this.collectUserBehaviors(t);return this.buildDNAFromBehaviors(e)}catch(t){return console.warn("Erreur g√©n√©ration ADN r√©el, fallback mock:",t),"MOCKDNA123456789ABCDEF"}}async collectUserBehaviors(t){const e=await chrome.history.search({text:"",maxResults:100}),a={domains:new Map,sessionTime:0,totalInteractions:0,scrollPatterns:[],timePatterns:[]};for(const t of e)if(t.url){const e=new URL(t.url).hostname,o=a.domains.get(e)||{visits:0,totalTime:0,lastVisit:0,category:await this.categorizeWebsite(e),interactions:[]};o.visits+=t.visitCount||1,o.lastVisit=t.lastVisitTime||Date.now(),a.domains.set(e,o)}return a}buildDNAFromBehaviors(t){const e={social:"ATCG",work:"GCTA",entertainment:"CGAT",education:"TACG",news:"AGCT",shopping:"TGCA",other:"CTAG"};let a="";const o=new Map;for(const[e,a]of t.domains){const t=o.get(a.category)||0;o.set(a.category,t+a.visits)}const r=Array.from(o.values()).reduce(((t,e)=>t+e),0);for(const[t,i]of o){const o=i/r,n=e[t]||e.other,s=Math.floor(16*o);for(let t=0;t<s;t++)a+=n[t%n.length]}return a+=Date.now().toString(36).toUpperCase().slice(-8),a.padEnd(64,"X").slice(0,64)}async categorizeWebsite(t){return{"facebook.com":"social","twitter.com":"social","linkedin.com":"social","instagram.com":"social","youtube.com":"entertainment","netflix.com":"entertainment","twitch.tv":"entertainment","github.com":"work","stackoverflow.com":"work","google.com":"other","wikipedia.org":"education","coursera.org":"education","amazon.com":"shopping","news.google.com":"news","bbc.com":"news"}[t]||"other"}async getRealInvitations(t){if(!o.USE_BACKEND_API){const{MockInvitationService:t}=await a.e(966).then(a.bind(a,966));return{userCode:await t.getUserCode(),inviter:await t.getInviter(),invitees:await t.getInvitees(),history:await t.getHistory()}}try{const e=await fetch(`${r}/invitations/user/${t}`,{headers:this.apiHeaders});if(!e.ok)throw new Error("API Error");return await e.json()}catch(t){console.warn("Erreur API invitations, fallback mock:",t);const{MockInvitationService:e}=await a.e(966).then(a.bind(a,966));return{userCode:await e.getUserCode(),inviter:await e.getInviter(),invitees:await e.getInvitees(),history:await e.getHistory()}}}async getRealSystemMetrics(){if(!o.USE_REAL_BEHAVIOR)return{cpu:.2*Math.random(),memory:20*Math.random(),latency:5*Math.random()};try{const t=await this.getMemoryUsage();return{cpu:await this.getCPUUsage(),memory:t,latency:await this.getNetworkLatency()}}catch(t){return console.warn("Erreur m√©triques r√©elles, fallback mock:",t),{cpu:.2*Math.random(),memory:20*Math.random(),latency:5*Math.random()}}}async getMemoryUsage(){return"memory"in performance?(await performance.measureUserAgentSpecificMemory()).bytes/1048576:20*Math.random()}async getCPUUsage(){return new Promise((t=>{const e=performance.now();for(let t=0;t<1e4;t++)Math.random(),Math.random();const a=performance.now()-e;t(Math.min(a/10,1))}))}async getNetworkLatency(){try{const t=performance.now();return await fetch("/favicon.ico",{method:"HEAD"}),performance.now()-t}catch{return 5*Math.random()}}initializeBehaviorTracking(){o.USE_REAL_BEHAVIOR&&(chrome.runtime.onMessage.addListener(((t,e,a)=>{"behavior_data"===t.type&&(this.processBehaviorData(t.data),a({status:"received"}))})),chrome.tabs.onActivated.addListener((t=>{this.trackTabChange(t.tabId)})),chrome.webNavigation.onCompleted.addListener((t=>{0===t.frameId&&this.trackNavigation(t.url,t.tabId)})))}processBehaviorData(t){const e=new URL(t.url).hostname,a=this.behaviorMetrics.domains.get(e)||{visits:0,totalTime:0,lastVisit:Date.now(),category:"other",interactions:[]};a.totalTime+=t.timeSpent||0,a.interactions.push(...t.interactions||[]),a.lastVisit=Date.now(),this.behaviorMetrics.domains.set(e,a),this.behaviorMetrics.totalInteractions+=t.interactions?.length||0}trackTabChange(t){chrome.tabs.get(t,(t=>{t.url&&console.log("Tab changed to:",new URL(t.url).hostname)}))}trackNavigation(t,e){const a=new URL(t).hostname,o=this.behaviorMetrics.domains.get(a)||{visits:0,totalTime:0,lastVisit:Date.now(),category:"other",interactions:[]};o.visits+=1,o.lastVisit=Date.now(),this.behaviorMetrics.domains.set(a,o)}static enableFeature(t){localStorage.setItem(`symbiont_feature_${t.toLowerCase()}`,"true"),location.reload()}static disableFeature(t){localStorage.setItem(`symbiont_feature_${t.toLowerCase()}`,"false"),location.reload()}static getFeatureStatus(){return{...o}}async migrateToRealData(t){console.log("üöÄ D√©marrage migration vers vraies donn√©es...");try{const e=await this.generateRealDNA(t),a=JSON.parse(localStorage.getItem("symbiont_organism")||"{}"),o={...a,dna:e,visualDNA:e,lastMutation:Date.now(),mutations:[...a.mutations||[],{type:"behavioral_evolution",trigger:"real_data_migration",magnitude:.8,timestamp:Date.now(),description:"Migration vers donn√©es comportementales r√©elles"}]};localStorage.setItem("symbiont_organism",JSON.stringify(o)),console.log("‚úÖ Migration r√©ussie:",e)}catch(t){throw console.error("‚ùå Erreur migration:",t),t}}}const s=n.getInstance()}}]);