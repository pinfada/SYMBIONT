"use strict";(self.webpackChunksymbiont=self.webpackChunksymbiont||[]).push([[824],{526:(e,t,s)=>{s.d(t,{p:()=>n});class n{constructor(){this.db=null,this.DB_NAME="symbiont-db",this.DB_VERSION=3}async initialize(){return new Promise(((e,t)=>{const s=indexedDB.open(this.DB_NAME,this.DB_VERSION);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("organisms")){const e=t.createObjectStore("organisms",{keyPath:"id"});e.createIndex("generation","generation",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1})}if(!t.objectStoreNames.contains("behaviors")){const e=t.createObjectStore("behaviors",{keyPath:"url"});e.createIndex("lastVisit","lastVisit",{unique:!1}),e.createIndex("visitCount","visitCount",{unique:!1})}if(!t.objectStoreNames.contains("mutations")){const e=t.createObjectStore("mutations",{keyPath:"id",autoIncrement:!0});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("type","type",{unique:!1})}if(t.objectStoreNames.contains("settings")||t.createObjectStore("settings",{keyPath:"key"}),!t.objectStoreNames.contains("invitations")){const e=t.createObjectStore("invitations",{keyPath:"code"});e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("status","status",{unique:!1})}}}))}async getOrganism(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["organisms"],"readonly").objectStore("organisms");if(e){const r=n.get(e);r.onsuccess=()=>t(r.result||null),r.onerror=()=>s(r.error)}else{const e=n.openCursor();e.onsuccess=e=>{const s=e.target.result;t(s?s.value:null)},e.onerror=()=>s(e.error)}}))}async saveOrganism(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["organisms"],"readwrite").objectStore("organisms").put(e);n.onsuccess=()=>t(),n.onerror=()=>s(n.error)}))}async getBehavior(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").get(e);n.onsuccess=()=>t(n.result||null),n.onerror=()=>s(n.error)}))}async saveBehavior(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["behaviors"],"readwrite").objectStore("behaviors").put(e);n.onsuccess=()=>t(),n.onerror=()=>s(n.error)}))}async addMutation(e){if(!this.db)throw new Error("Database not initialized");const t={...e,timestamp:e.timestamp||Date.now()};return new Promise(((e,s)=>{const n=this.db.transaction(["mutations"],"readwrite").objectStore("mutations").add(t);n.onsuccess=()=>e(),n.onerror=()=>s(n.error)}))}async getRecentMutations(e=10){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["mutations"],"readonly").objectStore("mutations").index("timestamp").openCursor(null,"prev"),r=[];n.onsuccess=s=>{const n=s.target.result;n&&r.length<e?(r.push(n.value),n.continue()):t(r)},n.onerror=()=>s(n.error)}))}async getSetting(e,t){if(!this.db)throw new Error("Database not initialized");return new Promise(((s,n)=>{const r=this.db.transaction(["settings"],"readonly").objectStore("settings").get(e);r.onsuccess=()=>{const e=r.result;s(e?e.value:t)},r.onerror=()=>n(r.error)}))}async setSetting(e,t){if(!this.db)throw new Error("Database not initialized");return new Promise(((s,n)=>{const r=this.db.transaction(["settings"],"readwrite").objectStore("settings").put({key:e,value:t});r.onsuccess=()=>s(),r.onerror=()=>n(r.error)}))}async addInvitation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["invitations"],"readwrite").objectStore("invitations").add({...e,createdAt:e.createdAt||Date.now()});n.onsuccess=()=>t(),n.onerror=()=>s(n.error)}))}async updateInvitation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["invitations"],"readwrite").objectStore("invitations").put(e);n.onsuccess=()=>t(),n.onerror=()=>s(n.error)}))}async getInvitation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction(["invitations"],"readonly").objectStore("invitations").get(e);n.onsuccess=()=>t(n.result||null),n.onerror=()=>s(n.error)}))}async getAllInvitations(){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,t)=>{const s=this.db.transaction(["invitations"],"readonly").objectStore("invitations").openCursor(),n=[];s.onsuccess=t=>{const s=t.target.result;s?(n.push(s.value),s.continue()):e(n)},s.onerror=()=>t(s.error)}))}async getBehaviorPatterns(){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,t)=>{const s=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").openCursor(),n=[];s.onsuccess=t=>{const s=t.target.result;s?(n.push(s.value),s.continue()):(n.sort(((e,t)=>t.visitCount!==e.visitCount?t.visitCount-e.visitCount:t.lastVisit-e.lastVisit)),e(n))},s.onerror=()=>t(s.error)}))}async getRecentActivity(e=864e5){if(!this.db)throw new Error("Database not initialized");const t=Date.now()-e;return new Promise(((e,s)=>{const n=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").openCursor(),r=[];n.onsuccess=s=>{const n=s.target.result;if(n){const e=n.value,s=(e.interactions||[]).filter((e=>e.timestamp>=t));for(const t of s)r.push({...t,url:e.url});n.continue()}else r.sort(((e,t)=>t.timestamp-e.timestamp)),e(r)},n.onerror=()=>s(n.error)}))}async cleanup(e=30){if(!this.db)throw new Error("Database not initialized");const t=Date.now()-24*e*60*60*1e3;return new Promise(((e,s)=>{const n=this.db.transaction(["mutations"],"readwrite").objectStore("mutations").index("timestamp"),r=IDBKeyRange.upperBound(t),a=n.openCursor(r);a.onsuccess=t=>{const s=t.target.result;s?(s.delete(),s.continue()):e()},a.onerror=()=>s(a.error)}))}close(){this.db&&(this.db.close(),this.db=null)}}},824:(e,t,s)=>{s.r(t),s.d(t,{SettingsPanel:()=>o,default:()=>c});var n=s(848),r=s(540),a=s(526),i=s(513);const o=()=>{const{theme:e,setTheme:t}=(()=>{const[e,t]=(0,r.useState)("auto");return(0,r.useEffect)((()=>{chrome.storage.local.get(["theme"],(e=>{e.theme&&t(e.theme)}))}),[]),(0,r.useEffect)((()=>{const t=()=>{const t=window.matchMedia("(prefers-color-scheme: dark)").matches,s="auto"===e?t?"dark":"light":e;document.documentElement.setAttribute("data-theme",s)};t();const s=window.matchMedia("(prefers-color-scheme: dark)");return s.addEventListener("change",t),()=>s.removeEventListener("change",t)}),[e]),{theme:e,setTheme:e=>{t(e),chrome.storage.local.set({theme:e})}}})(),[o,c]=(0,r.useState)({theme:"auto",notifications:!0,autoMutate:!1,mutationSpeed:1,visualQuality:"high"}),[l,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)({USE_REAL_DNA:!1,USE_REAL_BEHAVIOR:!1,USE_REAL_NETWORK:!1,USE_BACKEND_API:!1});(0,r.useEffect)((()=>{m(),b()}),[]);const m=async()=>{const e=new a.p;await e.initialize();const t=await e.getSetting("userPreferences",o);t&&c(t)},b=async()=>{try{const{RealDataService:e}=await s.e(605).then(s.bind(s,605)),t=e.getFeatureStatus();h(t)}catch(e){i.vF.warn("Impossible de charger les feature flags:",e)}},g=(e,t)=>{c((s=>({...s,[e]:t})))},x=async e=>{try{const{RealDataService:t}=await s.e(605).then(s.bind(s,605)),n=u[e];n?t.disableFeature(e):t.enableFeature(e),h((t=>({...t,[e]:!n}))),"USE_BACKEND_API"===e&&setTimeout((()=>window.location.reload()),100)}catch(e){i.vF.error("Erreur toggle feature flag:",e)}};return(0,n.jsxs)("div",{className:"ext-settings-panel max-w-lg mx-auto p-6 bg-white rounded-xl shadow-lg mt-8",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-center text-[#00e0ff] mb-6",children:"Paramètres"}),(0,n.jsxs)("section",{className:"ext-settings-section mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-[#00e0ff] mb-2",children:"Préférences utilisateur"}),(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:o.notifications,onChange:e=>g("notifications",e.target.checked)})," Notifications"]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:o.autoMutate,onChange:e=>g("autoMutate",e.target.checked)})," Mutation automatique"]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:["Qualité visuelle :",(0,n.jsxs)("select",{value:o.visualQuality,onChange:e=>g("visualQuality",e.target.value),className:"ml-2 rounded-md border px-2 py-1",children:[(0,n.jsx)("option",{value:"high",children:"Haute"}),(0,n.jsx)("option",{value:"medium",children:"Moyenne"}),(0,n.jsx)("option",{value:"low",children:"Basse"})]})]})]})]}),(0,n.jsxs)("section",{className:"ext-settings-section",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-[#00e0ff] mb-2",children:"Thème"}),(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)("button",{onClick:()=>t("light"),className:"rounded-lg px-4 py-2 font-bold "+("light"===e?"bg-[#00e0ff] text-[#181c22]":"bg-[#eaf6fa] text-[#232946]"),children:"Clair"}),(0,n.jsx)("button",{onClick:()=>t("dark"),className:"rounded-lg px-4 py-2 font-bold "+("dark"===e?"bg-[#00e0ff] text-[#181c22]":"bg-[#232946] text-white"),children:"Sombre"}),(0,n.jsx)("button",{onClick:()=>t("auto"),className:"rounded-lg px-4 py-2 font-bold "+("auto"===e?"bg-[#00e0ff] text-[#181c22]":"bg-[#888] text-white"),children:"Auto"})]})]}),(0,n.jsxs)("section",{className:"ext-settings-section",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-[#00e0ff] mb-2",children:"💾 Données"}),(0,n.jsx)("div",{className:"flex flex-col gap-4",children:(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:l,onChange:e=>d(e.target.checked)})," Sauvegarde automatique"]})})]}),(0,n.jsxs)("section",{className:"ext-settings-section",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-[#00e0ff] mb-2",children:"🚀 Données Réelles (Mode Avancé)"}),(0,n.jsxs)("p",{className:"section-description",children:["Activez progressivement les vraies données pour remplacer le mode démo.",(0,n.jsx)("br",{}),"⚠️ Nécessite un rechargement de l'extension après activation."]}),(0,n.jsxs)("div",{className:"feature-flags-grid",children:[(0,n.jsxs)("div",{className:"feature-flag-item",children:[(0,n.jsxs)("div",{className:"flag-info",children:[(0,n.jsx)("h4",{children:"🧬 ADN Comportemental"}),(0,n.jsx)("p",{children:"Génère l'ADN basé sur vos vrais patterns de navigation"})]}),(0,n.jsxs)("label",{className:"toggle-switch",children:[(0,n.jsx)("input",{type:"checkbox",checked:u.USE_REAL_DNA,onChange:()=>x("USE_REAL_DNA").catch(console.error)}),(0,n.jsx)("span",{className:"toggle-slider"})]})]}),(0,n.jsxs)("div",{className:"feature-flag-item",children:[(0,n.jsxs)("div",{className:"flag-info",children:[(0,n.jsx)("h4",{children:"📊 Métriques Système"}),(0,n.jsx)("p",{children:"Collecte les vraies métriques de performance du navigateur"})]}),(0,n.jsxs)("label",{className:"toggle-switch",children:[(0,n.jsx)("input",{type:"checkbox",checked:u.USE_REAL_BEHAVIOR,onChange:()=>x("USE_REAL_BEHAVIOR").catch(console.error)}),(0,n.jsx)("span",{className:"toggle-slider"})]})]}),(0,n.jsxs)("div",{className:"feature-flag-item",children:[(0,n.jsxs)("div",{className:"flag-info",children:[(0,n.jsx)("h4",{children:"🌐 Réseau Social"}),(0,n.jsx)("p",{children:"Connecte au réseau SYMBIONT réel (nécessite backend)"})]}),(0,n.jsxs)("label",{className:"toggle-switch",children:[(0,n.jsx)("input",{type:"checkbox",checked:u.USE_REAL_NETWORK,onChange:()=>x("USE_REAL_NETWORK").catch(console.error)}),(0,n.jsx)("span",{className:"toggle-slider"})]})]}),(0,n.jsxs)("div",{className:"feature-flag-item",children:[(0,n.jsxs)("div",{className:"flag-info",children:[(0,n.jsx)("h4",{children:"🔌 API Backend"}),(0,n.jsx)("p",{children:"Utilise l'API serveur pour synchroniser les données"})]}),(0,n.jsxs)("label",{className:"toggle-switch",children:[(0,n.jsx)("input",{type:"checkbox",checked:u.USE_BACKEND_API,onChange:()=>x("USE_BACKEND_API").catch(console.error)}),(0,n.jsx)("span",{className:"toggle-slider"})]})]})]}),(0,n.jsxs)("div",{className:"migration-actions",children:[(0,n.jsx)("button",{onClick:async()=>{try{const{realDataService:e}=await s.e(605).then(s.bind(s,605)),t=localStorage.getItem("symbiont_user_id")||"default-user";await e.migrateToRealData(t),alert("✅ Migration vers vraies données réussie ! Rechargez l'extension.")}catch(e){i.vF.error("Erreur migration:",e),alert("❌ Erreur lors de la migration. Voir console.")}},className:"btn-primary migration-btn",disabled:!u.USE_REAL_DNA,children:"🔄 Migrer vers Vraies Données"}),(0,n.jsx)("p",{className:"migration-note",children:"Cette action génère un nouvel ADN basé sur vos données de navigation réelles"})]})]}),(0,n.jsx)("div",{className:"flex justify-end mt-6",children:(0,n.jsx)("button",{onClick:async()=>{const e=new a.p;await e.initialize(),await e.setSetting("userPreferences",o)},className:"bg-[#00e0ff] text-[#181c22] rounded-lg px-5 py-2 font-bold cursor-pointer",children:"Enregistrer"})})]})},c=o}}]);