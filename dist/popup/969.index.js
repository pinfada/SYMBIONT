"use strict";(self.webpackChunksymbiont=self.webpackChunksymbiont||[]).push([[969],{526:(t,e,s)=>{s.d(e,{p:()=>n});class n{constructor(){this.db=null,this.DB_NAME="symbiont-db",this.DB_VERSION=3}async initialize(){return new Promise(((t,e)=>{const s=indexedDB.open(this.DB_NAME,this.DB_VERSION);s.onerror=()=>e(s.error),s.onsuccess=()=>{this.db=s.result,t()},s.onupgradeneeded=t=>{const e=t.target.result;if(!e.objectStoreNames.contains("organisms")){const t=e.createObjectStore("organisms",{keyPath:"id"});t.createIndex("generation","generation",{unique:!1}),t.createIndex("createdAt","createdAt",{unique:!1})}if(!e.objectStoreNames.contains("behaviors")){const t=e.createObjectStore("behaviors",{keyPath:"url"});t.createIndex("lastVisit","lastVisit",{unique:!1}),t.createIndex("visitCount","visitCount",{unique:!1})}if(!e.objectStoreNames.contains("mutations")){const t=e.createObjectStore("mutations",{keyPath:"id",autoIncrement:!0});t.createIndex("timestamp","timestamp",{unique:!1}),t.createIndex("type","type",{unique:!1})}if(e.objectStoreNames.contains("settings")||e.createObjectStore("settings",{keyPath:"key"}),!e.objectStoreNames.contains("invitations")){const t=e.createObjectStore("invitations",{keyPath:"code"});t.createIndex("createdAt","createdAt",{unique:!1}),t.createIndex("status","status",{unique:!1})}}}))}async getOrganism(t){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,s)=>{const n=this.db.transaction(["organisms"],"readonly").objectStore("organisms");if(t){const r=n.get(t);r.onsuccess=()=>e(r.result||null),r.onerror=()=>s(r.error)}else{const t=n.openCursor();t.onsuccess=t=>{const s=t.target.result;e(s?s.value:null)},t.onerror=()=>s(t.error)}}))}async saveOrganism(t){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,s)=>{const n=this.db.transaction(["organisms"],"readwrite").objectStore("organisms").put(t);n.onsuccess=()=>e(),n.onerror=()=>s(n.error)}))}async getBehavior(t){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,s)=>{const n=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").get(t);n.onsuccess=()=>e(n.result||null),n.onerror=()=>s(n.error)}))}async saveBehavior(t){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,s)=>{const n=this.db.transaction(["behaviors"],"readwrite").objectStore("behaviors").put(t);n.onsuccess=()=>e(),n.onerror=()=>s(n.error)}))}async addMutation(t){if(!this.db)throw new Error("Database not initialized");const e={...t,timestamp:t.timestamp||Date.now()};return new Promise(((t,s)=>{const n=this.db.transaction(["mutations"],"readwrite").objectStore("mutations").add(e);n.onsuccess=()=>t(),n.onerror=()=>s(n.error)}))}async getRecentMutations(t=10){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,s)=>{const n=this.db.transaction(["mutations"],"readonly").objectStore("mutations").index("timestamp").openCursor(null,"prev"),r=[];n.onsuccess=s=>{const n=s.target.result;n&&r.length<t?(r.push(n.value),n.continue()):e(r)},n.onerror=()=>s(n.error)}))}async getSetting(t,e){if(!this.db)throw new Error("Database not initialized");return new Promise(((s,n)=>{const r=this.db.transaction(["settings"],"readonly").objectStore("settings").get(t);r.onsuccess=()=>{const t=r.result;s(t?t.value:e)},r.onerror=()=>n(r.error)}))}async setSetting(t,e){if(!this.db)throw new Error("Database not initialized");return new Promise(((s,n)=>{const r=this.db.transaction(["settings"],"readwrite").objectStore("settings").put({key:t,value:e});r.onsuccess=()=>s(),r.onerror=()=>n(r.error)}))}async addInvitation(t){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,s)=>{const n=this.db.transaction(["invitations"],"readwrite").objectStore("invitations").add({...t,createdAt:t.createdAt||Date.now()});n.onsuccess=()=>e(),n.onerror=()=>s(n.error)}))}async updateInvitation(t){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,s)=>{const n=this.db.transaction(["invitations"],"readwrite").objectStore("invitations").put(t);n.onsuccess=()=>e(),n.onerror=()=>s(n.error)}))}async getInvitation(t){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,s)=>{const n=this.db.transaction(["invitations"],"readonly").objectStore("invitations").get(t);n.onsuccess=()=>e(n.result||null),n.onerror=()=>s(n.error)}))}async getAllInvitations(){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,e)=>{const s=this.db.transaction(["invitations"],"readonly").objectStore("invitations").openCursor(),n=[];s.onsuccess=e=>{const s=e.target.result;s?(n.push(s.value),s.continue()):t(n)},s.onerror=()=>e(s.error)}))}async getBehaviorPatterns(){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,e)=>{const s=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").openCursor(),n=[];s.onsuccess=e=>{const s=e.target.result;s?(n.push(s.value),s.continue()):(n.sort(((t,e)=>e.visitCount!==t.visitCount?e.visitCount-t.visitCount:e.lastVisit-t.lastVisit)),t(n))},s.onerror=()=>e(s.error)}))}async getRecentActivity(t=864e5){if(!this.db)throw new Error("Database not initialized");const e=Date.now()-t;return new Promise(((t,s)=>{const n=this.db.transaction(["behaviors"],"readonly").objectStore("behaviors").openCursor(),r=[];n.onsuccess=s=>{const n=s.target.result;if(n){const t=n.value,s=(t.interactions||[]).filter((t=>t.timestamp>=e));for(const e of s)r.push({...e,url:t.url});n.continue()}else r.sort(((t,e)=>e.timestamp-t.timestamp)),t(r)},n.onerror=()=>s(n.error)}))}async cleanup(t=30){if(!this.db)throw new Error("Database not initialized");const e=Date.now()-24*t*60*60*1e3;return new Promise(((t,s)=>{const n=this.db.transaction(["mutations"],"readwrite").objectStore("mutations").index("timestamp"),r=IDBKeyRange.upperBound(e),i=n.openCursor(r);i.onsuccess=e=>{const s=e.target.result;s?(s.delete(),s.continue()):t()},i.onerror=()=>s(i.error)}))}close(){this.db&&(this.db.close(),this.db=null)}}},969:(t,e,s)=>{s.r(e),s.d(e,{MetricsPanel:()=>x,default:()=>p});var n=s(848),r=s(540);const i=({data:t})=>t&&0!==t.length?(0,n.jsx)("div",{className:"behavior-patterns",children:(0,n.jsx)("ul",{className:"behavior-list",children:t.map((t=>(0,n.jsxs)("li",{className:"behavior-item",children:[(0,n.jsxs)("div",{className:"behavior-item__header",children:[(0,n.jsx)("span",{className:`behavior-type behavior-type--${t.type}`,children:t.type}),(0,n.jsxs)("span",{className:"behavior-confidence",children:[Math.round(100*t.confidence),"%"]})]}),(0,n.jsx)("p",{className:"behavior-description",children:t.description}),(0,n.jsx)("div",{className:"behavior-timestamp",children:a(t.lastSeen)})]},t.id)))})}):(0,n.jsx)("div",{className:"behavior-patterns--empty",children:(0,n.jsx)("p",{children:"No behavior patterns detected yet"})}),a=t=>{const e=Date.now()-t;if(e<6e4)return"just now";if(e<36e5){const t=Math.floor(e/6e4);return`${t} minute${1!==t?"s":""} ago`}if(e<864e5){const t=Math.floor(e/36e5);return`${t} hour${1!==t?"s":""} ago`}{const t=Math.floor(e/864e5);return`${t} day${1!==t?"s":""} ago`}},o=({data:t})=>{if(!t||0===t.length)return(0,n.jsx)("div",{className:"activity-timeline--empty",children:(0,n.jsx)("p",{children:"No activity recorded yet"})});const e=c(t);return(0,n.jsx)("div",{className:"activity-timeline",children:Object.entries(e).map((([t,e])=>(0,n.jsxs)("div",{className:"timeline-hour",children:[(0,n.jsx)("div",{className:"timeline-hour__header",children:(0,n.jsx)("h4",{children:l(parseInt(t))})}),(0,n.jsx)("ul",{className:"timeline-activities",children:e.map((t=>(0,n.jsxs)("li",{className:"timeline-activity",children:[(0,n.jsx)("div",{className:`activity-icon activity-icon--${t.type}`,children:h(t.type)}),(0,n.jsxs)("div",{className:"activity-content",children:[(0,n.jsx)("div",{className:"activity-title",children:m(t)}),t.duration&&(0,n.jsx)("div",{className:"activity-duration",children:u(t.duration)})]}),(0,n.jsx)("div",{className:"activity-time",children:d(t.timestamp)})]},t.id)))})]},t)))})},c=t=>{const e={};return t.forEach((t=>{const s=new Date(t.timestamp).getHours();e[s]||(e[s]=[]),e[s].push(t)})),Object.fromEntries(Object.entries(e).sort((([t],[e])=>parseInt(e)-parseInt(t))))},l=t=>`${t%12||12} ${t<12?"AM":"PM"}`,d=t=>new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),u=t=>{const e=Math.floor(t/6e4),s=Math.floor(t%6e4/1e3);return e>0?`${e}m ${s}s`:`${s}s`},h=t=>{switch(t){case"navigation":return"üß≠";case"interaction":return"üëÜ";case"search":return"üîç";case"reading":return"üìñ";case"idle":return"‚è∏Ô∏è";default:return"‚Ä¢"}},m=t=>{switch(t.type){case"navigation":return t.url?`Visited ${new URL(t.url).hostname}`:"Navigated to a page";case"interaction":return"Interacted with content";case"search":return"Searched for content";case"reading":return"Read content";case"idle":return"Idle period";default:return t.type||"Unknown activity"}};var b=s(23),v=s(526);const x=()=>{const{organism:t}=(0,b.YT)(),[e,s]=(0,r.useState)([]),[a,c]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const t=async()=>{const t=new v.p;await t.initialize();try{const e=await t.getBehaviorPatterns();s(e);const n=await t.getRecentActivity();c(n)}catch(t){s([]),c([])}};t();const e=setInterval(t,1e4);return()=>clearInterval(e)}),[]),t?(0,n.jsxs)("div",{className:"ext-metrics-panel max-w-xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8",children:[(0,n.jsxs)("section",{className:"ext-metrics-section mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-[#00e0ff] mb-2",children:"Behavior Patterns"}),(0,n.jsx)(i,{data:e})]}),(0,n.jsxs)("section",{className:"ext-metrics-section mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-[#00e0ff] mb-2",children:"Activity Timeline"}),(0,n.jsx)(o,{data:a})]}),(0,n.jsxs)("section",{className:"ext-metrics-section",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-[#00e0ff] mb-2",children:"Evolution Stats"}),(0,n.jsxs)("div",{className:"ext-evolution-stats flex gap-8 justify-center",children:[(0,n.jsxs)("div",{className:"ext-stat-item flex flex-col items-center",children:[(0,n.jsx)("span",{className:"ext-stat-label text-[#888] text-sm",children:"Total Mutations"}),(0,n.jsx)("span",{className:"ext-stat-value text-lg font-bold",children:t.mutations?.length||0})]}),(0,n.jsxs)("div",{className:"ext-stat-item flex flex-col items-center",children:[(0,n.jsx)("span",{className:"ext-stat-label text-[#888] text-sm",children:"G√©n√©ration"}),(0,n.jsx)("span",{className:"ext-stat-value text-lg font-bold",children:t.generation})]}),(0,n.jsxs)("div",{className:"ext-stat-item flex flex-col items-center",children:[(0,n.jsx)("span",{className:"ext-stat-label text-[#888] text-sm",children:"√Çge"}),(0,n.jsxs)("span",{className:"ext-stat-value text-lg font-bold",children:[Math.floor((Date.now()-(t.createdAt??0))/36e5),"h"]})]})]})]})]}):null},p=x}}]);