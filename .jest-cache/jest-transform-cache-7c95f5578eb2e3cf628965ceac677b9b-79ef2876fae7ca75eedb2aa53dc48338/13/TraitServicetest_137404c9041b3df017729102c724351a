c07f0ba6763a21867306d750f7347666
"use strict";
/**
 * Tests pour TraitService - Service de gestion des traits d'organisme
 */
Object.defineProperty(exports, "__esModule", { value: true });
const TraitService_1 = require("../../../src/core/services/TraitService");
describe('TraitService', () => {
    let traitService;
    beforeEach(() => {
        traitService = new TraitService_1.TraitService();
    });
    afterEach(() => {
        traitService.cleanup();
    });
    describe('Initialization', () => {
        test('should initialize with default traits', () => {
            const traits = traitService.getAllTraits();
            expect(traits.curiosity).toBe(0.5);
            expect(traits.focus).toBe(0.5);
            expect(traits.empathy).toBe(0.5);
            expect(Object.keys(traits)).toHaveLength(10);
        });
        test('should initialize with custom traits', () => {
            const customTraits = {
                curiosity: 0.8,
                creativity: 0.9
            };
            const service = new TraitService_1.TraitService(customTraits);
            const traits = service.getAllTraits();
            expect(traits.curiosity).toBe(0.8);
            expect(traits.creativity).toBe(0.9);
            expect(traits.focus).toBe(0.5); // Valeur par défaut
            service.cleanup();
        });
    });
    describe('Trait Updates', () => {
        test('should update a single trait', () => {
            traitService.updateTrait('curiosity', 0.7);
            expect(traitService.getTrait('curiosity')).toBe(0.7);
        });
        test('should clamp trait values between 0 and 1', () => {
            traitService.updateTrait('curiosity', 1.5);
            expect(traitService.getTrait('curiosity')).toBe(1);
            traitService.updateTrait('focus', -0.5);
            expect(traitService.getTrait('focus')).toBe(0);
        });
        test('should update multiple traits', () => {
            const updates = {
                curiosity: 0.8,
                creativity: 0.6,
                empathy: 0.9
            };
            traitService.updateTraits(updates);
            expect(traitService.getTrait('curiosity')).toBe(0.8);
            expect(traitService.getTrait('creativity')).toBe(0.6);
            expect(traitService.getTrait('empathy')).toBe(0.9);
        });
        test('should normalize traits to valid range', () => {
            // Force des valeurs invalides
            traitService.updateTrait('curiosity', 2.0);
            traitService.updateTrait('focus', -1.0);
            traitService.normalizeTraits();
            expect(traitService.getTrait('curiosity')).toBe(1.0);
            expect(traitService.getTrait('focus')).toBe(0.0);
        });
    });
    describe('History Tracking', () => {
        test('should track trait change history', () => {
            traitService.updateTrait('curiosity', 0.7, 'test_trigger');
            traitService.updateTrait('curiosity', 0.8, 'test_trigger');
            const history = traitService.getTraitHistory('curiosity');
            expect(history).toHaveLength(2);
            expect(history[0].value).toBe(0.7);
            expect(history[1].value).toBe(0.8);
            expect(history[0].trigger).toBe('test_trigger');
        });
        test('should get full history with limit', () => {
            // Ajoute plusieurs changements
            for (let i = 0; i < 20; i++) {
                traitService.updateTrait('curiosity', i / 20);
            }
            const history = traitService.getFullHistory(10);
            expect(history).toHaveLength(10);
        });
        test('should cleanup old history', () => {
            traitService.updateTrait('curiosity', 0.7);
            // Force un timestamp ancien
            const history = traitService.getTraitHistory('curiosity');
            if (history.length > 0) {
                history[0].timestamp = Date.now() - (25 * 60 * 60 * 1000); // 25 heures
            }
            traitService.cleanup(24 * 60 * 60 * 1000); // 24 heures
            const remainingHistory = traitService.getTraitHistory('curiosity');
            expect(remainingHistory.length).toBeLessThan(history.length);
        });
    });
    describe('Event Listeners', () => {
        test('should notify listeners on trait changes', (done) => {
            let eventReceived = false;
            traitService.addTraitChangeListener((event) => {
                expect(event.traitName).toBe('curiosity');
                expect(event.newValue).toBe(0.8);
                expect(event.oldValue).toBe(0.5);
                eventReceived = true;
                done();
            });
            traitService.updateTrait('curiosity', 0.8);
            // Vérification de sécurité
            setTimeout(() => {
                if (!eventReceived) {
                    done(new Error('Event listener not triggered'));
                }
            }, 100);
        });
        test('should remove listeners correctly', () => {
            let callCount = 0;
            const listener = () => { callCount++; };
            traitService.addTraitChangeListener(listener);
            traitService.updateTrait('curiosity', 0.8);
            expect(callCount).toBe(1);
            traitService.removeTraitChangeListener(listener);
            traitService.updateTrait('focus', 0.7);
            expect(callCount).toBe(1); // Pas d'augmentation
        });
    });
    describe('Balance Calculation', () => {
        test('should calculate balance for even traits', () => {
            // Traits équilibrés (tous à 0.5)
            const balance = traitService.calculateBalance();
            expect(balance).toBeCloseTo(1.0, 2); // Balance parfaite
        });
        test('should calculate balance for uneven traits', () => {
            traitService.updateTraits({
                curiosity: 1.0,
                focus: 0.0,
                empathy: 1.0,
                creativity: 0.0
            });
            const balance = traitService.calculateBalance();
            // Avec des valeurs très déséquilibrées (0,1,0,1), variance=0.25, balance=1-0.25=0.75
            expect(balance).toBeGreaterThan(0.5); // Balance calculée avec 1-variance
            expect(balance).toBeLessThan(1.0);
        });
    });
    describe('Serialization', () => {
        test('should serialize and deserialize correctly', () => {
            traitService.updateTrait('curiosity', 0.8);
            traitService.updateTrait('creativity', 0.6);
            const serialized = traitService.toJSON();
            const newService = new TraitService_1.TraitService();
            newService.fromJSON(serialized);
            expect(newService.getTrait('curiosity')).toBe(0.8);
            expect(newService.getTrait('creativity')).toBe(0.6);
            newService.cleanup();
        });
        test('should preserve history in serialization', () => {
            traitService.updateTrait('curiosity', 0.8, 'test');
            const serialized = traitService.toJSON();
            const newService = new TraitService_1.TraitService();
            newService.fromJSON(serialized);
            const history = newService.getTraitHistory('curiosity');
            expect(history).toHaveLength(1);
            expect(history[0].trigger).toBe('test');
            newService.cleanup();
        });
    });
    describe('Error Handling', () => {
        test('should handle invalid trait names gracefully', () => {
            expect(() => {
                traitService.updateTrait('invalid_trait', 0.5);
            }).not.toThrow();
        });
        test('should handle cleanup when no data exists', () => {
            expect(() => {
                traitService.cleanup();
            }).not.toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL21udC9jL1VzZXJzL21fb2xpL1Byb2pldHMvU1lNQklPTlQvX190ZXN0c19fL2NvcmUvc2VydmljZXMvVHJhaXRTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUVILDBFQUF1RTtBQUd2RSxRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtJQUM1QixJQUFJLFlBQTBCLENBQUM7SUFFL0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFlBQVksR0FBRyxJQUFJLDJCQUFZLEVBQUUsQ0FBQztJQUNwQyxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixZQUFZLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDekIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLElBQUksQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7WUFDakQsTUFBTSxNQUFNLEdBQUcsWUFBWSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBRTNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ25DLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQy9CLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLHNDQUFzQyxFQUFFLEdBQUcsRUFBRTtZQUNoRCxNQUFNLFlBQVksR0FBNEI7Z0JBQzVDLFNBQVMsRUFBRSxHQUFHO2dCQUNkLFVBQVUsRUFBRSxHQUFHO2FBQ2hCLENBQUM7WUFFRixNQUFNLE9BQU8sR0FBRyxJ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Q0FBQyxHQUFHLEVBQUU7Z0JBQ1YsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3pCLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL21udC9jL1VzZXJzL21fb2xpL1Byb2pldHMvU1lNQklPTlQvX190ZXN0c19fL2NvcmUvc2VydmljZXMvVHJhaXRTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZXN0cyBwb3VyIFRyYWl0U2VydmljZSAtIFNlcnZpY2UgZGUgZ2VzdGlvbiBkZXMgdHJhaXRzIGQnb3JnYW5pc21lXG4gKi9cblxuaW1wb3J0IHsgVHJhaXRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc3JjL2NvcmUvc2VydmljZXMvVHJhaXRTZXJ2aWNlJztcbmltcG9ydCB7IE9yZ2FuaXNtVHJhaXRzIH0gZnJvbSAnLi4vLi4vLi4vc3JjL3NoYXJlZC90eXBlcy9vcmdhbmlzbSc7XG5cbmRlc2NyaWJlKCdUcmFpdFNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCB0cmFpdFNlcnZpY2U6IFRyYWl0U2VydmljZTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB0cmFpdFNlcnZpY2UgPSBuZXcgVHJhaXRTZXJ2aWNlKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgdHJhaXRTZXJ2aWNlLmNsZWFudXAoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0luaXRpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBpbml0aWFsaXplIHdpdGggZGVmYXVsdCB0cmFpdHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0cmFpdHMgPSB0cmFpdFNlcnZpY2UuZ2V0QWxsVHJhaXRzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdCh0cmFpdHMuY3VyaW9zaXR5KS50b0JlKDAuNSk7XG4gICAgICBleHBlY3QodHJhaXRzLmZvY3VzKS50b0JlKDAuNSk7XG4gICAgICBleHBlY3QodHJhaXRzLmVtcGF0aHkpLnRvQmUoMC41KTtcbiAgICAgIGV4cGVjdChPYmplY3Qua2V5cyh0cmFpdHMpKS50b0hhdmVMZW5ndGgoMTApO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGluaXRpYWxpemUgd2l0aCBjdXN0b20gdHJhaXRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgY3VzdG9tVHJhaXRzOiBQYXJ0aWFsPE9yZ2FuaXNtVHJhaXRzPiA9IHtcbiAgICAgICAgY3VyaW9zaXR5OiAwLjgsXG4gICAgICAgIGNyZWF0aXZpdHk6IDAuOVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3Qgc2VydmljZSA9IG5ldyBUcmFpdFNlcnZpY2UoY3VzdG9tVHJhaXRzKTtcbiAgICAgIGNvbnN0IHRyYWl0cyA9IHNlcnZpY2UuZ2V0QWxsVHJhaXRzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdCh0cmFpdHMuY3VyaW9zaXR5KS50b0JlKDAuOCk7XG4gICAgICBleHBlY3QodHJhaXRzLmNyZWF0aXZpdHkpLnRvQmUoMC45KTtcbiAgICAgIGV4cGVjdCh0cmFpdHMuZm9jdXMpLnRvQmUoMC41KTsgLy8gVmFsZXVyIHBhciBkw6lmYXV0XG4gICAgICBcbiAgICAgIHNlcnZpY2UuY2xlYW51cCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVHJhaXQgVXBkYXRlcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgdXBkYXRlIGEgc2luZ2xlIHRyYWl0JywgKCkgPT4ge1xuICAgICAgdHJhaXRTZXJ2aWNlLnVwZGF0ZVRyYWl0KCdjdXJpb3NpdHknLCAwLjcpO1xuICAgICAgXG4gICAgICBleHBlY3QodHJhaXRTZXJ2aWNlLmdldFRyYWl0KCdjdXJpb3NpdHknKSkudG9CZSgwLjcpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGNsYW1wIHRyYWl0IHZhbHVlcyBiZXR3ZWVuIDAgYW5kIDEnLCAoKSA9PiB7XG4gICAgICB0cmFpdFNlcnZpY2UudXBkYXRlVHJhaXQoJ2N1cmlvc2l0eScsIDEuNSk7XG4gICAgICBleHBlY3QodHJhaXRTZXJ2aWNlLmdldFRyYWl0KCdjdXJpb3NpdHknKSkudG9CZSgxKTtcbiAgICAgIFxuICAgICAgdHJhaXRTZXJ2aWNlLnVwZGF0ZVRyYWl0KCdmb2N1cycsIC0wLjUpO1xuICAgICAgZXhwZWN0KHRyYWl0U2VydmljZS5nZXRUcmFpdCgnZm9jdXMnKSkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB1cGRhdGUgbXVsdGlwbGUgdHJhaXRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlczogUGFydGlhbDxPcmdhbmlzbVRyYWl0cz4gPSB7XG4gICAgICAgIGN1cmlvc2l0eTogMC44LFxuICAgICAgICBjcmVhdGl2aXR5OiAwLjYsXG4gICAgICAgIGVtcGF0aHk6IDAuOVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgdHJhaXRTZXJ2aWNlLnVwZGF0ZVRyYWl0cyh1cGRhdGVzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHRyYWl0U2VydmljZS5nZXRUcmFpdCgnY3VyaW9zaXR5JykpLnRvQmUoMC44KTtcbiAgICAgIGV4cGVjdCh0cmFpdFNlcnZpY2UuZ2V0VHJhaXQoJ2NyZWF0aXZpdHknKSkudG9CZSgwLjYpO1xuICAgICAgZXhwZWN0KHRyYWl0U2VydmljZS5nZXRUcmFpdCgnZW1wYXRoeScpKS50b0JlKDAuOSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgbm9ybWFsaXplIHRyYWl0cyB0byB2YWxpZCByYW5nZScsICgpID0+IHtcbiAgICAgIC8vIEZvcmNlIGRlcyB2YWxldXJzIGludmFsaWRlc1xuICAgICAgdHJhaXRTZXJ2aWNlLnVwZGF0ZVRyYWl0KCdjdXJpb3NpdHknLCAyLjApO1xuICAgICAgdHJhaXRTZXJ2aWNlLnVwZGF0ZVRyYWl0KCdmb2N1cycsIC0xLjApO1xuICAgICAgXG4gICAgICB0cmFpdFNlcnZpY2Uubm9ybWFsaXplVHJhaXRzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdCh0cmFpdFNlcnZpY2UuZ2V0VHJhaXQoJ2N1cmlvc2l0eScpKS50b0JlKDEuMCk7XG4gICAgICBleHBlY3QodHJhaXRTZXJ2aWNlLmdldFRyYWl0KCdmb2N1cycpKS50b0JlKDAuMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdIaXN0b3J5IFRyYWNraW5nJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCB0cmFjayB0cmFpdCBjaGFuZ2UgaGlzdG9yeScsICgpID0+IHtcbiAgICAgIHRyYWl0U2VydmljZS51cGRhdGVUcmFpdCgnY3VyaW9zaXR5JywgMC43LCAndGVzdF90cmlnZ2VyJyk7XG4gICAgICB0cmFpdFNlcnZpY2UudXBkYXRlVHJhaXQoJ2N1cmlvc2l0eScsIDAuOCwgJ3Rlc3RfdHJpZ2dlcicpO1xuICAgICAgXG4gICAgICBjb25zdCBoaXN0b3J5ID0gdHJhaXRTZXJ2aWNlLmdldFRyYWl0SGlzdG9yeSgnY3VyaW9zaXR5Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChoaXN0b3J5KS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QoaGlzdG9yeVswXS52YWx1ZSkudG9CZSgwLjcpO1xuICAgICAgZXhwZWN0KGhpc3RvcnlbMV0udmFsdWUpLnRvQmUoMC44KTtcbiAgICAgIGV4cGVjdChoaXN0b3J5WzBdLnRyaWdnZXIpLnRvQmUoJ3Rlc3RfdHJpZ2dlcicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGdldCBmdWxsIGhpc3Rvcnkgd2l0aCBsaW1pdCcsICgpID0+IHtcbiAgICAgIC8vIEFqb3V0ZSBwbHVzaWV1cnMgY2hhbmdlbWVudHNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjA7IGkrKykge1xuICAgICAgICB0cmFpdFNlcnZpY2UudXBkYXRlVHJhaXQoJ2N1cmlvc2l0eScsIGkgLyAyMCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGhpc3RvcnkgPSB0cmFpdFNlcnZpY2UuZ2V0RnVsbEhpc3RvcnkoMTApO1xuICAgICAgZXhwZWN0KGhpc3RvcnkpLnRvSGF2ZUxlbmd0aCgxMCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgY2xlYW51cCBvbGQgaGlzdG9yeScsICgpID0+IHtcbiAgICAgIHRyYWl0U2VydmljZS51cGRhdGVUcmFpdCgnY3VyaW9zaXR5JywgMC43KTtcbiAgICAgIFxuICAgICAgLy8gRm9yY2UgdW4gdGltZXN0YW1wIGFuY2llblxuICAgICAgY29uc3QgaGlzdG9yeSA9IHRyYWl0U2VydmljZS5nZXRUcmFpdEhpc3RvcnkoJ2N1cmlvc2l0eScpO1xuICAgICAgaWYgKGhpc3RvcnkubGVuZ3RoID4gMCkge1xuICAgICAgICBoaXN0b3J5WzBdLnRpbWVzdGFtcCA9IERhdGUubm93KCkgLSAoMjUgKiA2MCAqIDYwICogMTAwMCk7IC8vIDI1IGhldXJlc1xuICAgICAgfVxuICAgICAgXG4gICAgICB0cmFpdFNlcnZpY2UuY2xlYW51cCgyNCAqIDYwICogNjAgKiAxMDAwKTsgLy8gMjQgaGV1cmVzXG4gICAgICBcbiAgICAgIGNvbnN0IHJlbWFpbmluZ0hpc3RvcnkgPSB0cmFpdFNlcnZpY2UuZ2V0VHJhaXRIaXN0b3J5KCdjdXJpb3NpdHknKTtcbiAgICAgIGV4cGVjdChyZW1haW5pbmdIaXN0b3J5Lmxlbmd0aCkudG9CZUxlc3NUaGFuKGhpc3RvcnkubGVuZ3RoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0V2ZW50IExpc3RlbmVycycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgbm90aWZ5IGxpc3RlbmVycyBvbiB0cmFpdCBjaGFuZ2VzJywgKGRvbmUpID0+IHtcbiAgICAgIGxldCBldmVudFJlY2VpdmVkID0gZmFsc2U7XG4gICAgICBcbiAgICAgIHRyYWl0U2VydmljZS5hZGRUcmFpdENoYW5nZUxpc3RlbmVyKChldmVudCkgPT4ge1xuICAgICAgICBleHBlY3QoZXZlbnQudHJhaXROYW1lKS50b0JlKCdjdXJpb3NpdHknKTtcbiAgICAgICAgZXhwZWN0KGV2ZW50Lm5ld1ZhbHVlKS50b0JlKDAuOCk7XG4gICAgICAgIGV4cGVjdChldmVudC5vbGRWYWx1ZSkudG9CZSgwLjUpO1xuICAgICAgICBldmVudFJlY2VpdmVkID0gdHJ1ZTtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHRyYWl0U2VydmljZS51cGRhdGVUcmFpdCgnY3VyaW9zaXR5JywgMC44KTtcbiAgICAgIFxuICAgICAgLy8gVsOpcmlmaWNhdGlvbiBkZSBzw6ljdXJpdMOpXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgaWYgKCFldmVudFJlY2VpdmVkKSB7XG4gICAgICAgICAgZG9uZShuZXcgRXJyb3IoJ0V2ZW50IGxpc3RlbmVyIG5vdCB0cmlnZ2VyZWQnKSk7XG4gICAgICAgIH1cbiAgICAgIH0sIDEwMCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgcmVtb3ZlIGxpc3RlbmVycyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBsZXQgY2FsbENvdW50ID0gMDtcbiAgICAgIFxuICAgICAgY29uc3QgbGlzdGVuZXIgPSAoKSA9PiB7IGNhbGxDb3VudCsrOyB9O1xuICAgICAgXG4gICAgICB0cmFpdFNlcnZpY2UuYWRkVHJhaXRDaGFuZ2VMaXN0ZW5lcihsaXN0ZW5lcik7XG4gICAgICB0cmFpdFNlcnZpY2UudXBkYXRlVHJhaXQoJ2N1cmlvc2l0eScsIDAuOCk7XG4gICAgICBleHBlY3QoY2FsbENvdW50KS50b0JlKDEpO1xuICAgICAgXG4gICAgICB0cmFpdFNlcnZpY2UucmVtb3ZlVHJhaXRDaGFuZ2VMaXN0ZW5lcihsaXN0ZW5lcik7XG4gICAgICB0cmFpdFNlcnZpY2UudXBkYXRlVHJhaXQoJ2ZvY3VzJywgMC43KTtcbiAgICAgIGV4cGVjdChjYWxsQ291bnQpLnRvQmUoMSk7IC8vIFBhcyBkJ2F1Z21lbnRhdGlvblxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQmFsYW5jZSBDYWxjdWxhdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgY2FsY3VsYXRlIGJhbGFuY2UgZm9yIGV2ZW4gdHJhaXRzJywgKCkgPT4ge1xuICAgICAgLy8gVHJhaXRzIMOpcXVpbGlicsOpcyAodG91cyDDoCAwLjUpXG4gICAgICBjb25zdCBiYWxhbmNlID0gdHJhaXRTZXJ2aWNlLmNhbGN1bGF0ZUJhbGFuY2UoKTtcbiAgICAgIGV4cGVjdChiYWxhbmNlKS50b0JlQ2xvc2VUbygxLjAsIDIpOyAvLyBCYWxhbmNlIHBhcmZhaXRlXG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgY2FsY3VsYXRlIGJhbGFuY2UgZm9yIHVuZXZlbiB0cmFpdHMnLCAoKSA9PiB7XG4gICAgICB0cmFpdFNlcnZpY2UudXBkYXRlVHJhaXRzKHtcbiAgICAgICAgY3VyaW9zaXR5OiAxLjAsXG4gICAgICAgIGZvY3VzOiAwLjAsXG4gICAgICAgIGVtcGF0aHk6IDEuMCxcbiAgICAgICAgY3JlYXRpdml0eTogMC4wXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgYmFsYW5jZSA9IHRyYWl0U2VydmljZS5jYWxjdWxhdGVCYWxhbmNlKCk7XG4gICAgICAvLyBBdmVjIGRlcyB2YWxldXJzIHRyw6hzIGTDqXPDqXF1aWxpYnLDqWVzICgwLDEsMCwxKSwgdmFyaWFuY2U9MC4yNSwgYmFsYW5jZT0xLTAuMjU9MC43NVxuICAgICAgZXhwZWN0KGJhbGFuY2UpLnRvQmVHcmVhdGVyVGhhbigwLjUpOyAvLyBCYWxhbmNlIGNhbGN1bMOpZSBhdmVjIDEtdmFyaWFuY2VcbiAgICAgIGV4cGVjdChiYWxhbmNlKS50b0JlTGVzc1RoYW4oMS4wKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlcmlhbGl6YXRpb24nLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHNlcmlhbGl6ZSBhbmQgZGVzZXJpYWxpemUgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgdHJhaXRTZXJ2aWNlLnVwZGF0ZVRyYWl0KCdjdXJpb3NpdHknLCAwLjgpO1xuICAgICAgdHJhaXRTZXJ2aWNlLnVwZGF0ZVRyYWl0KCdjcmVhdGl2aXR5JywgMC42KTtcbiAgICAgIFxuICAgICAgY29uc3Qgc2VyaWFsaXplZCA9IHRyYWl0U2VydmljZS50b0pTT04oKTtcbiAgICAgIGNvbnN0IG5ld1NlcnZpY2UgPSBuZXcgVHJhaXRTZXJ2aWNlKCk7XG4gICAgICBuZXdTZXJ2aWNlLmZyb21KU09OKHNlcmlhbGl6ZWQpO1xuICAgICAgXG4gICAgICBleHBlY3QobmV3U2VydmljZS5nZXRUcmFpdCgnY3VyaW9zaXR5JykpLnRvQmUoMC44KTtcbiAgICAgIGV4cGVjdChuZXdTZXJ2aWNlLmdldFRyYWl0KCdjcmVhdGl2aXR5JykpLnRvQmUoMC42KTtcbiAgICAgIFxuICAgICAgbmV3U2VydmljZS5jbGVhbnVwKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgcHJlc2VydmUgaGlzdG9yeSBpbiBzZXJpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgICAgdHJhaXRTZXJ2aWNlLnVwZGF0ZVRyYWl0KCdjdXJpb3NpdHknLCAwLjgsICd0ZXN0Jyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSB0cmFpdFNlcnZpY2UudG9KU09OKCk7XG4gICAgICBjb25zdCBuZXdTZXJ2aWNlID0gbmV3IFRyYWl0U2VydmljZSgpO1xuICAgICAgbmV3U2VydmljZS5mcm9tSlNPTihzZXJpYWxpemVkKTtcbiAgICAgIFxuICAgICAgY29uc3QgaGlzdG9yeSA9IG5ld1NlcnZpY2UuZ2V0VHJhaXRIaXN0b3J5KCdjdXJpb3NpdHknKTtcbiAgICAgIGV4cGVjdChoaXN0b3J5KS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QoaGlzdG9yeVswXS50cmlnZ2VyKS50b0JlKCd0ZXN0Jyk7XG4gICAgICBcbiAgICAgIG5ld1NlcnZpY2UuY2xlYW51cCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIHRyYWl0IG5hbWVzIGdyYWNlZnVsbHknLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICB0cmFpdFNlcnZpY2UudXBkYXRlVHJhaXQoJ2ludmFsaWRfdHJhaXQnIGFzIGFueSwgMC41KTtcbiAgICAgIH0pLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGNsZWFudXAgd2hlbiBubyBkYXRhIGV4aXN0cycsICgpID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIHRyYWl0U2VydmljZS5jbGVhbnVwKCk7XG4gICAgICB9KS5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==