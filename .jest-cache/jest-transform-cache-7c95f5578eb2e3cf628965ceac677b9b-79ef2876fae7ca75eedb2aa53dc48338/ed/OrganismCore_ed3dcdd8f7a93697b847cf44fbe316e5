6bdf3331c9b94c9d290474738bc60134
"use strict";
/**
 * OrganismCore refactorisé - Architecture hexagonale
 * Version simplifiée utilisant des services spécialisés
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.OrganismCore = void 0;
const ErrorHandler_1 = require("./utils/ErrorHandler");
const TraitService_1 = require("./services/TraitService");
const EnergyService_1 = require("./services/EnergyService");
const NeuralService_1 = require("./services/NeuralService");
const RealMetricsService_1 = __importDefault(require("./services/RealMetricsService"));
const FeatureFlagService_1 = __importDefault(require("./services/FeatureFlagService"));
const uuid_1 = require("../shared/utils/uuid");
class OrganismCore {
    constructor(dna, initialTraits, dependencies) {
        this.health = 100;
        this.lastMutation = Date.now();
        // Validation d'entrée
        const validation = this.validateInput(dna, initialTraits);
        if (!validation.isValid) {
            throw new Error(`OrganismCore creation failed: ${validation.errors.join(', ')}`);
        }
        this.id = (0, uuid_1.generateSecureUUID)();
        this.dna = dna;
        this.logger = dependencies?.logger;
        // Initialisation des services de base
        this.metricsService = RealMetricsService_1.default.getInstance();
        this.featureFlags = FeatureFlagService_1.default.getInstance();
        // Initialisation des services métier
        this.traitService = new TraitService_1.TraitService(initialTraits);
        this.energyService = new EnergyService_1.EnergyService(100);
        // Service neural nécessite une dépendance externe
        if (dependencies?.neuralMesh) {
            this.neuralService = new NeuralService_1.NeuralService(dependencies.neuralMesh);
        }
        else {
            // Fallback pour compatibilité
            const { NeuralMesh } = require('./NeuralMesh');
            this.neuralService = new NeuralService_1.NeuralService(new NeuralMesh());
        }
        this.setupServiceListeners();
        this.logger?.debug('OrganismCore initialized', { id: this.id, dna: this.dna });
    }
    /**
     * Configuration des listeners entre services
     */
    setupServiceListeners() {
        // Écoute les changements de traits pour ajuster l'énergie
        this.traitService.addTraitChangeListener((event) => {
            this.onTraitChanged(event);
        });
        // Écoute les événements d'énergie pour log
        this.energyService.addEnergyListener((event) => {
            if (event.type === 'consumption' && event.energyAfter < 10) {
                this.logger?.debug('Low energy warning', { energy: event.energyAfter });
            }
        });
    }
    /**
     * Gestionnaire de changement de traits
     */
    onTraitChanged(event) {
        // Ajuste l'efficacité métabolique basée sur les traits
        const traits = this.traitService.getAllTraits();
        const efficiencyFactor = (traits.resilience + traits.adaptability) / 2;
        this.energyService.setEfficiency(efficiencyFactor);
        this.logger?.debug('Trait changed, metabolism adjusted', {
            trait: event.traitName,
            newValue: event.newValue,
            efficiency: efficiencyFactor
        });
    }
    /**
     * Validation des entrées
     */
    validateInput(dna, traits) {
        const errors = [];
        if (!dna || typeof dna !== 'string') {
            errors.push('DNA must be a non-empty string');
        }
        if (dna && dna.length < 10) {
            errors.push('DNA must be at least 10 characters long');
        }
        if (traits) {
            Object.entries(traits).forEach(([key, value]) => {
                if (typeof value !== 'number' || value < 0 || value > 1) {
                    errors.push(`Trait ${key} must be a number between 0 and 1`);
                }
            });
        }
        return { isValid: errors.length === 0, errors };
    }
    /**
     * Génère un ID unique
     */
    // generateId() supprimé - utilise generateSecureUUID() maintenant
    // =============================================================================
    // API PUBLIQUE - Interface IOrganismCore
    // =============================================================================
    getId() {
        return this.id;
    }
    getDNA() {
        return this.dna;
    }
    getTraits() {
        return this.traitService.getAllTraits();
    }
    updateTrait(name, value) {
        if (!this.energyService.consumeEnergy(1, `trait_update_${name}`)) {
            throw new Error('Insufficient energy to update trait');
        }
        this.traitService.updateTrait(name, value, 'manual_update');
        this.logger?.debug('Trait updated', { trait: name, value });
    }
    getEnergyLevel() {
        return this.energyService.getEnergyLevel();
    }
    getHealth() {
        return this.health;
    }
    /**
     * Évolution de l'organisme basée sur un stimulus
     */
    async evolve(stimulus) {
        const energyCost = 5;
        if (!this.energyService.consumeEnergy(energyCost, 'evolution')) {
            this.logger?.debug('Evolution skipped: insufficient energy');
            return;
        }
        try {
            const currentTraits = this.traitService.getAllTraits();
            const result = await this.neuralService.processStimulus(stimulus, currentTraits);
            if (result.success && Object.keys(result.adaptations).length > 0) {
                this.traitService.updateTraits(result.adaptations, 'evolution');
                this.lastMutation = Date.now();
                this.logger?.debug('Evolution successful', {
                    adaptations: result.adaptations,
                    confidence: result.confidence
                });
            }
        }
        catch (error) {
            this.logger?.error('Evolution failed', error);
            ErrorHandler_1.errorHandler.logSimpleError('OrganismCore', 'evolve', error, 'error');
        }
    }
    /**
     * Apprentissage à partir de données comportementales
     */
    async learn(behaviorData) {
        const energyCost = 2;
        if (!this.energyService.consumeEnergy(energyCost, 'learning')) {
            return;
        }
        const success = await this.neuralService.learn(behaviorData);
        if (success) {
            // Améliore légèrement la mémoire lors de l'apprentissage
            const currentMemory = this.traitService.getTrait('memory');
            this.traitService.updateTrait('memory', currentMemory + 0.01, 'learning');
        }
        this.logger?.debug('Learning completed', { success, data: behaviorData });
    }
    /**
     * Traitement d'un stimulus simple
     */
    processStimulus(stimulus) {
        const energyCost = 1;
        if (!this.energyService.consumeEnergy(energyCost, 'stimulus_processing')) {
            return;
        }
        // Traitement simplifié en arrière-plan
        this.neuralService.queuePattern({
            id: `pattern_${Date.now()}`,
            type: 'behavioral',
            data: stimulus,
            timestamp: Date.now(),
            confidence: 0.8
        });
        this.logger?.debug('Stimulus processed', { stimulus });
    }
    /**
     * Obtient l'état complet de l'organisme
     */
    getState() {
        const traits = this.traitService.getAllTraits();
        const energyStats = this.energyService.getEnergyStats();
        return {
            id: this.id,
            traits,
            energy: energyStats.current,
            maxEnergy: energyStats.max,
            health: this.health,
            dna: this.dna,
            lastMutation: this.lastMutation,
            balance: this.traitService.calculateBalance(),
            metabolismRate: energyStats.metabolismRate,
            age: Date.now() - parseInt(this.id.split('_')[1]) // Approximation basée sur l'ID
        };
    }
    /**
     * Génère les paramètres de shader pour le rendu visuel
     */
    generateShaderParameters() {
        const traits = this.traitService.getAllTraits();
        return {
            energy: this.energyService.getEnergyPercentage() / 100,
            health: this.health / 100,
            neuralActivity: this.neuralService.getNeuralActivity(),
            creativity: traits.creativity,
            focus: traits.focus,
            time: Date.now() / 1000,
            colorPrimary: [traits.creativity, traits.empathy, traits.intuition],
            colorSecondary: [traits.focus, traits.resilience, traits.adaptability],
            morphology: traits.adaptability,
            complexity: traits.creativity * traits.memory
        };
    }
    /**
     * Sérialisation pour sauvegarde
     */
    toJSON() {
        return {
            mesh: {},
            dna: this.dna,
            health: this.health,
            lastMutation: this.lastMutation,
            traits: this.traitService.toJSON(),
            energy: this.energyService.toJSON(),
            neural: this.neuralService.saveState(),
            timestamp: Date.now()
        };
    }
    /**
     * Restauration depuis JSON
     */
    fromJSON(data) {
        if (data.traits) {
            this.traitService.fromJSON(data.traits);
        }
        if (data.energy) {
            this.energyService.fromJSON(data.energy);
        }
        if (data.neural) {
            this.neuralService.loadState(data.neural);
        }
        this.health = data.health || 100;
        this.lastMutation = data.lastMutation || Date.now();
        this.logger?.debug('State restored from JSON', { id: this.id });
    }
    /**
     * Nettoyage et libération des ressources
     */
    cleanup() {
        this.energyService.destroy();
        this.traitService.cleanup();
        this.neuralService.cleanup();
        this.logger?.debug('OrganismCore cleaned up', { id: this.id });
    }
    /**
     * Vérification de l'état de santé
     */
    healthCheck() {
        const issues = [];
        if (this.health < 20) {
            issues.push('Low health');
        }
        if (this.energyService.getEnergyLevel() < 10) {
            issues.push('Low energy');
        }
        const neuralHealth = this.neuralService.healthCheck();
        if (!neuralHealth.healthy) {
            issues.push(...neuralHealth.issues);
        }
        return {
            healthy: issues.length === 0,
            issues
        };
    }
    // =============================================================================
    // MÉTHODES MANQUANTES POUR IOrganismCore
    // =============================================================================
    /**
     * Boot the organism
     */
    async boot() {
        // Initialize neural mesh if needed
        try {
            await this.neuralService.initialize();
            this.logger?.debug('Organism booted successfully', { id: this.id });
        }
        catch (error) {
            this.logger?.error('Failed to boot organism', { id: this.id, error });
            throw error;
        }
    }
    /**
     * Hibernate the organism
     */
    async hibernate() {
        try {
            this.energyService.setEfficiency(0.1); // Reduce energy consumption
            await this.neuralService.suspend();
            this.logger?.debug('Organism hibernated', { id: this.id });
        }
        catch (error) {
            this.logger?.error('Failed to hibernate organism', { id: this.id, error });
            throw error;
        }
    }
    /**
     * Update organism with delta time
     */
    update(deltaTime = 16.67) {
        // Standard frame time processing
        const timeFactor = deltaTime / 16.67; // Normalize to 60fps
        // Update energy decay
        this.energyService.consumeEnergy(0.1 * timeFactor, 'metabolism');
        // Update neural processing
        this.neuralService.update(deltaTime);
        // Health regeneration if high energy
        if (this.energyService.getEnergyLevel() > 80) {
            this.health = Math.min(100, this.health + (0.1 * timeFactor));
        }
    }
    /**
     * Stimulate organism input
     */
    stimulate(inputId, value) {
        this.neuralService.stimulate(inputId, value);
        // Consume energy for processing
        this.energyService.consumeEnergy(0.5, `stimulation_${inputId}`);
    }
    /**
     * Mutate organism with given rate
     */
    mutate(rate = 0.01) {
        const traits = this.traitService.getAllTraits();
        const mutations = {};
        // Mutate each trait based on rate
        Object.keys(traits).forEach(traitName => {
            if (Math.random() < rate) {
                const currentValue = traits[traitName];
                const mutation = (Math.random() - 0.5) * 0.1; // ±5% mutation
                const newValue = Math.max(0, Math.min(1, currentValue + mutation));
                mutations[traitName] = newValue;
            }
        });
        // Apply mutations
        if (Object.keys(mutations).length > 0) {
            this.traitService.updateTraits(mutations, 'mutation');
            this.lastMutation = Date.now();
            this.logger?.debug('Mutation applied', { id: this.id, mutations });
        }
    }
    /**
     * Feed organism with energy
     */
    feed(amount = 10) {
        this.energyService.addEnergy(amount);
        this.logger?.debug('Organism fed', { id: this.id, amount });
    }
    /**
     * Set traits (partial update)
     */
    setTraits(traits) {
        this.traitService.updateTraits(traits, 'external_update');
    }
    /**
     * Get performance metrics
     */
    async getPerformanceMetrics() {
        const neuralMetrics = this.neuralService.getPerformanceMetrics();
        return {
            cpu: await this.metricsService.getCPUUsage(),
            memory: await this.metricsService.getMemoryUsage(),
            neuralActivity: neuralMetrics?.neuralActivity || 0,
            connectionStrength: neuralMetrics?.connectionStrength || 0
        };
    }
    /**
     * Get shader parameters for WebGL rendering
     */
    getShaderParameters() {
        const traits = this.getTraits();
        const energy = this.energyService.getEnergyLevel();
        return {
            energy: energy / 100,
            health: this.health / 100,
            neuralActivity: this.neuralService.getNeuralActivity() || 0,
            creativity: traits.creativity,
            focus: traits.focus,
            time: Date.now() / 1000
        };
    }
}
exports.OrganismCore = OrganismCore;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL21udC9jL1VzZXJzL21fb2xpL1Byb2pldHMvU1lNQklPTlQvc3JjL2NvcmUvT3JnYW5pc21Db3JlLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7Ozs7OztBQUlILHVEQUFvRDtBQUNwRCwwREFBeUU7QUFDekUsNERBQXNFO0FBQ3RFLDREQUFpRjtBQUVqRix1RkFBK0Q7QUFDL0QsdUZBQStEO0FBQy9ELCtDQUEwRDtBQU8xRCxNQUFhLFlBQVk7SUFldkIsWUFDRSxHQUFXLEVBQ1gsYUFBdUMsRUFDdkMsWUFBbUM7UUFmN0IsV0FBTSxHQUFXLEdBQUcsQ0FBQztRQUNyQixpQkFBWSxHQUFXLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQWdCeEMsc0JBQXNCO1FBQ3RCLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBQzFELElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDeEIsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQ0FBaUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ25GLENBQUM7UUFFRCxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUEseUJBQWtCLEdBQUUsQ0FBQztRQUMvQixJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUNmLElBQUksQ0FBQyxNQUFNLEdBQUcsWUFBWSxFQUFFLE1BQU0sQ0FBQztRQUVuQyxzQ0FBc0M7UUFDdEMsSUFBSSxDQUFDLGNBQWMsR0FBRyw0QkFBa0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN2RCxJQUFJLENBQUMsWUFBWSxHQUFHLDRCQUFrQixDQUFDLFdBQVcsRUFBRSxDQUFDO1FBRXJELHFDQUFxQztRQUNyQyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksMkJBQVksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNwRCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksNkJBQWEsQ0FBQyxHQUFHLENB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O0lBQ0osQ0FBQztDQUNGO0FBOWNELG9DQThjQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvbW50L2MvVXNlcnMvbV9vbGkvUHJvamV0cy9TWU1CSU9OVC9zcmMvY29yZS9PcmdhbmlzbUNvcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcmdhbmlzbUNvcmUgcmVmYWN0b3Jpc8OpIC0gQXJjaGl0ZWN0dXJlIGhleGFnb25hbGVcbiAqIFZlcnNpb24gc2ltcGxpZmnDqWUgdXRpbGlzYW50IGRlcyBzZXJ2aWNlcyBzcMOpY2lhbGlzw6lzXG4gKi9cblxuaW1wb3J0IHsgT3JnYW5pc21TdGF0ZSwgT3JnYW5pc21UcmFpdHMgfSBmcm9tICcuLi9zaGFyZWQvdHlwZXMvb3JnYW5pc20nO1xuaW1wb3J0IHsgSU9yZ2FuaXNtQ29yZSwgT3JnYW5pc21KU09OLCBTaGFkZXJQYXJhbWV0ZXJzIH0gZnJvbSAnLi9pbnRlcmZhY2VzL0lPcmdhbmlzbUNvcmUnO1xuaW1wb3J0IHsgZXJyb3JIYW5kbGVyIH0gZnJvbSAnLi91dGlscy9FcnJvckhhbmRsZXInO1xuaW1wb3J0IHsgVHJhaXRTZXJ2aWNlLCBUcmFpdFVwZGF0ZUV2ZW50IH0gZnJvbSAnLi9zZXJ2aWNlcy9UcmFpdFNlcnZpY2UnO1xuaW1wb3J0IHsgRW5lcmd5U2VydmljZSwgRW5lcmd5RXZlbnQgfSBmcm9tICcuL3NlcnZpY2VzL0VuZXJneVNlcnZpY2UnO1xuaW1wb3J0IHsgTmV1cmFsU2VydmljZSwgTmV1cmFsUHJvY2Vzc2luZ1Jlc3VsdCB9IGZyb20gJy4vc2VydmljZXMvTmV1cmFsU2VydmljZSc7XG5pbXBvcnQgeyBJTmV1cmFsTWVzaCB9IGZyb20gJy4vaW50ZXJmYWNlcy9JTmV1cmFsTWVzaCc7XG5pbXBvcnQgUmVhbE1ldHJpY3NTZXJ2aWNlIGZyb20gJy4vc2VydmljZXMvUmVhbE1ldHJpY3NTZXJ2aWNlJztcbmltcG9ydCBGZWF0dXJlRmxhZ1NlcnZpY2UgZnJvbSAnLi9zZXJ2aWNlcy9GZWF0dXJlRmxhZ1NlcnZpY2UnO1xuaW1wb3J0IHsgZ2VuZXJhdGVTZWN1cmVVVUlEIH0gZnJvbSAnLi4vc2hhcmVkL3V0aWxzL3V1aWQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIE9yZ2FuaXNtRGVwZW5kZW5jaWVzIHtcbiAgbmV1cmFsTWVzaDogSU5ldXJhbE1lc2g7XG4gIGxvZ2dlcj86IHsgZGVidWc6IEZ1bmN0aW9uOyBpbmZvOiBGdW5jdGlvbjsgZXJyb3I6IEZ1bmN0aW9uIH07XG59XG5cbmV4cG9ydCBjbGFzcyBPcmdhbmlzbUNvcmUgaW1wbGVtZW50cyBJT3JnYW5pc21Db3JlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBpZDogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IGRuYTogc3RyaW5nO1xuICBwcml2YXRlIGhlYWx0aDogbnVtYmVyID0gMTAwO1xuICBwcml2YXRlIGxhc3RNdXRhdGlvbjogbnVtYmVyID0gRGF0ZS5ub3coKTtcbiAgXG4gIC8vIFNlcnZpY2VzIHNww6ljaWFsaXPDqXMgKGluamVjdGlvbiBkZSBkw6lwZW5kYW5jZXMpXG4gIHByaXZhdGUgcmVhZG9ubHkgdHJhaXRTZXJ2aWNlOiBUcmFpdFNlcnZpY2U7XG4gIHByaXZhdGUgcmVhZG9ubHkgZW5lcmd5U2VydmljZTogRW5lcmd5U2VydmljZTtcbiAgcHJpdmF0ZSByZWFkb25seSBuZXVyYWxTZXJ2aWNlOiBOZXVyYWxTZXJ2aWNlO1xuICBwcml2YXRlIHJlYWRvbmx5IG1ldHJpY3NTZXJ2aWNlOiBSZWFsTWV0cmljc1NlcnZpY2U7XG4gIC8vIEB0cy1leHBlY3QtZXJyb3IgU2VydmljZSByw6lzZXJ2w6kgcG91ciB1c2FnZSBmdXR1clxuICBwcml2YXRlIHJlYWRvbmx5IGZlYXR1cmVGbGFnczogRmVhdHVyZUZsYWdTZXJ2aWNlO1xuICBwcml2YXRlIHJlYWRvbmx5IGxvZ2dlcjogeyBkZWJ1ZzogRnVuY3Rpb247IGluZm86IEZ1bmN0aW9uOyBlcnJvcjogRnVuY3Rpb24gfSB8IHVuZGVmaW5lZDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBkbmE6IHN0cmluZywgXG4gICAgaW5pdGlhbFRyYWl0cz86IFBhcnRpYWw8T3JnYW5pc21UcmFpdHM+LFxuICAgIGRlcGVuZGVuY2llcz86IE9yZ2FuaXNtRGVwZW5kZW5jaWVzXG4gICkge1xuICAgIC8vIFZhbGlkYXRpb24gZCdlbnRyw6llXG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMudmFsaWRhdGVJbnB1dChkbmEsIGluaXRpYWxUcmFpdHMpO1xuICAgIGlmICghdmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE9yZ2FuaXNtQ29yZSBjcmVhdGlvbiBmYWlsZWQ6ICR7dmFsaWRhdGlvbi5lcnJvcnMuam9pbignLCAnKX1gKTtcbiAgICB9XG5cbiAgICB0aGlzLmlkID0gZ2VuZXJhdGVTZWN1cmVVVUlEKCk7XG4gICAgdGhpcy5kbmEgPSBkbmE7XG4gICAgdGhpcy5sb2dnZXIgPSBkZXBlbmRlbmNpZXM/LmxvZ2dlcjtcblxuICAgIC8vIEluaXRpYWxpc2F0aW9uIGRlcyBzZXJ2aWNlcyBkZSBiYXNlXG4gICAgdGhpcy5tZXRyaWNzU2VydmljZSA9IFJlYWxNZXRyaWNzU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuICAgIHRoaXMuZmVhdHVyZUZsYWdzID0gRmVhdHVyZUZsYWdTZXJ2aWNlLmdldEluc3RhbmNlKCk7XG4gICAgXG4gICAgLy8gSW5pdGlhbGlzYXRpb24gZGVzIHNlcnZpY2VzIG3DqXRpZXJcbiAgICB0aGlzLnRyYWl0U2VydmljZSA9IG5ldyBUcmFpdFNlcnZpY2UoaW5pdGlhbFRyYWl0cyk7XG4gICAgdGhpcy5lbmVyZ3lTZXJ2aWNlID0gbmV3IEVuZXJneVNlcnZpY2UoMTAwKTtcbiAgICBcbiAgICAvLyBTZXJ2aWNlIG5ldXJhbCBuw6ljZXNzaXRlIHVuZSBkw6lwZW5kYW5jZSBleHRlcm5lXG4gICAgaWYgKGRlcGVuZGVuY2llcz8ubmV1cmFsTWVzaCkge1xuICAgICAgdGhpcy5uZXVyYWxTZXJ2aWNlID0gbmV3IE5ldXJhbFNlcnZpY2UoZGVwZW5kZW5jaWVzLm5ldXJhbE1lc2gpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGYWxsYmFjayBwb3VyIGNvbXBhdGliaWxpdMOpXG4gICAgICBjb25zdCB7IE5ldXJhbE1lc2ggfSA9IHJlcXVpcmUoJy4vTmV1cmFsTWVzaCcpO1xuICAgICAgdGhpcy5uZXVyYWxTZXJ2aWNlID0gbmV3IE5ldXJhbFNlcnZpY2UobmV3IE5ldXJhbE1lc2goKSk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXR1cFNlcnZpY2VMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLmxvZ2dlcj8uZGVidWcoJ09yZ2FuaXNtQ29yZSBpbml0aWFsaXplZCcsIHsgaWQ6IHRoaXMuaWQsIGRuYTogdGhpcy5kbmEgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ29uZmlndXJhdGlvbiBkZXMgbGlzdGVuZXJzIGVudHJlIHNlcnZpY2VzXG4gICAqL1xuICBwcml2YXRlIHNldHVwU2VydmljZUxpc3RlbmVycygpOiB2b2lkIHtcbiAgICAvLyDDiWNvdXRlIGxlcyBjaGFuZ2VtZW50cyBkZSB0cmFpdHMgcG91ciBhanVzdGVyIGwnw6luZXJnaWVcbiAgICB0aGlzLnRyYWl0U2VydmljZS5hZGRUcmFpdENoYW5nZUxpc3RlbmVyKChldmVudDogVHJhaXRVcGRhdGVFdmVudCkgPT4ge1xuICAgICAgdGhpcy5vblRyYWl0Q2hhbmdlZChldmVudCk7XG4gICAgfSk7XG5cbiAgICAvLyDDiWNvdXRlIGxlcyDDqXbDqW5lbWVudHMgZCfDqW5lcmdpZSBwb3VyIGxvZ1xuICAgIHRoaXMuZW5lcmd5U2VydmljZS5hZGRFbmVyZ3lMaXN0ZW5lcigoZXZlbnQ6IEVuZXJneUV2ZW50KSA9PiB7XG4gICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ2NvbnN1bXB0aW9uJyAmJiBldmVudC5lbmVyZ3lBZnRlciA8IDEwKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyPy5kZWJ1ZygnTG93IGVuZXJneSB3YXJuaW5nJywgeyBlbmVyZ3k6IGV2ZW50LmVuZXJneUFmdGVyIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlc3Rpb25uYWlyZSBkZSBjaGFuZ2VtZW50IGRlIHRyYWl0c1xuICAgKi9cbiAgcHJpdmF0ZSBvblRyYWl0Q2hhbmdlZChldmVudDogVHJhaXRVcGRhdGVFdmVudCk6IHZvaWQge1xuICAgIC8vIEFqdXN0ZSBsJ2VmZmljYWNpdMOpIG3DqXRhYm9saXF1ZSBiYXPDqWUgc3VyIGxlcyB0cmFpdHNcbiAgICBjb25zdCB0cmFpdHMgPSB0aGlzLnRyYWl0U2VydmljZS5nZXRBbGxUcmFpdHMoKTtcbiAgICBjb25zdCBlZmZpY2llbmN5RmFjdG9yID0gKHRyYWl0cy5yZXNpbGllbmNlICsgdHJhaXRzLmFkYXB0YWJpbGl0eSkgLyAyO1xuICAgIHRoaXMuZW5lcmd5U2VydmljZS5zZXRFZmZpY2llbmN5KGVmZmljaWVuY3lGYWN0b3IpO1xuXG4gICAgdGhpcy5sb2dnZXI/LmRlYnVnKCdUcmFpdCBjaGFuZ2VkLCBtZXRhYm9saXNtIGFkanVzdGVkJywgeyBcbiAgICAgIHRyYWl0OiBldmVudC50cmFpdE5hbWUsIFxuICAgICAgbmV3VmFsdWU6IGV2ZW50Lm5ld1ZhbHVlLFxuICAgICAgZWZmaWNpZW5jeTogZWZmaWNpZW5jeUZhY3RvciBcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0aW9uIGRlcyBlbnRyw6llc1xuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZUlucHV0KGRuYTogc3RyaW5nLCB0cmFpdHM/OiBQYXJ0aWFsPE9yZ2FuaXNtVHJhaXRzPik6IHsgaXNWYWxpZDogYm9vbGVhbjsgZXJyb3JzOiBzdHJpbmdbXSB9IHtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAoIWRuYSB8fCB0eXBlb2YgZG5hICE9PSAnc3RyaW5nJykge1xuICAgICAgZXJyb3JzLnB1c2goJ0ROQSBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZycpO1xuICAgIH1cblxuICAgIGlmIChkbmEgJiYgZG5hLmxlbmd0aCA8IDEwKSB7XG4gICAgICBlcnJvcnMucHVzaCgnRE5BIG11c3QgYmUgYXQgbGVhc3QgMTAgY2hhcmFjdGVycyBsb25nJyk7XG4gICAgfVxuXG4gICAgaWYgKHRyYWl0cykge1xuICAgICAgT2JqZWN0LmVudHJpZXModHJhaXRzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ251bWJlcicgfHwgdmFsdWUgPCAwIHx8IHZhbHVlID4gMSkge1xuICAgICAgICAgIGVycm9ycy5wdXNoKGBUcmFpdCAke2tleX0gbXVzdCBiZSBhIG51bWJlciBiZXR3ZWVuIDAgYW5kIDFgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCwgZXJyb3JzIH07XG4gIH1cblxuICAvKipcbiAgICogR8OpbsOocmUgdW4gSUQgdW5pcXVlXG4gICAqL1xuICAvLyBnZW5lcmF0ZUlkKCkgc3VwcHJpbcOpIC0gdXRpbGlzZSBnZW5lcmF0ZVNlY3VyZVVVSUQoKSBtYWludGVuYW50XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQVBJIFBVQkxJUVVFIC0gSW50ZXJmYWNlIElPcmdhbmlzbUNvcmVcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBnZXRJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmlkO1xuICB9XG5cbiAgZ2V0RE5BKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZG5hO1xuICB9XG5cbiAgZ2V0VHJhaXRzKCk6IE9yZ2FuaXNtVHJhaXRzIHtcbiAgICByZXR1cm4gdGhpcy50cmFpdFNlcnZpY2UuZ2V0QWxsVHJhaXRzKCk7XG4gIH1cblxuICB1cGRhdGVUcmFpdChuYW1lOiBrZXlvZiBPcmdhbmlzbVRyYWl0cywgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICghdGhpcy5lbmVyZ3lTZXJ2aWNlLmNvbnN1bWVFbmVyZ3koMSwgYHRyYWl0X3VwZGF0ZV8ke25hbWV9YCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW5zdWZmaWNpZW50IGVuZXJneSB0byB1cGRhdGUgdHJhaXQnKTtcbiAgICB9XG5cbiAgICB0aGlzLnRyYWl0U2VydmljZS51cGRhdGVUcmFpdChuYW1lLCB2YWx1ZSwgJ21hbnVhbF91cGRhdGUnKTtcbiAgICB0aGlzLmxvZ2dlcj8uZGVidWcoJ1RyYWl0IHVwZGF0ZWQnLCB7IHRyYWl0OiBuYW1lLCB2YWx1ZSB9KTtcbiAgfVxuXG4gIGdldEVuZXJneUxldmVsKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuZW5lcmd5U2VydmljZS5nZXRFbmVyZ3lMZXZlbCgpO1xuICB9XG5cbiAgZ2V0SGVhbHRoKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuaGVhbHRoO1xuICB9XG5cbiAgLyoqXG4gICAqIMOJdm9sdXRpb24gZGUgbCdvcmdhbmlzbWUgYmFzw6llIHN1ciB1biBzdGltdWx1c1xuICAgKi9cbiAgYXN5bmMgZXZvbHZlKHN0aW11bHVzOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBlbmVyZ3lDb3N0ID0gNTtcbiAgICBpZiAoIXRoaXMuZW5lcmd5U2VydmljZS5jb25zdW1lRW5lcmd5KGVuZXJneUNvc3QsICdldm9sdXRpb24nKSkge1xuICAgICAgdGhpcy5sb2dnZXI/LmRlYnVnKCdFdm9sdXRpb24gc2tpcHBlZDogaW5zdWZmaWNpZW50IGVuZXJneScpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VHJhaXRzID0gdGhpcy50cmFpdFNlcnZpY2UuZ2V0QWxsVHJhaXRzKCk7XG4gICAgICBjb25zdCByZXN1bHQ6IE5ldXJhbFByb2Nlc3NpbmdSZXN1bHQgPSBhd2FpdCB0aGlzLm5ldXJhbFNlcnZpY2UucHJvY2Vzc1N0aW11bHVzKHN0aW11bHVzLCBjdXJyZW50VHJhaXRzKTtcblxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzICYmIE9iamVjdC5rZXlzKHJlc3VsdC5hZGFwdGF0aW9ucykubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLnRyYWl0U2VydmljZS51cGRhdGVUcmFpdHMocmVzdWx0LmFkYXB0YXRpb25zLCAnZXZvbHV0aW9uJyk7XG4gICAgICAgIHRoaXMubGFzdE11dGF0aW9uID0gRGF0ZS5ub3coKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMubG9nZ2VyPy5kZWJ1ZygnRXZvbHV0aW9uIHN1Y2Nlc3NmdWwnLCB7IFxuICAgICAgICAgIGFkYXB0YXRpb25zOiByZXN1bHQuYWRhcHRhdGlvbnMsXG4gICAgICAgICAgY29uZmlkZW5jZTogcmVzdWx0LmNvbmZpZGVuY2UgXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlcj8uZXJyb3IoJ0V2b2x1dGlvbiBmYWlsZWQnLCBlcnJvcik7XG4gICAgICBlcnJvckhhbmRsZXIubG9nU2ltcGxlRXJyb3IoJ09yZ2FuaXNtQ29yZScsICdldm9sdmUnLCBlcnJvciwgJ2Vycm9yJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFwcHJlbnRpc3NhZ2Ugw6AgcGFydGlyIGRlIGRvbm7DqWVzIGNvbXBvcnRlbWVudGFsZXNcbiAgICovXG4gIGFzeW5jIGxlYXJuKGJlaGF2aW9yRGF0YTogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZW5lcmd5Q29zdCA9IDI7XG4gICAgaWYgKCF0aGlzLmVuZXJneVNlcnZpY2UuY29uc3VtZUVuZXJneShlbmVyZ3lDb3N0LCAnbGVhcm5pbmcnKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB0aGlzLm5ldXJhbFNlcnZpY2UubGVhcm4oYmVoYXZpb3JEYXRhKTtcbiAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgLy8gQW3DqWxpb3JlIGzDqWfDqHJlbWVudCBsYSBtw6ltb2lyZSBsb3JzIGRlIGwnYXBwcmVudGlzc2FnZVxuICAgICAgY29uc3QgY3VycmVudE1lbW9yeSA9IHRoaXMudHJhaXRTZXJ2aWNlLmdldFRyYWl0KCdtZW1vcnknKTtcbiAgICAgIHRoaXMudHJhaXRTZXJ2aWNlLnVwZGF0ZVRyYWl0KCdtZW1vcnknLCBjdXJyZW50TWVtb3J5ICsgMC4wMSwgJ2xlYXJuaW5nJyk7XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXI/LmRlYnVnKCdMZWFybmluZyBjb21wbGV0ZWQnLCB7IHN1Y2Nlc3MsIGRhdGE6IGJlaGF2aW9yRGF0YSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFpdGVtZW50IGQndW4gc3RpbXVsdXMgc2ltcGxlXG4gICAqL1xuICBwcm9jZXNzU3RpbXVsdXMoc3RpbXVsdXM6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGVuZXJneUNvc3QgPSAxO1xuICAgIGlmICghdGhpcy5lbmVyZ3lTZXJ2aWNlLmNvbnN1bWVFbmVyZ3koZW5lcmd5Q29zdCwgJ3N0aW11bHVzX3Byb2Nlc3NpbmcnKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFRyYWl0ZW1lbnQgc2ltcGxpZmnDqSBlbiBhcnJpw6hyZS1wbGFuXG4gICAgdGhpcy5uZXVyYWxTZXJ2aWNlLnF1ZXVlUGF0dGVybih7XG4gICAgICBpZDogYHBhdHRlcm5fJHtEYXRlLm5vdygpfWAsXG4gICAgICB0eXBlOiAnYmVoYXZpb3JhbCcsXG4gICAgICBkYXRhOiBzdGltdWx1cyxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIGNvbmZpZGVuY2U6IDAuOFxuICAgIH0pO1xuXG4gICAgdGhpcy5sb2dnZXI/LmRlYnVnKCdTdGltdWx1cyBwcm9jZXNzZWQnLCB7IHN0aW11bHVzIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idGllbnQgbCfDqXRhdCBjb21wbGV0IGRlIGwnb3JnYW5pc21lXG4gICAqL1xuICBnZXRTdGF0ZSgpOiBPcmdhbmlzbVN0YXRlIHtcbiAgICBjb25zdCB0cmFpdHMgPSB0aGlzLnRyYWl0U2VydmljZS5nZXRBbGxUcmFpdHMoKTtcbiAgICBjb25zdCBlbmVyZ3lTdGF0cyA9IHRoaXMuZW5lcmd5U2VydmljZS5nZXRFbmVyZ3lTdGF0cygpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgdHJhaXRzLFxuICAgICAgZW5lcmd5OiBlbmVyZ3lTdGF0cy5jdXJyZW50LFxuICAgICAgbWF4RW5lcmd5OiBlbmVyZ3lTdGF0cy5tYXgsXG4gICAgICBoZWFsdGg6IHRoaXMuaGVhbHRoLFxuICAgICAgZG5hOiB0aGlzLmRuYSxcbiAgICAgIGxhc3RNdXRhdGlvbjogdGhpcy5sYXN0TXV0YXRpb24sXG4gICAgICBiYWxhbmNlOiB0aGlzLnRyYWl0U2VydmljZS5jYWxjdWxhdGVCYWxhbmNlKCksXG4gICAgICBtZXRhYm9saXNtUmF0ZTogZW5lcmd5U3RhdHMubWV0YWJvbGlzbVJhdGUsXG4gICAgICBhZ2U6IERhdGUubm93KCkgLSBwYXJzZUludCh0aGlzLmlkLnNwbGl0KCdfJylbMV0pIC8vIEFwcHJveGltYXRpb24gYmFzw6llIHN1ciBsJ0lEXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHw6luw6hyZSBsZXMgcGFyYW3DqHRyZXMgZGUgc2hhZGVyIHBvdXIgbGUgcmVuZHUgdmlzdWVsXG4gICAqL1xuICBnZW5lcmF0ZVNoYWRlclBhcmFtZXRlcnMoKTogU2hhZGVyUGFyYW1ldGVycyB7XG4gICAgY29uc3QgdHJhaXRzID0gdGhpcy50cmFpdFNlcnZpY2UuZ2V0QWxsVHJhaXRzKCk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGVuZXJneTogdGhpcy5lbmVyZ3lTZXJ2aWNlLmdldEVuZXJneVBlcmNlbnRhZ2UoKSAvIDEwMCxcbiAgICAgIGhlYWx0aDogdGhpcy5oZWFsdGggLyAxMDAsXG4gICAgICBuZXVyYWxBY3Rpdml0eTogdGhpcy5uZXVyYWxTZXJ2aWNlLmdldE5ldXJhbEFjdGl2aXR5KCksXG4gICAgICBjcmVhdGl2aXR5OiB0cmFpdHMuY3JlYXRpdml0eSxcbiAgICAgIGZvY3VzOiB0cmFpdHMuZm9jdXMsXG4gICAgICB0aW1lOiBEYXRlLm5vdygpIC8gMTAwMCxcbiAgICAgIGNvbG9yUHJpbWFyeTogW3RyYWl0cy5jcmVhdGl2aXR5LCB0cmFpdHMuZW1wYXRoeSwgdHJhaXRzLmludHVpdGlvbl0sXG4gICAgICBjb2xvclNlY29uZGFyeTogW3RyYWl0cy5mb2N1cywgdHJhaXRzLnJlc2lsaWVuY2UsIHRyYWl0cy5hZGFwdGFiaWxpdHldLFxuICAgICAgbW9ycGhvbG9neTogdHJhaXRzLmFkYXB0YWJpbGl0eSxcbiAgICAgIGNvbXBsZXhpdHk6IHRyYWl0cy5jcmVhdGl2aXR5ICogdHJhaXRzLm1lbW9yeVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogU8OpcmlhbGlzYXRpb24gcG91ciBzYXV2ZWdhcmRlXG4gICAqL1xuICB0b0pTT04oKTogT3JnYW5pc21KU09OIHtcbiAgICByZXR1cm4ge1xuICAgICAgbWVzaDoge30sXG4gICAgICBkbmE6IHRoaXMuZG5hLFxuICAgICAgaGVhbHRoOiB0aGlzLmhlYWx0aCxcbiAgICAgIGxhc3RNdXRhdGlvbjogdGhpcy5sYXN0TXV0YXRpb24sXG4gICAgICB0cmFpdHM6IHRoaXMudHJhaXRTZXJ2aWNlLnRvSlNPTigpLFxuICAgICAgZW5lcmd5OiB0aGlzLmVuZXJneVNlcnZpY2UudG9KU09OKCksXG4gICAgICBuZXVyYWw6IHRoaXMubmV1cmFsU2VydmljZS5zYXZlU3RhdGUoKSxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUmVzdGF1cmF0aW9uIGRlcHVpcyBKU09OXG4gICAqL1xuICBmcm9tSlNPTihkYXRhOiBPcmdhbmlzbUpTT04pOiB2b2lkIHtcbiAgICBpZiAoZGF0YS50cmFpdHMpIHtcbiAgICAgIHRoaXMudHJhaXRTZXJ2aWNlLmZyb21KU09OKGRhdGEudHJhaXRzKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGRhdGEuZW5lcmd5KSB7XG4gICAgICB0aGlzLmVuZXJneVNlcnZpY2UuZnJvbUpTT04oZGF0YS5lbmVyZ3kpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoZGF0YS5uZXVyYWwpIHtcbiAgICAgIHRoaXMubmV1cmFsU2VydmljZS5sb2FkU3RhdGUoZGF0YS5uZXVyYWwpO1xuICAgIH1cblxuICAgIHRoaXMuaGVhbHRoID0gZGF0YS5oZWFsdGggfHwgMTAwO1xuICAgIHRoaXMubGFzdE11dGF0aW9uID0gZGF0YS5sYXN0TXV0YXRpb24gfHwgRGF0ZS5ub3coKTtcblxuICAgIHRoaXMubG9nZ2VyPy5kZWJ1ZygnU3RhdGUgcmVzdG9yZWQgZnJvbSBKU09OJywgeyBpZDogdGhpcy5pZCB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBOZXR0b3lhZ2UgZXQgbGliw6lyYXRpb24gZGVzIHJlc3NvdXJjZXNcbiAgICovXG4gIGNsZWFudXAoKTogdm9pZCB7XG4gICAgdGhpcy5lbmVyZ3lTZXJ2aWNlLmRlc3Ryb3koKTtcbiAgICB0aGlzLnRyYWl0U2VydmljZS5jbGVhbnVwKCk7XG4gICAgdGhpcy5uZXVyYWxTZXJ2aWNlLmNsZWFudXAoKTtcbiAgICBcbiAgICB0aGlzLmxvZ2dlcj8uZGVidWcoJ09yZ2FuaXNtQ29yZSBjbGVhbmVkIHVwJywgeyBpZDogdGhpcy5pZCB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWw6lyaWZpY2F0aW9uIGRlIGwnw6l0YXQgZGUgc2FudMOpXG4gICAqL1xuICBoZWFsdGhDaGVjaygpOiB7IGhlYWx0aHk6IGJvb2xlYW47IGlzc3Vlczogc3RyaW5nW10gfSB7XG4gICAgY29uc3QgaXNzdWVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKHRoaXMuaGVhbHRoIDwgMjApIHtcbiAgICAgIGlzc3Vlcy5wdXNoKCdMb3cgaGVhbHRoJyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZW5lcmd5U2VydmljZS5nZXRFbmVyZ3lMZXZlbCgpIDwgMTApIHtcbiAgICAgIGlzc3Vlcy5wdXNoKCdMb3cgZW5lcmd5Jyk7XG4gICAgfVxuXG4gICAgY29uc3QgbmV1cmFsSGVhbHRoID0gdGhpcy5uZXVyYWxTZXJ2aWNlLmhlYWx0aENoZWNrKCk7XG4gICAgaWYgKCFuZXVyYWxIZWFsdGguaGVhbHRoeSkge1xuICAgICAgaXNzdWVzLnB1c2goLi4ubmV1cmFsSGVhbHRoLmlzc3Vlcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGhlYWx0aHk6IGlzc3Vlcy5sZW5ndGggPT09IDAsXG4gICAgICBpc3N1ZXNcbiAgICB9O1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gTcOJVEhPREVTIE1BTlFVQU5URVMgUE9VUiBJT3JnYW5pc21Db3JlXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIEJvb3QgdGhlIG9yZ2FuaXNtXG4gICAqL1xuICBhc3luYyBib290KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEluaXRpYWxpemUgbmV1cmFsIG1lc2ggaWYgbmVlZGVkXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMubmV1cmFsU2VydmljZS5pbml0aWFsaXplKCk7XG4gICAgICB0aGlzLmxvZ2dlcj8uZGVidWcoJ09yZ2FuaXNtIGJvb3RlZCBzdWNjZXNzZnVsbHknLCB7IGlkOiB0aGlzLmlkIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlcj8uZXJyb3IoJ0ZhaWxlZCB0byBib290IG9yZ2FuaXNtJywgeyBpZDogdGhpcy5pZCwgZXJyb3IgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGliZXJuYXRlIHRoZSBvcmdhbmlzbVxuICAgKi9cbiAgYXN5bmMgaGliZXJuYXRlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmVuZXJneVNlcnZpY2Uuc2V0RWZmaWNpZW5jeSgwLjEpOyAvLyBSZWR1Y2UgZW5lcmd5IGNvbnN1bXB0aW9uXG4gICAgICBhd2FpdCB0aGlzLm5ldXJhbFNlcnZpY2Uuc3VzcGVuZCgpO1xuICAgICAgdGhpcy5sb2dnZXI/LmRlYnVnKCdPcmdhbmlzbSBoaWJlcm5hdGVkJywgeyBpZDogdGhpcy5pZCB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXI/LmVycm9yKCdGYWlsZWQgdG8gaGliZXJuYXRlIG9yZ2FuaXNtJywgeyBpZDogdGhpcy5pZCwgZXJyb3IgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIG9yZ2FuaXNtIHdpdGggZGVsdGEgdGltZVxuICAgKi9cbiAgdXBkYXRlKGRlbHRhVGltZTogbnVtYmVyID0gMTYuNjcpOiB2b2lkIHtcbiAgICAvLyBTdGFuZGFyZCBmcmFtZSB0aW1lIHByb2Nlc3NpbmdcbiAgICBjb25zdCB0aW1lRmFjdG9yID0gZGVsdGFUaW1lIC8gMTYuNjc7IC8vIE5vcm1hbGl6ZSB0byA2MGZwc1xuICAgIFxuICAgIC8vIFVwZGF0ZSBlbmVyZ3kgZGVjYXlcbiAgICB0aGlzLmVuZXJneVNlcnZpY2UuY29uc3VtZUVuZXJneSgwLjEgKiB0aW1lRmFjdG9yLCAnbWV0YWJvbGlzbScpO1xuICAgIFxuICAgIC8vIFVwZGF0ZSBuZXVyYWwgcHJvY2Vzc2luZ1xuICAgIHRoaXMubmV1cmFsU2VydmljZS51cGRhdGUoZGVsdGFUaW1lKTtcbiAgICBcbiAgICAvLyBIZWFsdGggcmVnZW5lcmF0aW9uIGlmIGhpZ2ggZW5lcmd5XG4gICAgaWYgKHRoaXMuZW5lcmd5U2VydmljZS5nZXRFbmVyZ3lMZXZlbCgpID4gODApIHtcbiAgICAgIHRoaXMuaGVhbHRoID0gTWF0aC5taW4oMTAwLCB0aGlzLmhlYWx0aCArICgwLjEgKiB0aW1lRmFjdG9yKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0aW11bGF0ZSBvcmdhbmlzbSBpbnB1dFxuICAgKi9cbiAgc3RpbXVsYXRlKGlucHV0SWQ6IHN0cmluZywgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMubmV1cmFsU2VydmljZS5zdGltdWxhdGUoaW5wdXRJZCwgdmFsdWUpO1xuICAgIFxuICAgIC8vIENvbnN1bWUgZW5lcmd5IGZvciBwcm9jZXNzaW5nXG4gICAgdGhpcy5lbmVyZ3lTZXJ2aWNlLmNvbnN1bWVFbmVyZ3koMC41LCBgc3RpbXVsYXRpb25fJHtpbnB1dElkfWApO1xuICB9XG5cbiAgLyoqXG4gICAqIE11dGF0ZSBvcmdhbmlzbSB3aXRoIGdpdmVuIHJhdGVcbiAgICovXG4gIG11dGF0ZShyYXRlOiBudW1iZXIgPSAwLjAxKTogdm9pZCB7XG4gICAgY29uc3QgdHJhaXRzID0gdGhpcy50cmFpdFNlcnZpY2UuZ2V0QWxsVHJhaXRzKCk7XG4gICAgY29uc3QgbXV0YXRpb25zOiB7IFtrZXk6IHN0cmluZ106IG51bWJlciB9ID0ge307XG4gICAgXG4gICAgLy8gTXV0YXRlIGVhY2ggdHJhaXQgYmFzZWQgb24gcmF0ZVxuICAgIE9iamVjdC5rZXlzKHRyYWl0cykuZm9yRWFjaCh0cmFpdE5hbWUgPT4ge1xuICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCByYXRlKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IHRyYWl0c1t0cmFpdE5hbWUgYXMga2V5b2YgT3JnYW5pc21UcmFpdHNdO1xuICAgICAgICBjb25zdCBtdXRhdGlvbiA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuMTsgLy8gwrE1JSBtdXRhdGlvblxuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIGN1cnJlbnRWYWx1ZSArIG11dGF0aW9uKSk7XG4gICAgICAgIG11dGF0aW9uc1t0cmFpdE5hbWVdID0gbmV3VmFsdWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgLy8gQXBwbHkgbXV0YXRpb25zXG4gICAgaWYgKE9iamVjdC5rZXlzKG11dGF0aW9ucykubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy50cmFpdFNlcnZpY2UudXBkYXRlVHJhaXRzKG11dGF0aW9ucyBhcyBQYXJ0aWFsPE9yZ2FuaXNtVHJhaXRzPiwgJ211dGF0aW9uJyk7XG4gICAgICB0aGlzLmxhc3RNdXRhdGlvbiA9IERhdGUubm93KCk7XG4gICAgICB0aGlzLmxvZ2dlcj8uZGVidWcoJ011dGF0aW9uIGFwcGxpZWQnLCB7IGlkOiB0aGlzLmlkLCBtdXRhdGlvbnMgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZlZWQgb3JnYW5pc20gd2l0aCBlbmVyZ3lcbiAgICovXG4gIGZlZWQoYW1vdW50OiBudW1iZXIgPSAxMCk6IHZvaWQge1xuICAgIHRoaXMuZW5lcmd5U2VydmljZS5hZGRFbmVyZ3koYW1vdW50KTtcbiAgICB0aGlzLmxvZ2dlcj8uZGVidWcoJ09yZ2FuaXNtIGZlZCcsIHsgaWQ6IHRoaXMuaWQsIGFtb3VudCB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdHJhaXRzIChwYXJ0aWFsIHVwZGF0ZSlcbiAgICovXG4gIHNldFRyYWl0cyh0cmFpdHM6IFBhcnRpYWw8T3JnYW5pc21UcmFpdHM+KTogdm9pZCB7XG4gICAgdGhpcy50cmFpdFNlcnZpY2UudXBkYXRlVHJhaXRzKHRyYWl0cywgJ2V4dGVybmFsX3VwZGF0ZScpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAqL1xuICBhc3luYyBnZXRQZXJmb3JtYW5jZU1ldHJpY3MoKSB7XG4gICAgY29uc3QgbmV1cmFsTWV0cmljcyA9IHRoaXMubmV1cmFsU2VydmljZS5nZXRQZXJmb3JtYW5jZU1ldHJpY3MoKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgY3B1OiBhd2FpdCB0aGlzLm1ldHJpY3NTZXJ2aWNlLmdldENQVVVzYWdlKCksXG4gICAgICBtZW1vcnk6IGF3YWl0IHRoaXMubWV0cmljc1NlcnZpY2UuZ2V0TWVtb3J5VXNhZ2UoKSxcbiAgICAgIG5ldXJhbEFjdGl2aXR5OiBuZXVyYWxNZXRyaWNzPy5uZXVyYWxBY3Rpdml0eSB8fCAwLFxuICAgICAgY29ubmVjdGlvblN0cmVuZ3RoOiBuZXVyYWxNZXRyaWNzPy5jb25uZWN0aW9uU3RyZW5ndGggfHwgMFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNoYWRlciBwYXJhbWV0ZXJzIGZvciBXZWJHTCByZW5kZXJpbmdcbiAgICovXG4gIGdldFNoYWRlclBhcmFtZXRlcnMoKTogU2hhZGVyUGFyYW1ldGVycyB7XG4gICAgY29uc3QgdHJhaXRzID0gdGhpcy5nZXRUcmFpdHMoKTtcbiAgICBjb25zdCBlbmVyZ3kgPSB0aGlzLmVuZXJneVNlcnZpY2UuZ2V0RW5lcmd5TGV2ZWwoKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgZW5lcmd5OiBlbmVyZ3kgLyAxMDAsXG4gICAgICBoZWFsdGg6IHRoaXMuaGVhbHRoIC8gMTAwLFxuICAgICAgbmV1cmFsQWN0aXZpdHk6IHRoaXMubmV1cmFsU2VydmljZS5nZXROZXVyYWxBY3Rpdml0eSgpIHx8IDAsXG4gICAgICBjcmVhdGl2aXR5OiB0cmFpdHMuY3JlYXRpdml0eSxcbiAgICAgIGZvY3VzOiB0cmFpdHMuZm9jdXMsXG4gICAgICB0aW1lOiBEYXRlLm5vdygpIC8gMTAwMFxuICAgIH07XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=