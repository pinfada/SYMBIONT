dfdcb074a531f7da13b8e00bb8d3f47e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.secureRandomFloat = exports.secureRandomInt = exports.secureRandom = exports.SecureRandom = void 0;
const secureLogger_1 = require("@shared/utils/secureLogger");
/**
 * Utilitaires de génération de nombres aléatoires sécurisés
 * Remplace Math.random() par crypto.getRandomValues() pour la sécurité cryptographique
 */
class SecureRandom {
    /**
     * Génère un nombre aléatoire sécurisé entre 0 et 1 (équivalent Math.random())
     */
    static random() {
        if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
            const array = new Uint32Array(1);
            crypto.getRandomValues(array);
            return array[0] / (this.MAX_UINT32 + 1);
        }
        // Fallback pour les environnements sans crypto
        secureLogger_1.SecureLogger.warn('SecureRandom: crypto.getRandomValues non disponible, utilisation de Math.random()');
        return Math.random();
    }
    /**
     * Génère un entier aléatoire sécurisé dans une plage
     */
    static randomInt(min, max) {
        if (min >= max) {
            throw new Error('SecureRandom: min doit être inférieur à max');
        }
        const range = max - min;
        return Math.floor(this.random() * range) + min;
    }
    /**
     * Génère un nombre flottant aléatoire sécurisé dans une plage
     */
    static randomFloat(min, max) {
        if (min >= max) {
            throw new Error('SecureRandom: min doit être inférieur à max');
        }
        return this.random() * (max - min) + min;
    }
    /**
     * Génère des bytes aléatoires sécurisés
     */
    static randomBytes(length) {
        if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
            const array = new Uint8Array(length);
            crypto.getRandomValues(array);
            return array;
        }
        // Fallback pour les environnements sans crypto
        secureLogger_1.SecureLogger.warn('SecureRandom: crypto.getRandomValues non disponible, génération fallback');
        const array = new Uint8Array(length);
        for (let i = 0; i < length; i++) {
            array[i] = Math.floor(Math.random() * 256);
        }
        return array;
    }
    /**
     * Sélectionne un élément aléatoire d'un tableau
     */
    static choice(array) {
        if (array.length === 0) {
            throw new Error('SecureRandom: Le tableau ne peut pas être vide');
        }
        const index = this.randomInt(0, array.length);
        return array[index];
    }
    /**
     * Génère un UUID v4 sécurisé
     */
    static uuid() {
        if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
            const bytes = new Uint8Array(16);
            crypto.getRandomValues(bytes);
            // Version 4 UUID format
            bytes[6] = (bytes[6] & 0x0f) | 0x40; // Version 4
            bytes[8] = (bytes[8] & 0x3f) | 0x80; // Variant 10
            const hex = Array.from(bytes, b => b.toString(16).padStart(2, '0')).join('');
            return [
                hex.slice(0, 8),
                hex.slice(8, 12),
                hex.slice(12, 16),
                hex.slice(16, 20),
                hex.slice(20, 32)
            ].join('-');
        }
        // Fallback UUID generation
        secureLogger_1.SecureLogger.warn('SecureRandom: crypto.getRandomValues non disponible, UUID fallback');
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
            const r = Math.random() * 16 | 0;
            const v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }
    /**
     * Génère une chaîne aléatoire sécurisée
     */
    static randomString(length, charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789') {
        let result = '';
        for (let i = 0; i < length; i++) {
            result += charset.charAt(this.randomInt(0, charset.length));
        }
        return result;
    }
    /**
     * Génère un ID court sécurisé pour les identifiants
     */
    static randomId(prefix = '', length = 8) {
        const id = this.randomString(length, 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789');
        return prefix ? `${prefix}_${id}` : id;
    }
}
exports.SecureRandom = SecureRandom;
SecureRandom.MAX_UINT32 = 0xFFFFFFFF;
// Alias pour une migration facile depuis Math.random()
exports.secureRandom = SecureRandom.random;
exports.secureRandomInt = SecureRandom.randomInt;
exports.secureRandomFloat = SecureRandom.randomFloat;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL21udC9jL1VzZXJzL21fb2xpL1Byb2pldHMvU1lNQklPTlQvc3JjL3NoYXJlZC91dGlscy9zZWN1cmVSYW5kb20udHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkRBQTBEO0FBQzFEOzs7R0FHRztBQUVILE1BQWEsWUFBWTtJQUd2Qjs7T0FFRztJQUNILE1BQU0sQ0FBQyxNQUFNO1FBQ1gsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLElBQUksTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQzVELE1BQU0sS0FBSyxHQUFHLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLE1BQU0sQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUIsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzFDLENBQUM7UUFFRCwrQ0FBK0M7UUFDL0MsMkJBQVksQ0FBQyxJQUFJLENBQUMsbUZBQW1GLENBQUMsQ0FBQztRQUN2RyxPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQVcsRUFBRSxHQUFXO1FBQ3ZDLElBQUksR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQ2YsTUFBTSxJQUFJLEtBQUssQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO1FBQ2pFLENBQUM7UUFFRCxNQUFNLEtBQUssR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO1FBQ3hCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQ2pELENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBVyxFQUFFLEdBQVc7UUFDekMsSUFBSSxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7WUFDZixNQUFNLElBQUksS0FBSyxDQUFDLDZDQUE2QyxD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RyxVQUFVLENBQUM7QUEwSGxELHVEQUF1RDtBQUMxQyxRQUFBLFlBQVksR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDO0FBQ25DLFFBQUEsZUFBZSxHQUFHLFlBQVksQ0FBQyxTQUFTLENBQUM7QUFDekMsUUFBQSxpQkFBaUIsR0FBRyxZQUFZLENBQUMsV0FBVyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9tbnQvYy9Vc2Vycy9tX29saS9Qcm9qZXRzL1NZTUJJT05UL3NyYy9zaGFyZWQvdXRpbHMvc2VjdXJlUmFuZG9tLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNlY3VyZUxvZ2dlciB9IGZyb20gJ0BzaGFyZWQvdXRpbHMvc2VjdXJlTG9nZ2VyJztcbi8qKlxuICogVXRpbGl0YWlyZXMgZGUgZ8OpbsOpcmF0aW9uIGRlIG5vbWJyZXMgYWzDqWF0b2lyZXMgc8OpY3VyaXPDqXNcbiAqIFJlbXBsYWNlIE1hdGgucmFuZG9tKCkgcGFyIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMoKSBwb3VyIGxhIHPDqWN1cml0w6kgY3J5cHRvZ3JhcGhpcXVlXG4gKi9cblxuZXhwb3J0IGNsYXNzIFNlY3VyZVJhbmRvbSB7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IE1BWF9VSU5UMzIgPSAweEZGRkZGRkZGO1xuXG4gIC8qKlxuICAgKiBHw6luw6hyZSB1biBub21icmUgYWzDqWF0b2lyZSBzw6ljdXJpc8OpIGVudHJlIDAgZXQgMSAow6lxdWl2YWxlbnQgTWF0aC5yYW5kb20oKSlcbiAgICovXG4gIHN0YXRpYyByYW5kb20oKTogbnVtYmVyIHtcbiAgICBpZiAodHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLmdldFJhbmRvbVZhbHVlcykge1xuICAgICAgY29uc3QgYXJyYXkgPSBuZXcgVWludDMyQXJyYXkoMSk7XG4gICAgICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGFycmF5KTtcbiAgICAgIHJldHVybiBhcnJheVswXSAvICh0aGlzLk1BWF9VSU5UMzIgKyAxKTtcbiAgICB9XG4gICAgXG4gICAgLy8gRmFsbGJhY2sgcG91ciBsZXMgZW52aXJvbm5lbWVudHMgc2FucyBjcnlwdG9cbiAgICBTZWN1cmVMb2dnZXIud2FybignU2VjdXJlUmFuZG9tOiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzIG5vbiBkaXNwb25pYmxlLCB1dGlsaXNhdGlvbiBkZSBNYXRoLnJhbmRvbSgpJyk7XG4gICAgcmV0dXJuIE1hdGgucmFuZG9tKCk7XG4gIH1cblxuICAvKipcbiAgICogR8OpbsOocmUgdW4gZW50aWVyIGFsw6lhdG9pcmUgc8OpY3VyaXPDqSBkYW5zIHVuZSBwbGFnZVxuICAgKi9cbiAgc3RhdGljIHJhbmRvbUludChtaW46IG51bWJlciwgbWF4OiBudW1iZXIpOiBudW1iZXIge1xuICAgIGlmIChtaW4gPj0gbWF4KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlY3VyZVJhbmRvbTogbWluIGRvaXQgw6p0cmUgaW5mw6lyaWV1ciDDoCBtYXgnKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgcmFuZ2UgPSBtYXggLSBtaW47XG4gICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy5yYW5kb20oKSAqIHJhbmdlKSArIG1pbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBHw6luw6hyZSB1biBub21icmUgZmxvdHRhbnQgYWzDqWF0b2lyZSBzw6ljdXJpc8OpIGRhbnMgdW5lIHBsYWdlXG4gICAqL1xuICBzdGF0aWMgcmFuZG9tRmxvYXQobWluOiBudW1iZXIsIG1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBpZiAobWluID49IG1heCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTZWN1cmVSYW5kb206IG1pbiBkb2l0IMOqdHJlIGluZsOpcmlldXIgw6AgbWF4Jyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0aGlzLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW47XG4gIH1cblxuICAvKipcbiAgICogR8OpbsOocmUgZGVzIGJ5dGVzIGFsw6lhdG9pcmVzIHPDqWN1cmlzw6lzXG4gICAqL1xuICBzdGF0aWMgcmFuZG9tQnl0ZXMobGVuZ3RoOiBudW1iZXIpOiBVaW50OEFycmF5IHtcbiAgICBpZiAodHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLmdldFJhbmRvbVZhbHVlcykge1xuICAgICAgY29uc3QgYXJyYXkgPSBuZXcgVWludDhBcnJheShsZW5ndGgpO1xuICAgICAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhhcnJheSk7XG4gICAgICByZXR1cm4gYXJyYXk7XG4gICAgfVxuICAgIFxuICAgIC8vIEZhbGxiYWNrIHBvdXIgbGVzIGVudmlyb25uZW1lbnRzIHNhbnMgY3J5cHRvXG4gICAgU2VjdXJlTG9nZ2VyLndhcm4oJ1NlY3VyZVJhbmRvbTogY3J5cHRvLmdldFJhbmRvbVZhbHVlcyBub24gZGlzcG9uaWJsZSwgZ8OpbsOpcmF0aW9uIGZhbGxiYWNrJyk7XG4gICAgY29uc3QgYXJyYXkgPSBuZXcgVWludDhBcnJheShsZW5ndGgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGFycmF5W2ldID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU2KTtcbiAgICB9XG4gICAgcmV0dXJuIGFycmF5O1xuICB9XG5cbiAgLyoqXG4gICAqIFPDqWxlY3Rpb25uZSB1biDDqWzDqW1lbnQgYWzDqWF0b2lyZSBkJ3VuIHRhYmxlYXVcbiAgICovXG4gIHN0YXRpYyBjaG9pY2U8VD4oYXJyYXk6IFRbXSk6IFQge1xuICAgIGlmIChhcnJheS5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU2VjdXJlUmFuZG9tOiBMZSB0YWJsZWF1IG5lIHBldXQgcGFzIMOqdHJlIHZpZGUnKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgaW5kZXggPSB0aGlzLnJhbmRvbUludCgwLCBhcnJheS5sZW5ndGgpO1xuICAgIHJldHVybiBhcnJheVtpbmRleF07XG4gIH1cblxuICAvKipcbiAgICogR8OpbsOocmUgdW4gVVVJRCB2NCBzw6ljdXJpc8OpXG4gICAqL1xuICBzdGF0aWMgdXVpZCgpOiBzdHJpbmcge1xuICAgIGlmICh0eXBlb2YgY3J5cHRvICE9PSAndW5kZWZpbmVkJyAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKSB7XG4gICAgICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KDE2KTtcbiAgICAgIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMoYnl0ZXMpO1xuICAgICAgXG4gICAgICAvLyBWZXJzaW9uIDQgVVVJRCBmb3JtYXRcbiAgICAgIGJ5dGVzWzZdID0gKGJ5dGVzWzZdICYgMHgwZikgfCAweDQwOyAvLyBWZXJzaW9uIDRcbiAgICAgIGJ5dGVzWzhdID0gKGJ5dGVzWzhdICYgMHgzZikgfCAweDgwOyAvLyBWYXJpYW50IDEwXG5cbiAgICAgIGNvbnN0IGhleCA9IEFycmF5LmZyb20oYnl0ZXMsIGIgPT4gYi50b1N0cmluZygxNikucGFkU3RhcnQoMiwgJzAnKSkuam9pbignJyk7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBoZXguc2xpY2UoMCwgOCksXG4gICAgICAgIGhleC5zbGljZSg4LCAxMiksXG4gICAgICAgIGhleC5zbGljZSgxMiwgMTYpLFxuICAgICAgICBoZXguc2xpY2UoMTYsIDIwKSxcbiAgICAgICAgaGV4LnNsaWNlKDIwLCAzMilcbiAgICAgIF0uam9pbignLScpO1xuICAgIH1cbiAgICBcbiAgICAvLyBGYWxsYmFjayBVVUlEIGdlbmVyYXRpb25cbiAgICBTZWN1cmVMb2dnZXIud2FybignU2VjdXJlUmFuZG9tOiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzIG5vbiBkaXNwb25pYmxlLCBVVUlEIGZhbGxiYWNrJyk7XG4gICAgcmV0dXJuICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgKGMpID0+IHtcbiAgICAgIGNvbnN0IHIgPSBNYXRoLnJhbmRvbSgpICogMTYgfCAwO1xuICAgICAgY29uc3QgdiA9IGMgPT09ICd4JyA/IHIgOiAociAmIDB4MyB8IDB4OCk7XG4gICAgICByZXR1cm4gdi50b1N0cmluZygxNik7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR8OpbsOocmUgdW5lIGNoYcOubmUgYWzDqWF0b2lyZSBzw6ljdXJpc8OpZVxuICAgKi9cbiAgc3RhdGljIHJhbmRvbVN0cmluZyhsZW5ndGg6IG51bWJlciwgY2hhcnNldCA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OScpOiBzdHJpbmcge1xuICAgIGxldCByZXN1bHQgPSAnJztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICByZXN1bHQgKz0gY2hhcnNldC5jaGFyQXQodGhpcy5yYW5kb21JbnQoMCwgY2hhcnNldC5sZW5ndGgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHw6luw6hyZSB1biBJRCBjb3VydCBzw6ljdXJpc8OpIHBvdXIgbGVzIGlkZW50aWZpYW50c1xuICAgKi9cbiAgc3RhdGljIHJhbmRvbUlkKHByZWZpeCA9ICcnLCBsZW5ndGggPSA4KTogc3RyaW5nIHtcbiAgICBjb25zdCBpZCA9IHRoaXMucmFuZG9tU3RyaW5nKGxlbmd0aCwgJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Jyk7XG4gICAgcmV0dXJuIHByZWZpeCA/IGAke3ByZWZpeH1fJHtpZH1gIDogaWQ7XG4gIH1cbn1cblxuLy8gQWxpYXMgcG91ciB1bmUgbWlncmF0aW9uIGZhY2lsZSBkZXB1aXMgTWF0aC5yYW5kb20oKVxuZXhwb3J0IGNvbnN0IHNlY3VyZVJhbmRvbSA9IFNlY3VyZVJhbmRvbS5yYW5kb207XG5leHBvcnQgY29uc3Qgc2VjdXJlUmFuZG9tSW50ID0gU2VjdXJlUmFuZG9tLnJhbmRvbUludDtcbmV4cG9ydCBjb25zdCBzZWN1cmVSYW5kb21GbG9hdCA9IFNlY3VyZVJhbmRvbS5yYW5kb21GbG9hdDsiXSwidmVyc2lvbiI6M30=