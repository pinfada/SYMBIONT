{"version":3,"names":["cov_2p5vbppycy","actualCoverage","s","secureRandom_1","require","DistributedOrganismNetwork","constructor","f","peers","Set","organismState","peerId","SecureRandom","random","toString","substr","channel","BroadcastChannel","onmessage","event","handleMessage","data","announce","postMessage","type","joinNetwork","add","console","log","leaveNetwork","delete","broadcastMutation","mutation","from","size","receiveMutation","fromPeer","performCommunityBackup","state","msg","b","exports"],"sources":["/mnt/c/Users/m_oli/Projets/SYMBIONT/src/social/distributed-organism-network.ts"],"sourcesContent":["// social/distributed-organism-network.ts\r\n// Réseau distribué d'organismes (Phase 3)\r\nimport { SecureRandom } from '../shared/utils/secureRandom';\n\r\nexport class DistributedOrganismNetwork {\r\n  private peers: Set<string> = new Set()\r\n  // @ts-expect-error État d'organisme réservé pour usage futur\r\n  private organismState: any = null\r\n  private channel: BroadcastChannel\r\n  private peerId: string\r\n\r\n  constructor() {\r\n    this.peerId = 'peer_' + SecureRandom.random().toString(36).substr(2, 8)\r\n    this.channel = new BroadcastChannel('symbiont_network')\r\n    this.channel.onmessage = (event) => this.handleMessage(event.data)\r\n    // S'annonce à la création\r\n    this.announce()\r\n  }\r\n\r\n  private announce() {\r\n    this.channel.postMessage({ type: 'announce', peerId: this.peerId })\r\n  }\r\n\r\n  joinNetwork(peerId: string) {\r\n    this.peers.add(peerId)\r\n    this.channel.postMessage({ type: 'join', peerId: this.peerId })\r\n    console.log(`[Network] Pair rejoint : ${peerId}`)\r\n  }\r\n\r\n  leaveNetwork(peerId: string) {\r\n    this.peers.delete(peerId)\r\n    this.channel.postMessage({ type: 'leave', peerId: this.peerId })\r\n    console.log(`[Network] Pair quitté : ${peerId}`)\r\n  }\r\n\r\n  broadcastMutation(mutation: any) {\r\n    this.channel.postMessage({ type: 'mutation', from: this.peerId, mutation })\r\n    console.log(`[Network] Diffusion mutation à ${this.peers.size} pairs`)\r\n  }\r\n\r\n  receiveMutation(mutation: any, fromPeer: string) {\r\n    // Appliquer la mutation reçue (log pour l'instant)\r\n    console.log(`[Network] Mutation reçue de ${fromPeer}`, mutation)\r\n  }\r\n\r\n  performCommunityBackup(state: any) {\r\n    this.channel.postMessage({ type: 'backup', from: this.peerId, state })\r\n    console.log(`[Network] Backup communautaire lancé`)\r\n  }\r\n\r\n  private handleMessage(msg: any) {\r\n    if (msg.peerId === this.peerId) return // Ignore self\r\n    switch (msg.type) {\r\n      case 'announce':\r\n        this.peers.add(msg.peerId)\r\n        break\r\n      case 'join':\r\n        this.peers.add(msg.peerId)\r\n        break\r\n      case 'leave':\r\n        this.peers.delete(msg.peerId)\r\n        break\r\n      case 'mutation':\r\n        this.receiveMutation(msg.mutation, msg.from)\r\n        break\r\n      case 'backup':\r\n        // Pour l'instant, log seulement\r\n        console.log(`[Network] Backup reçu de ${msg.from}`, msg.state)\r\n        break\r\n    }\r\n  }\r\n} "],"mappings":"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","ignoreList":[]}