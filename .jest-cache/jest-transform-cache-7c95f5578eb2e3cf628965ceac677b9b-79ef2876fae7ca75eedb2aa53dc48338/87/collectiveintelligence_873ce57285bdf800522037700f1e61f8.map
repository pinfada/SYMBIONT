{"version":3,"names":["cov_2c31ar482u","actualCoverage","s","secureRandom_1","require","CollectiveIntelligence","constructor","onCollectiveMutation","f","proposals","Map","votes","peerId","SecureRandom","random","toString","substr","b","proposeMutation","mutation","proposerId","has","id","set","Set","get","push","vote","console","log","mutationId","voterId","add","aggregateVotes","size","triggerCollectiveMutation","totalPeers","consensus","Math","max","floor","exports"],"sources":["/mnt/c/Users/m_oli/Projets/SYMBIONT/src/social/collective-intelligence.ts"],"sourcesContent":["// social/collective-intelligence.ts\r\n// Intelligence collective émergente (Phase 3)\r\nimport { SecureRandom } from '../shared/utils/secureRandom';\n\r\nexport class CollectiveIntelligence {\r\n  private proposals: Map<string, any[]> = new Map()\r\n  private votes: Map<string, Set<string>> = new Map()\r\n  // @ts-expect-error Peer ID réservé pour usage futur\r\n  private peerId: string\r\n  private onCollectiveMutation: ((mutationId: string) => void) | null = null\r\n\r\n  constructor(onCollectiveMutation?: (mutationId: string) => void) {\r\n    this.peerId = 'peer_' + SecureRandom.random().toString(36).substr(2, 8)\r\n    if (onCollectiveMutation) this.onCollectiveMutation = onCollectiveMutation\r\n  }\r\n\r\n  proposeMutation(mutation: any, proposerId: string) {\r\n    if (!this.proposals.has(mutation.id)) {\r\n      this.proposals.set(mutation.id, [])\r\n      this.votes.set(mutation.id, new Set())\r\n    }\r\n    this.proposals.get(mutation.id)!.push({ mutation, proposerId })\r\n    // Vote automatiquement pour sa propre proposition\r\n    this.vote(mutation.id, proposerId)\r\n    console.log(`[Collective] Mutation proposée par ${proposerId}`)\r\n  }\r\n\r\n  vote(mutationId: string, voterId: string) {\r\n    if (!this.votes.has(mutationId)) this.votes.set(mutationId, new Set())\r\n    this.votes.get(mutationId)!.add(voterId)\r\n    console.log(`[Collective] Vote de ${voterId} pour mutation ${mutationId}`)\r\n  }\r\n\r\n  aggregateVotes(mutationId: string): number {\r\n    return this.votes.get(mutationId)?.size || 0\r\n  }\r\n\r\n  triggerCollectiveMutation(mutationId: string, totalPeers: number): boolean {\r\n    const votes = this.aggregateVotes(mutationId)\r\n    const consensus = votes > Math.max(1, Math.floor(totalPeers / 2))\r\n    if (consensus) {\r\n      console.log(`[Collective] Mutation collective déclenchée : ${mutationId}`)\r\n      if (this.onCollectiveMutation) this.onCollectiveMutation(mutationId)\r\n      return true\r\n    } else {\r\n      console.log(`[Collective] Consensus non atteint pour ${mutationId} (${votes}/${totalPeers})`)\r\n      return false\r\n    }\r\n  }\r\n} "],"mappings":"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","ignoreList":[]}