32f9b54219b41d7154265b4a2f8ab161
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock service-worker-adapter before importing SecurityManager
jest.mock('../src/background/service-worker-adapter', () => ({
    swCryptoAPI: {
        subtle: global.crypto.subtle,
        getRandomValues: global.crypto.getRandomValues
    }
}));
const SecurityManager_1 = require("../src/background/SecurityManager");
describe('SecurityManager', () => {
    let security;
    beforeEach(() => {
        jest.clearAllMocks();
        // Clear Chrome storage mock data
        const mockStorageData = global.chrome.storage.local;
        if (mockStorageData && mockStorageData._mockData) {
            mockStorageData._mockData = {};
        }
        // Ensure fresh mocks for each test
        global.crypto.subtle.generateKey.mockClear();
        global.crypto.subtle.encrypt.mockClear();
        global.crypto.subtle.decrypt.mockClear();
        global.crypto.subtle.digest.mockClear();
        security = new SecurityManager_1.SecurityManager();
    });
    describe('Chiffrement/Déchiffrement', () => {
        it('chiffre et déchiffre correctement les données', async () => {
            const testData = { foo: 'bar', n: 42 };
            // Mock successful encryption
            const mockEncryptedBuffer = new Uint8Array(32);
            mockEncryptedBuffer.fill(0xAB);
            global.crypto.subtle.encrypt.mockResolvedValue(mockEncryptedBuffer.buffer);
            // Mock successful decryption
            const testDataString = JSON.stringify(testData);
            const mockDecryptedBuffer = new TextEncoder().encode(testDataString);
            global.crypto.subtle.decrypt.mockResolvedValue(mockDecryptedBuffer.buffer);
            // Test encryption
            const encrypted = await security.encryptSensitiveData(testData);
            expect(typeof encrypted).toBe('string');
            expect(encrypted.length).toBeGreaterThan(0);
            expect(global.crypto.subtle.encrypt).toHaveBeenCalled();
            // Test decryption  
            const decrypted = await security.decryptSensitiveData(encrypted);
            expect(decrypted).toEqual(testData);
            expect(global.crypto.subtle.decrypt).toHaveBeenCalled();
        });
        it('gère les erreurs de chiffrement gracieusement', async () => {
            global.crypto.subtle.encrypt.mockRejectedValue(new Error('Crypto failure'));
            await expect(security.encryptSensitiveData({})).rejects.toThrow('Échec du chiffrement des données sensibles');
        });
        it('gère les erreurs de déchiffrement gracieusement', async () => {
            global.crypto.subtle.decrypt.mockRejectedValue(new Error('Decrypt failure'));
            await expect(security.decryptSensitiveData('invalid')).rejects.toThrow('Échec du déchiffrement des données');
        });
    });
    describe('Anonymisation', () => {
        it('anonymise les données comportementales (async)', async () => {
            const pattern = {
                url: 'https://secret.com',
                interactions: 5,
                timeSpent: 10,
                scrollDepth: 0.8,
                timestamp: Date.now()
            };
            const anonymized = await security.anonymizeForSharing(pattern);
            expect(anonymized.url).toBe('anonymized');
            expect(anonymized.interactions).toBe(pattern.interactions);
            expect(anonymized.timeSpent).toBe(pattern.timeSpent);
            expect(anonymized.scrollDepth).toBe(pattern.scrollDepth);
        });
        it('anonymise les données comportementales (sync)', () => {
            const pattern = {
                url: 'https://secret.com',
                userId: 'user123',
                interactions: 5,
                timeSpent: 10,
                scrollDepth: 0.8,
                timestamp: Date.now()
            };
            const anonymized = security.anonymizeForSharingSync(pattern);
            expect(anonymized.url).toBe('anonymized');
            expect(anonymized.userId).not.toBe('user123'); // Hashé
            expect(typeof anonymized.userId).toBe('string');
        });
        it('supprime les champs sensibles', async () => {
            const pattern = {
                url: 'https://secret.com',
                email: 'test@example.com',
                name: 'John Doe',
                phone: '123456789',
                interactions: 5
            };
            const anonymized = await security.anonymizeForSharing(pattern);
            expect(anonymized.email).toBeUndefined();
            expect(anonymized.name).toBeUndefined();
            expect(anonymized.phone).toBeUndefined();
            expect(anonymized.interactions).toBe(5);
        });
    });
    describe('Contrôle d\'accès', () => {
        it('valide l\'accès utilisateur basique', () => {
            const request = { userId: 'user123', resource: 'organisms' };
            expect(security.validateDataAccess(request)).toBe(true);
        });
        it('rejette l\'accès admin sans rôle admin', () => {
            const request = { userId: 'user123', resource: 'admin', role: 'user' };
            expect(security.validateDataAccess(request, 'admin')).toBe(false);
        });
        it('accepte l\'accès admin avec rôle admin', () => {
            const request = { userId: 'admin123', resource: 'admin', role: 'admin' };
            expect(security.validateDataAccess(request, 'admin')).toBe(true);
        });
        it('rejette les requêtes invalides', () => {
            expect(security.validateDataAccess({ userId: '', resource: 'test' })).toBe(false);
            expect(security.validateDataAccess({ userId: 'user', resource: '' })).toBe(false);
        });
    });
    describe('Hashage', () => {
        it('hash des chaînes avec SHA-256', async () => {
            const testString = 'test-string';
            // Mock digest to return a proper hash
            const mockHashBuffer = new Uint8Array(32);
            mockHashBuffer.fill(0xCD, 0, 16);
            mockHashBuffer.fill(0xEF, 16, 32);
            global.crypto.subtle.digest.mockResolvedValue(mockHashBuffer.buffer);
            const hash = await security.hash(testString);
            expect(typeof hash).toBe('string');
            expect(hash.length).toBeGreaterThan(0);
            expect(global.crypto.subtle.digest).toHaveBeenCalledWith('SHA-256', expect.any(Uint8Array));
        });
        it('produit des hashs cohérents', async () => {
            const testString = 'consistent-test';
            // Mock consistent hash output
            const mockHashBuffer = new Uint8Array(32);
            mockHashBuffer.fill(0x42);
            global.crypto.subtle.digest.mockResolvedValue(mockHashBuffer.buffer);
            const hash1 = await security.hash(testString);
            const hash2 = await security.hash(testString);
            expect(hash1).toBe(hash2);
        });
        it('hash sync fonctionne comme fallback', () => {
            const testString = 'sync-test';
            const hash = security.hashSync(testString);
            expect(typeof hash).toBe('string');
            expect(hash.length).toBeGreaterThan(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL21udC9jL1VzZXJzL21fb2xpL1Byb2pldHMvU1lNQklPTlQvX190ZXN0c19fL1NlY3VyaXR5TWFuYWdlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsK0RBQStEO0FBQy9ELElBQUksQ0FBQyxJQUFJLENBQUMsMENBQTBDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMzRCxXQUFXLEVBQUU7UUFDWCxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNO1FBQzVCLGVBQWUsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLGVBQWU7S0FDL0M7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLHVFQUFtRTtBQUVuRSxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLElBQUksUUFBeUIsQ0FBQztJQUU5QixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLGlDQUFpQztRQUNqQyxNQUFNLGVBQWUsR0FBUyxNQUFjLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7UUFDbEUsSUFBSSxlQUFlLElBQUksZUFBZSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ2pELGVBQWUsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ2pDLENBQUM7UUFFRCxtQ0FBbUM7UUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBeUIsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUMzRCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFxQixDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ3ZELE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQXFCLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDdkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBb0IsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUV2RCxRQUFRLEdBQUcsSUFBSSxpQ0FBZSxFQUFFLENBQUM7SUFDbkMsQ0FBQyxDQUFDLENBQUM7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LElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUU5QyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUM7WUFDL0IsTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUUzQyxNQUFNLENBQUMsT0FBTyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbkMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9tbnQvYy9Vc2Vycy9tX29saS9Qcm9qZXRzL1NZTUJJT05UL19fdGVzdHNfXy9TZWN1cml0eU1hbmFnZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBNb2NrIHNlcnZpY2Utd29ya2VyLWFkYXB0ZXIgYmVmb3JlIGltcG9ydGluZyBTZWN1cml0eU1hbmFnZXJcclxuamVzdC5tb2NrKCcuLi9zcmMvYmFja2dyb3VuZC9zZXJ2aWNlLXdvcmtlci1hZGFwdGVyJywgKCkgPT4gKHtcclxuICBzd0NyeXB0b0FQSToge1xyXG4gICAgc3VidGxlOiBnbG9iYWwuY3J5cHRvLnN1YnRsZSxcclxuICAgIGdldFJhbmRvbVZhbHVlczogZ2xvYmFsLmNyeXB0by5nZXRSYW5kb21WYWx1ZXNcclxuICB9XHJcbn0pKTtcclxuXHJcbmltcG9ydCB7IFNlY3VyaXR5TWFuYWdlciB9IGZyb20gJy4uL3NyYy9iYWNrZ3JvdW5kL1NlY3VyaXR5TWFuYWdlcidcclxuXHJcbmRlc2NyaWJlKCdTZWN1cml0eU1hbmFnZXInLCAoKSA9PiB7XHJcbiAgbGV0IHNlY3VyaXR5OiBTZWN1cml0eU1hbmFnZXI7XHJcbiAgXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIFxyXG4gICAgLy8gQ2xlYXIgQ2hyb21lIHN0b3JhZ2UgbW9jayBkYXRhXHJcbiAgICBjb25zdCBtb2NrU3RvcmFnZURhdGE6IGFueSA9IChnbG9iYWwgYXMgYW55KS5jaHJvbWUuc3RvcmFnZS5sb2NhbDtcclxuICAgIGlmIChtb2NrU3RvcmFnZURhdGEgJiYgbW9ja1N0b3JhZ2VEYXRhLl9tb2NrRGF0YSkge1xyXG4gICAgICBtb2NrU3RvcmFnZURhdGEuX21vY2tEYXRhID0ge307XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEVuc3VyZSBmcmVzaCBtb2NrcyBmb3IgZWFjaCB0ZXN0XHJcbiAgICAoZ2xvYmFsLmNyeXB0by5zdWJ0bGUuZ2VuZXJhdGVLZXkgYXMgamVzdC5Nb2NrKS5tb2NrQ2xlYXIoKTtcclxuICAgIChnbG9iYWwuY3J5cHRvLnN1YnRsZS5lbmNyeXB0IGFzIGplc3QuTW9jaykubW9ja0NsZWFyKCk7XHJcbiAgICAoZ2xvYmFsLmNyeXB0by5zdWJ0bGUuZGVjcnlwdCBhcyBqZXN0Lk1vY2spLm1vY2tDbGVhcigpO1xyXG4gICAgKGdsb2JhbC5jcnlwdG8uc3VidGxlLmRpZ2VzdCBhcyBqZXN0Lk1vY2spLm1vY2tDbGVhcigpO1xyXG4gICAgXHJcbiAgICBzZWN1cml0eSA9IG5ldyBTZWN1cml0eU1hbmFnZXIoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0NoaWZmcmVtZW50L0TDqWNoaWZmcmVtZW50JywgKCkgPT4ge1xyXG4gICAgaXQoJ2NoaWZmcmUgZXQgZMOpY2hpZmZyZSBjb3JyZWN0ZW1lbnQgbGVzIGRvbm7DqWVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0ZXN0RGF0YSA9IHsgZm9vOiAnYmFyJywgbjogNDIgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIE1vY2sgc3VjY2Vzc2Z1bCBlbmNyeXB0aW9uXHJcbiAgICAgIGNvbnN0IG1vY2tFbmNyeXB0ZWRCdWZmZXIgPSBuZXcgVWludDhBcnJheSgzMik7XHJcbiAgICAgIG1vY2tFbmNyeXB0ZWRCdWZmZXIuZmlsbCgweEFCKTtcclxuICAgICAgKGdsb2JhbC5jcnlwdG8uc3VidGxlLmVuY3J5cHQgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRW5jcnlwdGVkQnVmZmVyLmJ1ZmZlcik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBNb2NrIHN1Y2Nlc3NmdWwgZGVjcnlwdGlvblxyXG4gICAgICBjb25zdCB0ZXN0RGF0YVN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHRlc3REYXRhKTtcclxuICAgICAgY29uc3QgbW9ja0RlY3J5cHRlZEJ1ZmZlciA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSh0ZXN0RGF0YVN0cmluZyk7XHJcbiAgICAgIChnbG9iYWwuY3J5cHRvLnN1YnRsZS5kZWNyeXB0IGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0RlY3J5cHRlZEJ1ZmZlci5idWZmZXIpO1xyXG4gICAgICBcclxuICAgICAgLy8gVGVzdCBlbmNyeXB0aW9uXHJcbiAgICAgIGNvbnN0IGVuY3J5cHRlZCA9IGF3YWl0IHNlY3VyaXR5LmVuY3J5cHRTZW5zaXRpdmVEYXRhKHRlc3REYXRhKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiBlbmNyeXB0ZWQpLnRvQmUoJ3N0cmluZycpO1xyXG4gICAgICBleHBlY3QoZW5jcnlwdGVkLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gICAgICBleHBlY3QoZ2xvYmFsLmNyeXB0by5zdWJ0bGUuZW5jcnlwdCkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBcclxuICAgICAgLy8gVGVzdCBkZWNyeXB0aW9uICBcclxuICAgICAgY29uc3QgZGVjcnlwdGVkID0gYXdhaXQgc2VjdXJpdHkuZGVjcnlwdFNlbnNpdGl2ZURhdGEoZW5jcnlwdGVkKTtcclxuICAgICAgZXhwZWN0KGRlY3J5cHRlZCkudG9FcXVhbCh0ZXN0RGF0YSk7XHJcbiAgICAgIGV4cGVjdChnbG9iYWwuY3J5cHRvLnN1YnRsZS5kZWNyeXB0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZ8OocmUgbGVzIGVycmV1cnMgZGUgY2hpZmZyZW1lbnQgZ3JhY2lldXNlbWVudCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgKGdsb2JhbC5jcnlwdG8uc3VidGxlLmVuY3J5cHQgYXMgamVzdC5Nb2NrKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0NyeXB0byBmYWlsdXJlJykpO1xyXG4gICAgICBcclxuICAgICAgYXdhaXQgZXhwZWN0KHNlY3VyaXR5LmVuY3J5cHRTZW5zaXRpdmVEYXRhKHt9KSkucmVqZWN0cy50b1Rocm93KCfDiWNoZWMgZHUgY2hpZmZyZW1lbnQgZGVzIGRvbm7DqWVzIHNlbnNpYmxlcycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2fDqHJlIGxlcyBlcnJldXJzIGRlIGTDqWNoaWZmcmVtZW50IGdyYWNpZXVzZW1lbnQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIChnbG9iYWwuY3J5cHRvLnN1YnRsZS5kZWNyeXB0IGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdEZWNyeXB0IGZhaWx1cmUnKSk7XHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCBleHBlY3Qoc2VjdXJpdHkuZGVjcnlwdFNlbnNpdGl2ZURhdGEoJ2ludmFsaWQnKSkucmVqZWN0cy50b1Rocm93KCfDiWNoZWMgZHUgZMOpY2hpZmZyZW1lbnQgZGVzIGRvbm7DqWVzJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0Fub255bWlzYXRpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnYW5vbnltaXNlIGxlcyBkb25uw6llcyBjb21wb3J0ZW1lbnRhbGVzIChhc3luYyknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSB7IFxyXG4gICAgICAgIHVybDogJ2h0dHBzOi8vc2VjcmV0LmNvbScsIFxyXG4gICAgICAgIGludGVyYWN0aW9uczogNSwgXHJcbiAgICAgICAgdGltZVNwZW50OiAxMCwgXHJcbiAgICAgICAgc2Nyb2xsRGVwdGg6IDAuOCwgXHJcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpIFxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgY29uc3QgYW5vbnltaXplZCA9IGF3YWl0IHNlY3VyaXR5LmFub255bWl6ZUZvclNoYXJpbmcocGF0dGVybik7XHJcbiAgICAgIGV4cGVjdChhbm9ueW1pemVkLnVybCkudG9CZSgnYW5vbnltaXplZCcpO1xyXG4gICAgICBleHBlY3QoYW5vbnltaXplZC5pbnRlcmFjdGlvbnMpLnRvQmUocGF0dGVybi5pbnRlcmFjdGlvbnMpO1xyXG4gICAgICBleHBlY3QoYW5vbnltaXplZC50aW1lU3BlbnQpLnRvQmUocGF0dGVybi50aW1lU3BlbnQpO1xyXG4gICAgICBleHBlY3QoYW5vbnltaXplZC5zY3JvbGxEZXB0aCkudG9CZShwYXR0ZXJuLnNjcm9sbERlcHRoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdhbm9ueW1pc2UgbGVzIGRvbm7DqWVzIGNvbXBvcnRlbWVudGFsZXMgKHN5bmMpJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXR0ZXJuID0geyBcclxuICAgICAgICB1cmw6ICdodHRwczovL3NlY3JldC5jb20nLCBcclxuICAgICAgICB1c2VySWQ6ICd1c2VyMTIzJyxcclxuICAgICAgICBpbnRlcmFjdGlvbnM6IDUsIFxyXG4gICAgICAgIHRpbWVTcGVudDogMTAsIFxyXG4gICAgICAgIHNjcm9sbERlcHRoOiAwLjgsIFxyXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSBcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGFub255bWl6ZWQgPSBzZWN1cml0eS5hbm9ueW1pemVGb3JTaGFyaW5nU3luYyhwYXR0ZXJuKTtcclxuICAgICAgZXhwZWN0KGFub255bWl6ZWQudXJsKS50b0JlKCdhbm9ueW1pemVkJyk7XHJcbiAgICAgIGV4cGVjdChhbm9ueW1pemVkLnVzZXJJZCkubm90LnRvQmUoJ3VzZXIxMjMnKTsgLy8gSGFzaMOpXHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgYW5vbnltaXplZC51c2VySWQpLnRvQmUoJ3N0cmluZycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3N1cHByaW1lIGxlcyBjaGFtcHMgc2Vuc2libGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXR0ZXJuID0geyBcclxuICAgICAgICB1cmw6ICdodHRwczovL3NlY3JldC5jb20nLFxyXG4gICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICAgICAgbmFtZTogJ0pvaG4gRG9lJyxcclxuICAgICAgICBwaG9uZTogJzEyMzQ1Njc4OScsXHJcbiAgICAgICAgaW50ZXJhY3Rpb25zOiA1XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBhbm9ueW1pemVkID0gYXdhaXQgc2VjdXJpdHkuYW5vbnltaXplRm9yU2hhcmluZyhwYXR0ZXJuKTtcclxuICAgICAgZXhwZWN0KGFub255bWl6ZWQuZW1haWwpLnRvQmVVbmRlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KGFub255bWl6ZWQubmFtZSkudG9CZVVuZGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QoYW5vbnltaXplZC5waG9uZSkudG9CZVVuZGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QoYW5vbnltaXplZC5pbnRlcmFjdGlvbnMpLnRvQmUoNSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0NvbnRyw7RsZSBkXFwnYWNjw6hzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3ZhbGlkZSBsXFwnYWNjw6hzIHV0aWxpc2F0ZXVyIGJhc2lxdWUnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IHVzZXJJZDogJ3VzZXIxMjMnLCByZXNvdXJjZTogJ29yZ2FuaXNtcycgfTtcclxuICAgICAgZXhwZWN0KHNlY3VyaXR5LnZhbGlkYXRlRGF0YUFjY2VzcyhyZXF1ZXN0KSkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZWpldHRlIGxcXCdhY2PDqHMgYWRtaW4gc2FucyByw7RsZSBhZG1pbicsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVxdWVzdCA9IHsgdXNlcklkOiAndXNlcjEyMycsIHJlc291cmNlOiAnYWRtaW4nLCByb2xlOiAndXNlcicgYXMgY29uc3QgfTtcclxuICAgICAgZXhwZWN0KHNlY3VyaXR5LnZhbGlkYXRlRGF0YUFjY2VzcyhyZXF1ZXN0LCAnYWRtaW4nKSkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnYWNjZXB0ZSBsXFwnYWNjw6hzIGFkbWluIGF2ZWMgcsO0bGUgYWRtaW4nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7IHVzZXJJZDogJ2FkbWluMTIzJywgcmVzb3VyY2U6ICdhZG1pbicsIHJvbGU6ICdhZG1pbicgYXMgY29uc3QgfTtcclxuICAgICAgZXhwZWN0KHNlY3VyaXR5LnZhbGlkYXRlRGF0YUFjY2VzcyhyZXF1ZXN0LCAnYWRtaW4nKSkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZWpldHRlIGxlcyByZXF1w6p0ZXMgaW52YWxpZGVzJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3Qoc2VjdXJpdHkudmFsaWRhdGVEYXRhQWNjZXNzKHsgdXNlcklkOiAnJywgcmVzb3VyY2U6ICd0ZXN0JyB9KSkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChzZWN1cml0eS52YWxpZGF0ZURhdGFBY2Nlc3MoeyB1c2VySWQ6ICd1c2VyJywgcmVzb3VyY2U6ICcnIH0pKS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnSGFzaGFnZScsICgpID0+IHtcclxuICAgIGl0KCdoYXNoIGRlcyBjaGHDrm5lcyBhdmVjIFNIQS0yNTYnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRlc3RTdHJpbmcgPSAndGVzdC1zdHJpbmcnO1xyXG4gICAgICBcclxuICAgICAgLy8gTW9jayBkaWdlc3QgdG8gcmV0dXJuIGEgcHJvcGVyIGhhc2hcclxuICAgICAgY29uc3QgbW9ja0hhc2hCdWZmZXIgPSBuZXcgVWludDhBcnJheSgzMik7XHJcbiAgICAgIG1vY2tIYXNoQnVmZmVyLmZpbGwoMHhDRCwgMCwgMTYpO1xyXG4gICAgICBtb2NrSGFzaEJ1ZmZlci5maWxsKDB4RUYsIDE2LCAzMik7XHJcbiAgICAgIChnbG9iYWwuY3J5cHRvLnN1YnRsZS5kaWdlc3QgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrSGFzaEJ1ZmZlci5idWZmZXIpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgaGFzaCA9IGF3YWl0IHNlY3VyaXR5Lmhhc2godGVzdFN0cmluZyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QodHlwZW9mIGhhc2gpLnRvQmUoJ3N0cmluZycpO1xyXG4gICAgICBleHBlY3QoaGFzaC5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgICAgZXhwZWN0KGdsb2JhbC5jcnlwdG8uc3VidGxlLmRpZ2VzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1NIQS0yNTYnLCBleHBlY3QuYW55KFVpbnQ4QXJyYXkpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdwcm9kdWl0IGRlcyBoYXNocyBjb2jDqXJlbnRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0ZXN0U3RyaW5nID0gJ2NvbnNpc3RlbnQtdGVzdCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBNb2NrIGNvbnNpc3RlbnQgaGFzaCBvdXRwdXRcclxuICAgICAgY29uc3QgbW9ja0hhc2hCdWZmZXIgPSBuZXcgVWludDhBcnJheSgzMik7XHJcbiAgICAgIG1vY2tIYXNoQnVmZmVyLmZpbGwoMHg0Mik7XHJcbiAgICAgIChnbG9iYWwuY3J5cHRvLnN1YnRsZS5kaWdlc3QgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrSGFzaEJ1ZmZlci5idWZmZXIpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgaGFzaDEgPSBhd2FpdCBzZWN1cml0eS5oYXNoKHRlc3RTdHJpbmcpO1xyXG4gICAgICBjb25zdCBoYXNoMiA9IGF3YWl0IHNlY3VyaXR5Lmhhc2godGVzdFN0cmluZyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaGFzaDEpLnRvQmUoaGFzaDIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2hhc2ggc3luYyBmb25jdGlvbm5lIGNvbW1lIGZhbGxiYWNrJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0ZXN0U3RyaW5nID0gJ3N5bmMtdGVzdCc7XHJcbiAgICAgIGNvbnN0IGhhc2ggPSBzZWN1cml0eS5oYXNoU3luYyh0ZXN0U3RyaW5nKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgaGFzaCkudG9CZSgnc3RyaW5nJyk7XHJcbiAgICAgIGV4cGVjdChoYXNoLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyAiXSwidmVyc2lvbiI6M30=