19c3ec80b866144b8fd2ce9d43bd87d6
"use strict";
/**
 * Tests de performance WebGL
 */
// Mock WebGL context
const createMockWebGLContext = () => ({
    createShader: jest.fn().mockReturnValue({}),
    shaderSource: jest.fn(),
    compileShader: jest.fn(),
    getShaderParameter: jest.fn().mockReturnValue(true),
    createProgram: jest.fn().mockReturnValue({}),
    attachShader: jest.fn(),
    linkProgram: jest.fn(),
    getProgramParameter: jest.fn().mockReturnValue(true),
    useProgram: jest.fn(),
    createBuffer: jest.fn().mockReturnValue({}),
    bindBuffer: jest.fn(),
    bufferData: jest.fn(),
    getAttribLocation: jest.fn().mockReturnValue(0),
    enableVertexAttribArray: jest.fn(),
    vertexAttribPointer: jest.fn(),
    getUniformLocation: jest.fn().mockReturnValue({}),
    uniform1f: jest.fn(),
    uniform2f: jest.fn(),
    uniform3f: jest.fn(),
    uniform4f: jest.fn(),
    uniformMatrix4fv: jest.fn(),
    viewport: jest.fn(),
    clearColor: jest.fn(),
    clear: jest.fn(),
    drawArrays: jest.fn(),
    drawElements: jest.fn(),
    canvas: {
        width: 800,
        height: 600,
        getContext: jest.fn()
    },
    // WebGL constants
    VERTEX_SHADER: 35633,
    FRAGMENT_SHADER: 35632,
    ARRAY_BUFFER: 34962,
    ELEMENT_ARRAY_BUFFER: 34963,
    STATIC_DRAW: 35044,
    FLOAT: 5126,
    TRIANGLES: 4,
    COLOR_BUFFER_BIT: 16384,
    DEPTH_BUFFER_BIT: 256,
    DEPTH_TEST: 2929
});
// Mock HTMLCanvasElement
global.HTMLCanvasElement.prototype.getContext = jest.fn().mockImplementation((contextType) => {
    if (contextType === 'webgl' || contextType === 'webgl2') {
        return createMockWebGLContext();
    }
    return null;
});
describe('Tests de Performance WebGL', () => {
    let canvas;
    let gl;
    beforeEach(() => {
        canvas = document.createElement('canvas');
        canvas.width = 800;
        canvas.height = 600;
        gl = canvas.getContext('webgl');
    });
    describe('Initialisation WebGL', () => {
        it('initialise le contexte WebGL rapidement', () => {
            const start = performance.now();
            const testCanvas = document.createElement('canvas');
            testCanvas.width = 1920;
            testCanvas.height = 1080;
            const testGl = testCanvas.getContext('webgl2') || testCanvas.getContext('webgl');
            const duration = performance.now() - start;
            expect(testGl).toBeTruthy();
            expect(duration).toBeLessThan(50); // Moins de 50ms
        });
        it('gère gracieusement l\'échec d\'initialisation WebGL', () => {
            // Mock failed context creation
            const failCanvas = document.createElement('canvas');
            jest.spyOn(failCanvas, 'getContext').mockReturnValue(null);
            const context = failCanvas.getContext('webgl');
            expect(context).toBeNull();
        });
    });
    describe('Compilation de Shaders', () => {
        it('compile les shaders en moins de 100ms', () => {
            const vertexShaderSource = `
        attribute vec4 a_position;
        uniform mat4 u_matrix;
        void main() {
          gl_Position = u_matrix * a_position;
        }
      `;
            const fragmentShaderSource = `
        precision mediump float;
        uniform vec4 u_color;
        void main() {
          gl_Color = u_color;
        }
      `;
            const start = performance.now();
            // Mock shader compilation
            const vertexShader = gl.createShader(gl.VERTEX_SHADER);
            gl.shaderSource(vertexShader, vertexShaderSource);
            gl.compileShader(vertexShader);
            const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
            gl.shaderSource(fragmentShader, fragmentShaderSource);
            gl.compileShader(fragmentShader);
            const program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);
            const duration = performance.now() - start;
            expect(gl.getProgramParameter(program, gl.LINK_STATUS)).toBe(true);
            expect(duration).toBeLessThan(100);
        });
        it('détecte les erreurs de compilation rapidement', () => {
            const invalidShader = `
        invalid shader code
        this should fail
      `;
            const start = performance.now();
            const shader = gl.createShader(gl.VERTEX_SHADER);
            gl.shaderSource(shader, invalidShader);
            gl.compileShader(shader);
            // Simulate compilation check
            const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
            const duration = performance.now() - start;
            expect(duration).toBeLessThan(50);
            expect(typeof success).toBe('boolean');
        });
    });
    describe('Opérations de rendu', () => {
        it('maintient 60 FPS pour des scènes simples', () => {
            const frameCount = 60;
            const targetFPS = 60;
            const maxFrameTime = 1000 / targetFPS; // 16.67ms
            const frameTimes = [];
            for (let i = 0; i < frameCount; i++) {
                const frameStart = performance.now();
                // Simuler un frame de rendu
                gl.viewport(0, 0, canvas.width, canvas.height);
                gl.clearColor(0, 0, 0, 1);
                gl.clear(gl.COLOR_BUFFER_BIT);
                // Simuler le dessin de quelques triangles
                for (let j = 0; j < 10; j++) {
                    gl.drawArrays(gl.TRIANGLES, 0, 3);
                }
                const frameTime = performance.now() - frameStart;
                frameTimes.push(frameTime);
            }
            const averageFrameTime = frameTimes.reduce((a, b) => a + b, 0) / frameCount;
            const maxFrameTimeActual = Math.max(...frameTimes);
            expect(averageFrameTime).toBeLessThan(maxFrameTime);
            expect(maxFrameTimeActual).toBeLessThan(maxFrameTime * 2); // Tolérance pour les pics
        });
        it('gère efficacement les textures multiples', () => {
            const textureCount = 16;
            const textures = [];
            const start = performance.now();
            // Simuler la création de textures
            for (let i = 0; i < textureCount; i++) {
                const texture = gl.createTexture();
                gl.bindTexture(gl.TEXTURE_2D, texture);
                // Simuler l'upload de données de texture
                const pixels = new Uint8Array(256 * 256 * 4); // RGBA 256x256
                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 256, 256, 0, gl.RGBA, gl.UNSIGNED_BYTE, pixels);
                textures.push(texture);
            }
            const duration = performance.now() - start;
            expect(textures).toHaveLength(textureCount);
            expect(duration).toBeLessThan(500); // Moins de 500ms pour 16 textures
        });
    });
    describe('Gestion mémoire', () => {
        it('libère correctement les ressources WebGL', () => {
            const resources = {
                buffers: [],
                textures: [],
                programs: [],
                shaders: []
            };
            // Créer des ressources
            for (let i = 0; i < 10; i++) {
                const buffer = gl.createBuffer();
                const texture = gl.createTexture();
                const program = gl.createProgram();
                const shader = gl.createShader(gl.VERTEX_SHADER);
                resources.buffers.push(buffer);
                resources.textures.push(texture);
                resources.programs.push(program);
                resources.shaders.push(shader);
            }
            // Libérer les ressources
            const start = performance.now();
            resources.buffers.forEach(buffer => gl.deleteBuffer(buffer));
            resources.textures.forEach(texture => gl.deleteTexture(texture));
            resources.programs.forEach(program => gl.deleteProgram(program));
            resources.shaders.forEach(shader => gl.deleteShader(shader));
            const duration = performance.now() - start;
            expect(duration).toBeLessThan(100);
        });
        it('détecte les fuites mémoire potentielles', () => {
            const initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
            // Créer beaucoup de ressources sans les libérer
            const leakyResources = [];
            for (let i = 0; i < 1000; i++) {
                leakyResources.push({
                    buffer: gl.createBuffer(),
                    texture: gl.createTexture(),
                    data: new Float32Array(1000) // 4KB each
                });
            }
            const afterCreation = performance.memory ? performance.memory.usedJSHeapSize : 0;
            // Libérer les ressources
            leakyResources.forEach(resource => {
                gl.deleteBuffer(resource.buffer);
                gl.deleteTexture(resource.texture);
            });
            leakyResources.length = 0;
            const afterCleanup = performance.memory ? performance.memory.usedJSHeapSize : 0;
            if (performance.memory) {
                const memoryIncrease = afterCreation - initialMemory;
                const memoryAfterCleanup = afterCleanup - initialMemory;
                expect(memoryIncrease).toBeGreaterThan(0); // Memory should increase
                expect(memoryAfterCleanup).toBeLessThan(memoryIncrease * 0.5); // Should clean up most memory
            }
            expect(leakyResources).toHaveLength(0);
        });
    });
    describe('Performance en conditions stressantes', () => {
        it('maintient les performances avec beaucoup de draw calls', () => {
            const drawCallCount = 1000;
            const start = performance.now();
            gl.viewport(0, 0, canvas.width, canvas.height);
            gl.clear(gl.COLOR_BUFFER_BIT);
            for (let i = 0; i < drawCallCount; i++) {
                // Simuler des changements d'état coûteux
                gl.useProgram(gl.createProgram());
                gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());
                gl.drawArrays(gl.TRIANGLES, 0, 3);
            }
            const duration = performance.now() - start;
            expect(duration).toBeLessThan(1000); // Moins d'1 seconde pour 1000 draw calls
        });
        it('gère les changements de viewport fréquents', () => {
            const viewportChanges = 100;
            const start = performance.now();
            for (let i = 0; i < viewportChanges; i++) {
                const width = 100 + (i * 10);
                const height = 100 + (i * 10);
                gl.viewport(0, 0, width, height);
                gl.clear(gl.COLOR_BUFFER_BIT);
                gl.drawArrays(gl.TRIANGLES, 0, 3);
            }
            const duration = performance.now() - start;
            expect(duration).toBeLessThan(500);
        });
    });
    describe('Validation des performances par fonctionnalité', () => {
        it('WebGL Batch operations performance', () => {
            // Simuler un système de batch comme WebGLBatcher
            const batchSize = 100;
            const batches = 10;
            const start = performance.now();
            for (let batch = 0; batch < batches; batch++) {
                // Préparer un batch
                const vertices = new Float32Array(batchSize * 3 * 3); // 100 triangles
                for (let i = 0; i < vertices.length; i++) {
                    vertices[i] = Math.random();
                }
                // Upload et rendu du batch
                const buffer = gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
                gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
                gl.drawArrays(gl.TRIANGLES, 0, batchSize * 3);
                gl.deleteBuffer(buffer);
            }
            const duration = performance.now() - start;
            expect(duration).toBeLessThan(200); // Batching doit être efficace
        });
        it('Organism rendering performance', () => {
            // Simuler le rendu d'un organisme complexe
            const organismComplexity = 50; // Nombre de composants
            const start = performance.now();
            gl.viewport(0, 0, canvas.width, canvas.height);
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
            for (let component = 0; component < organismComplexity; component++) {
                // Simuler le rendu d'un composant d'organisme
                gl.useProgram(gl.createProgram());
                // Matrices de transformation
                gl.uniformMatrix4fv(gl.getUniformLocation(null, 'u_matrix'), false, new Float32Array(16));
                // Couleur du composant
                gl.uniform4f(gl.getUniformLocation(null, 'u_color'), Math.random(), Math.random(), Math.random(), 1.0);
                // Géométrie du composant
                gl.drawArrays(gl.TRIANGLES, 0, 6); // Quad = 2 triangles
            }
            const duration = performance.now() - start;
            expect(duration).toBeLessThan(16); // 60 FPS = 16.67ms par frame
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZXMvU1lNQklPTlQvX190ZXN0c19fL3BlcmZvcm1hbmNlL3dlYmdsLnBlcmZvcm1hbmNlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHO0FBRUgscUJBQXFCO0FBQ3JCLE1BQU0sc0JBQXNCLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNwQyxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7SUFDM0MsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDdkIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDeEIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUM7SUFDbkQsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDO0lBQzVDLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3ZCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3RCLG1CQUFtQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDO0lBQ3BELFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3JCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQztJQUMzQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNyQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNyQixpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztJQUMvQyx1QkFBdUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2xDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDOUIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7SUFDakQsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDcEIsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDcEIsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDcEIsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDcEIsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUMzQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNuQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNyQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNoQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNyQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUN2QixNQUFNLEVBQUU7UUFDTixLQUFLLEVBQUUsR0FBRztRQUNWLE1BQU0sRUFBRSxHQUFHO1FBQ1gsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDdEI7SUFDRCxrQkFBa0I7SUFDbEIsYUFBYSxFQUFFLEtBQUs7SUFDcEIsZUFBZSxFQUFFLEtBQUs7SUFDdEIsWUFBWSxFQUFFLEtBQUs7SUFDbkIsb0JBQW9CLEVBQUUsS0FBSztJQUMzQixXQUFXLEVBQUUsS0FBSztJQUNsQixLQUFLLEVBQUUsSUFBSTtJQUNYLFNBQVMsRUFBRSxDQUFDO0lBQ1osZ0JBQWdCLEVBQUUsS0FBSztJQUN2QixnQkFBZ0IsRUFBRSxHQUFHO0lBQ3JCLFVBQVUsRUFBRSxJQUFJO0NBQ2pCLENBQUMsQ0FBQztBQUVILHlCQUF5QjtBQUN6QixNQUFNLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxXQUFXLEVBQUUsRUFBRTtJQUMzRixJQUFJLFdBQVcsS0FBSyxPQUFPLElBQUksV0FBVyxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQ3hELE9BQU8sc0JBQXNCLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUU7SUFDMUMsSUFBSSxNQUF5QixDQUFDO0lBQzlCLElBQUksRUFBTyxDQUFDO0lBRVosVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO1FBQ25CLE1BQU0sQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDO1FBQ3BCLEVBQUUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtRQUNwQyxFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUVoQyxNQUFNLFVBQVUsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3BELFVBQVUsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ3hCLFVBQVUsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1lBQ3pCLE1BQU0sTUFBTSxHQUFHLFVBQVUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksVUFBVSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUVqRixNQUFNLFFBQVEsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDO1lBRTNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUM1QixNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCO1FBQ3JELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFEQUFxRCxFQUFFLEdBQUcsRUFBRTtZQUM3RCwrQkFBK0I7WUFDL0IsTUFBTSxVQUFVLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNwRCxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxZQUFZLENBQUMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFM0QsTUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUMvQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7UUFDdEMsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUMvQyxNQUFNLGtCQUFrQixHQUFHOzs7Ozs7T0FNMUIsQ0FBQztZQUVGLE1BQU0sb0JBQW9CLEdBQUc7Ozs7OztPQU01QixDQUFDO1lBRUYsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBRWhDLDBCQUEwQjtZQUMxQixNQUFNLFlBQVksR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUN2RCxFQUFFLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1lBQ2xELEVBQUUsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFL0IsTUFBTSxjQUFjLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDM0QsRUFBRSxDQUFDLFlBQVksQ0FBQyxjQUFjLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztZQUN0RCxFQUFFLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBRWpDLE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNuQyxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQztZQUN2QyxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxjQUFjLENBQUMsQ0FBQztZQUN6QyxFQUFFLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRXhCLE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUM7WUFFM0MsTUFBTSxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25FLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsK0NBQStDLEVBQUUsR0FBRyxFQUFFO1lBQ3ZELE1BQU0sYUFBYSxHQUFHOzs7T0FHckIsQ0FBQztZQUVGLE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUVoQyxNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUNqRCxFQUFFLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxhQUFhLENBQUMsQ0FBQztZQUN2QyxFQUFFLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRXpCLDZCQUE2QjtZQUM3QixNQUFNLE9BQU8sR0FBRyxFQUFFLENBQUMsa0JBQWtCLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUVqRSxNQUFNLFFBQVEsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDO1lBRTNDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE9BQU8sT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1FBQ25DLEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7WUFDbEQsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDO1lBQ3RCLE1BQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQztZQUNyQixNQUFNLFlBQVksR0FBRyxJQUFJLEdBQUcsU0FBUyxDQUFDLENBQUMsVUFBVTtZQUVqRCxNQUFNLFVBQVUsR0FBYSxFQUFFLENBQUM7WUFFaEMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUNwQyxNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBRXJDLDRCQUE0QjtnQkFDNUIsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUMvQyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO2dCQUMxQixFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUU5QiwwQ0FBMEM7Z0JBQzFDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztvQkFDNUIsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDcEMsQ0FBQztnQkFFRCxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsVUFBVSxDQUFDO2dCQUNqRCxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzdCLENBQUM7WUFFRCxNQUFNLGdCQUFnQixHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLFVBQVUsQ0FBQztZQUM1RSxNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxVQUFVLENBQUMsQ0FBQztZQUVuRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDcEQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsWUFBWSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLDBCQUEwQjtRQUN2RixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7WUFDbEQsTUFBTSxZQUFZLEdBQUcsRUFBRSxDQUFDO1lBQ3hCLE1BQU0sUUFBUSxHQUFVLEVBQUUsQ0FBQztZQUUzQixNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7WUFFaEMsa0NBQWtDO1lBQ2xDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxZQUFZLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDdEMsTUFBTSxPQUFPLEdBQUcsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO2dCQUNuQyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBRXZDLHlDQUF5QztnQkFDekMsTUFBTSxNQUFNLEdBQUcsSUFBSSxVQUFVLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLGVBQWU7Z0JBQzdELEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxhQUFhLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBRXpGLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDekIsQ0FBQztZQUVELE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUM7WUFFM0MsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUM1QyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsa0NBQWtDO1FBQ3hFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO1FBQy9CLEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7WUFDbEQsTUFBTSxTQUFTLEdBQUc7Z0JBQ2hCLE9BQU8sRUFBRSxFQUFFO2dCQUNYLFFBQVEsRUFBRSxFQUFFO2dCQUNaLFFBQVEsRUFBRSxFQUFFO2dCQUNaLE9BQU8sRUFBRSxFQUFFO2FBQ1osQ0FBQztZQUVGLHVCQUF1QjtZQUN2QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzVCLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztnQkFDakMsTUFBTSxPQUFPLEdBQUcsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO2dCQUNuQyxNQUFNLE9BQU8sR0FBRyxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQ25DLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDO2dCQUVqRCxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDL0IsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ2pDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNqQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNqQyxDQUFDO1lBRUQseUJBQXlCO1lBQ3pCLE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUVoQyxTQUFTLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUM3RCxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNqRSxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNqRSxTQUFTLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUU3RCxNQUFNLFFBQVEsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDO1lBRTNDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELE1BQU0sYUFBYSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFakYsZ0RBQWdEO1lBQ2hELE1BQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQztZQUMxQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzlCLGNBQWMsQ0FBQyxJQUFJLENBQUM7b0JBQ2xCLE1BQU0sRUFBRSxFQUFFLENBQUMsWUFBWSxFQUFFO29CQUN6QixPQUFPLEVBQUUsRUFBRSxDQUFDLGFBQWEsRUFBRTtvQkFDM0IsSUFBSSxFQUFFLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLFdBQVc7aUJBQ3pDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLGFBQWEsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRWpGLHlCQUF5QjtZQUN6QixjQUFjLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUNoQyxFQUFFLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDakMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDckMsQ0FBQyxDQUFDLENBQUM7WUFDSCxjQUFjLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUUxQixNQUFNLFlBQVksR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRWhGLElBQUksV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUN2QixNQUFNLGNBQWMsR0FBRyxhQUFhLEdBQUcsYUFBYSxDQUFDO2dCQUNyRCxNQUFNLGtCQUFrQixHQUFHLFlBQVksR0FBRyxhQUFhLENBQUM7Z0JBRXhELE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyx5QkFBeUI7Z0JBQ3BFLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLFlBQVksQ0FBQyxjQUFjLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyw4QkFBOEI7WUFDL0YsQ0FBQztZQUVELE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7UUFDckQsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEdBQUcsRUFBRTtZQUNoRSxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUM7WUFFM0IsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBRWhDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMvQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBRTlCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxhQUFhLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDdkMseUNBQXlDO2dCQUN6QyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDO2dCQUNsQyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7Z0JBQ2xELEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDcEMsQ0FBQztZQUVELE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUM7WUFFM0MsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLHlDQUF5QztRQUNoRixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxHQUFHLEVBQUU7WUFDcEQsTUFBTSxlQUFlLEdBQUcsR0FBRyxDQUFDO1lBRTVCLE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUVoQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsZUFBZSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3pDLE1BQU0sS0FBSyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDN0IsTUFBTSxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO2dCQUM5QixFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUNqQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUM5QixFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLENBQUM7WUFFRCxNQUFNLFFBQVEsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDO1lBRTNDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7UUFDOUQsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtZQUM1QyxpREFBaUQ7WUFDakQsTUFBTSxTQUFTLEdBQUcsR0FBRyxDQUFDO1lBQ3RCLE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQztZQUVuQixNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7WUFFaEMsS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDO2dCQUM3QyxvQkFBb0I7Z0JBQ3BCLE1BQU0sUUFBUSxHQUFHLElBQUksWUFBWSxDQUFDLFNBQVMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxnQkFBZ0I7Z0JBQ3RFLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQ3pDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQzlCLENBQUM7Z0JBRUQsMkJBQTJCO2dCQUMzQixNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUMsWUFBWSxFQUFFLENBQUM7Z0JBQ2pDLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDdkMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLFFBQVEsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ3pELEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsU0FBUyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUU5QyxFQUFFLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFCLENBQUM7WUFFRCxNQUFNLFFBQVEsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDO1lBRTNDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyw4QkFBOEI7UUFDcEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO1lBQ3hDLDJDQUEyQztZQUMzQyxNQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQyxDQUFDLHVCQUF1QjtZQUV0RCxNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7WUFFaEMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQy9DLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBRXBELEtBQUssSUFBSSxTQUFTLEdBQUcsQ0FBQyxFQUFFLFNBQVMsR0FBRyxrQkFBa0IsRUFBRSxTQUFTLEVBQUUsRUFBRSxDQUFDO2dCQUNwRSw4Q0FBOEM7Z0JBQzlDLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUM7Z0JBRWxDLDZCQUE2QjtnQkFDN0IsRUFBRSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBRTFGLHVCQUF1QjtnQkFDdkIsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUV2Ryx5QkFBeUI7Z0JBQ3pCLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxQkFBcUI7WUFDMUQsQ0FBQztZQUVELE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUM7WUFFM0MsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLDZCQUE2QjtRQUNsRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL3dvcmtzcGFjZXMvU1lNQklPTlQvX190ZXN0c19fL3BlcmZvcm1hbmNlL3dlYmdsLnBlcmZvcm1hbmNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZXN0cyBkZSBwZXJmb3JtYW5jZSBXZWJHTFxuICovXG5cbi8vIE1vY2sgV2ViR0wgY29udGV4dFxuY29uc3QgY3JlYXRlTW9ja1dlYkdMQ29udGV4dCA9ICgpID0+ICh7XG4gIGNyZWF0ZVNoYWRlcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7fSksXG4gIHNoYWRlclNvdXJjZTogamVzdC5mbigpLFxuICBjb21waWxlU2hhZGVyOiBqZXN0LmZuKCksXG4gIGdldFNoYWRlclBhcmFtZXRlcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgY3JlYXRlUHJvZ3JhbTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7fSksXG4gIGF0dGFjaFNoYWRlcjogamVzdC5mbigpLFxuICBsaW5rUHJvZ3JhbTogamVzdC5mbigpLFxuICBnZXRQcm9ncmFtUGFyYW1ldGVyOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHRydWUpLFxuICB1c2VQcm9ncmFtOiBqZXN0LmZuKCksXG4gIGNyZWF0ZUJ1ZmZlcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7fSksXG4gIGJpbmRCdWZmZXI6IGplc3QuZm4oKSxcbiAgYnVmZmVyRGF0YTogamVzdC5mbigpLFxuICBnZXRBdHRyaWJMb2NhdGlvbjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgwKSxcbiAgZW5hYmxlVmVydGV4QXR0cmliQXJyYXk6IGplc3QuZm4oKSxcbiAgdmVydGV4QXR0cmliUG9pbnRlcjogamVzdC5mbigpLFxuICBnZXRVbmlmb3JtTG9jYXRpb246IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe30pLFxuICB1bmlmb3JtMWY6IGplc3QuZm4oKSxcbiAgdW5pZm9ybTJmOiBqZXN0LmZuKCksXG4gIHVuaWZvcm0zZjogamVzdC5mbigpLFxuICB1bmlmb3JtNGY6IGplc3QuZm4oKSxcbiAgdW5pZm9ybU1hdHJpeDRmdjogamVzdC5mbigpLFxuICB2aWV3cG9ydDogamVzdC5mbigpLFxuICBjbGVhckNvbG9yOiBqZXN0LmZuKCksXG4gIGNsZWFyOiBqZXN0LmZuKCksXG4gIGRyYXdBcnJheXM6IGplc3QuZm4oKSxcbiAgZHJhd0VsZW1lbnRzOiBqZXN0LmZuKCksXG4gIGNhbnZhczoge1xuICAgIHdpZHRoOiA4MDAsXG4gICAgaGVpZ2h0OiA2MDAsXG4gICAgZ2V0Q29udGV4dDogamVzdC5mbigpXG4gIH0sXG4gIC8vIFdlYkdMIGNvbnN0YW50c1xuICBWRVJURVhfU0hBREVSOiAzNTYzMyxcbiAgRlJBR01FTlRfU0hBREVSOiAzNTYzMixcbiAgQVJSQVlfQlVGRkVSOiAzNDk2MixcbiAgRUxFTUVOVF9BUlJBWV9CVUZGRVI6IDM0OTYzLFxuICBTVEFUSUNfRFJBVzogMzUwNDQsXG4gIEZMT0FUOiA1MTI2LFxuICBUUklBTkdMRVM6IDQsXG4gIENPTE9SX0JVRkZFUl9CSVQ6IDE2Mzg0LFxuICBERVBUSF9CVUZGRVJfQklUOiAyNTYsXG4gIERFUFRIX1RFU1Q6IDI5Mjlcbn0pO1xuXG4vLyBNb2NrIEhUTUxDYW52YXNFbGVtZW50XG5nbG9iYWwuSFRNTENhbnZhc0VsZW1lbnQucHJvdG90eXBlLmdldENvbnRleHQgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChjb250ZXh0VHlwZSkgPT4ge1xuICBpZiAoY29udGV4dFR5cGUgPT09ICd3ZWJnbCcgfHwgY29udGV4dFR5cGUgPT09ICd3ZWJnbDInKSB7XG4gICAgcmV0dXJuIGNyZWF0ZU1vY2tXZWJHTENvbnRleHQoKTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn0pO1xuXG5kZXNjcmliZSgnVGVzdHMgZGUgUGVyZm9ybWFuY2UgV2ViR0wnLCAoKSA9PiB7XG4gIGxldCBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICBsZXQgZ2w6IGFueTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICBjYW52YXMud2lkdGggPSA4MDA7XG4gICAgY2FudmFzLmhlaWdodCA9IDYwMDtcbiAgICBnbCA9IGNhbnZhcy5nZXRDb250ZXh0KCd3ZWJnbCcpO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW5pdGlhbGlzYXRpb24gV2ViR0wnLCAoKSA9PiB7XG4gICAgaXQoJ2luaXRpYWxpc2UgbGUgY29udGV4dGUgV2ViR0wgcmFwaWRlbWVudCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHRlc3RDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgIHRlc3RDYW52YXMud2lkdGggPSAxOTIwO1xuICAgICAgdGVzdENhbnZhcy5oZWlnaHQgPSAxMDgwO1xuICAgICAgY29uc3QgdGVzdEdsID0gdGVzdENhbnZhcy5nZXRDb250ZXh0KCd3ZWJnbDInKSB8fCB0ZXN0Q2FudmFzLmdldENvbnRleHQoJ3dlYmdsJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydDtcbiAgICAgIFxuICAgICAgZXhwZWN0KHRlc3RHbCkudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oNTApOyAvLyBNb2lucyBkZSA1MG1zXG4gICAgfSk7XG5cbiAgICBpdCgnZ8OocmUgZ3JhY2lldXNlbWVudCBsXFwnw6ljaGVjIGRcXCdpbml0aWFsaXNhdGlvbiBXZWJHTCcsICgpID0+IHtcbiAgICAgIC8vIE1vY2sgZmFpbGVkIGNvbnRleHQgY3JlYXRpb25cbiAgICAgIGNvbnN0IGZhaWxDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgIGplc3Quc3B5T24oZmFpbENhbnZhcywgJ2dldENvbnRleHQnKS5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBmYWlsQ2FudmFzLmdldENvbnRleHQoJ3dlYmdsJyk7XG4gICAgICBleHBlY3QoY29udGV4dCkudG9CZU51bGwoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NvbXBpbGF0aW9uIGRlIFNoYWRlcnMnLCAoKSA9PiB7XG4gICAgaXQoJ2NvbXBpbGUgbGVzIHNoYWRlcnMgZW4gbW9pbnMgZGUgMTAwbXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2ZXJ0ZXhTaGFkZXJTb3VyY2UgPSBgXG4gICAgICAgIGF0dHJpYnV0ZSB2ZWM0IGFfcG9zaXRpb247XG4gICAgICAgIHVuaWZvcm0gbWF0NCB1X21hdHJpeDtcbiAgICAgICAgdm9pZCBtYWluKCkge1xuICAgICAgICAgIGdsX1Bvc2l0aW9uID0gdV9tYXRyaXggKiBhX3Bvc2l0aW9uO1xuICAgICAgICB9XG4gICAgICBgO1xuICAgICAgXG4gICAgICBjb25zdCBmcmFnbWVudFNoYWRlclNvdXJjZSA9IGBcbiAgICAgICAgcHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7XG4gICAgICAgIHVuaWZvcm0gdmVjNCB1X2NvbG9yO1xuICAgICAgICB2b2lkIG1haW4oKSB7XG4gICAgICAgICAgZ2xfQ29sb3IgPSB1X2NvbG9yO1xuICAgICAgICB9XG4gICAgICBgO1xuICAgICAgXG4gICAgICBjb25zdCBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgXG4gICAgICAvLyBNb2NrIHNoYWRlciBjb21waWxhdGlvblxuICAgICAgY29uc3QgdmVydGV4U2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKGdsLlZFUlRFWF9TSEFERVIpO1xuICAgICAgZ2wuc2hhZGVyU291cmNlKHZlcnRleFNoYWRlciwgdmVydGV4U2hhZGVyU291cmNlKTtcbiAgICAgIGdsLmNvbXBpbGVTaGFkZXIodmVydGV4U2hhZGVyKTtcbiAgICAgIFxuICAgICAgY29uc3QgZnJhZ21lbnRTaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIoZ2wuRlJBR01FTlRfU0hBREVSKTtcbiAgICAgIGdsLnNoYWRlclNvdXJjZShmcmFnbWVudFNoYWRlciwgZnJhZ21lbnRTaGFkZXJTb3VyY2UpO1xuICAgICAgZ2wuY29tcGlsZVNoYWRlcihmcmFnbWVudFNoYWRlcik7XG4gICAgICBcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7XG4gICAgICBnbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgdmVydGV4U2hhZGVyKTtcbiAgICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCBmcmFnbWVudFNoYWRlcik7XG4gICAgICBnbC5saW5rUHJvZ3JhbShwcm9ncmFtKTtcbiAgICAgIFxuICAgICAgY29uc3QgZHVyYXRpb24gPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0O1xuICAgICAgXG4gICAgICBleHBlY3QoZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCBnbC5MSU5LX1NUQVRVUykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbigxMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2TDqXRlY3RlIGxlcyBlcnJldXJzIGRlIGNvbXBpbGF0aW9uIHJhcGlkZW1lbnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkU2hhZGVyID0gYFxuICAgICAgICBpbnZhbGlkIHNoYWRlciBjb2RlXG4gICAgICAgIHRoaXMgc2hvdWxkIGZhaWxcbiAgICAgIGA7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHNoYWRlciA9IGdsLmNyZWF0ZVNoYWRlcihnbC5WRVJURVhfU0hBREVSKTtcbiAgICAgIGdsLnNoYWRlclNvdXJjZShzaGFkZXIsIGludmFsaWRTaGFkZXIpO1xuICAgICAgZ2wuY29tcGlsZVNoYWRlcihzaGFkZXIpO1xuICAgICAgXG4gICAgICAvLyBTaW11bGF0ZSBjb21waWxhdGlvbiBjaGVja1xuICAgICAgY29uc3Qgc3VjY2VzcyA9IGdsLmdldFNoYWRlclBhcmFtZXRlcihzaGFkZXIsIGdsLkNPTVBJTEVfU1RBVFVTKTtcbiAgICAgIFxuICAgICAgY29uc3QgZHVyYXRpb24gPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0O1xuICAgICAgXG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbig1MCk7XG4gICAgICBleHBlY3QodHlwZW9mIHN1Y2Nlc3MpLnRvQmUoJ2Jvb2xlYW4nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ09ww6lyYXRpb25zIGRlIHJlbmR1JywgKCkgPT4ge1xuICAgIGl0KCdtYWludGllbnQgNjAgRlBTIHBvdXIgZGVzIHNjw6huZXMgc2ltcGxlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGZyYW1lQ291bnQgPSA2MDtcbiAgICAgIGNvbnN0IHRhcmdldEZQUyA9IDYwO1xuICAgICAgY29uc3QgbWF4RnJhbWVUaW1lID0gMTAwMCAvIHRhcmdldEZQUzsgLy8gMTYuNjdtc1xuICAgICAgXG4gICAgICBjb25zdCBmcmFtZVRpbWVzOiBudW1iZXJbXSA9IFtdO1xuICAgICAgXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZyYW1lQ291bnQ7IGkrKykge1xuICAgICAgICBjb25zdCBmcmFtZVN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIFxuICAgICAgICAvLyBTaW11bGVyIHVuIGZyYW1lIGRlIHJlbmR1XG4gICAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgICAgIGdsLmNsZWFyQ29sb3IoMCwgMCwgMCwgMSk7XG4gICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQpO1xuICAgICAgICBcbiAgICAgICAgLy8gU2ltdWxlciBsZSBkZXNzaW4gZGUgcXVlbHF1ZXMgdHJpYW5nbGVzXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICAgIGdsLmRyYXdBcnJheXMoZ2wuVFJJQU5HTEVTLCAwLCAzKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgZnJhbWVUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBmcmFtZVN0YXJ0O1xuICAgICAgICBmcmFtZVRpbWVzLnB1c2goZnJhbWVUaW1lKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgYXZlcmFnZUZyYW1lVGltZSA9IGZyYW1lVGltZXMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyBmcmFtZUNvdW50O1xuICAgICAgY29uc3QgbWF4RnJhbWVUaW1lQWN0dWFsID0gTWF0aC5tYXgoLi4uZnJhbWVUaW1lcyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChhdmVyYWdlRnJhbWVUaW1lKS50b0JlTGVzc1RoYW4obWF4RnJhbWVUaW1lKTtcbiAgICAgIGV4cGVjdChtYXhGcmFtZVRpbWVBY3R1YWwpLnRvQmVMZXNzVGhhbihtYXhGcmFtZVRpbWUgKiAyKTsgLy8gVG9sw6lyYW5jZSBwb3VyIGxlcyBwaWNzXG4gICAgfSk7XG5cbiAgICBpdCgnZ8OocmUgZWZmaWNhY2VtZW50IGxlcyB0ZXh0dXJlcyBtdWx0aXBsZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXh0dXJlQ291bnQgPSAxNjtcbiAgICAgIGNvbnN0IHRleHR1cmVzOiBhbnlbXSA9IFtdO1xuICAgICAgXG4gICAgICBjb25zdCBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgXG4gICAgICAvLyBTaW11bGVyIGxhIGNyw6lhdGlvbiBkZSB0ZXh0dXJlc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlQ291bnQ7IGkrKykge1xuICAgICAgICBjb25zdCB0ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xuICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXh0dXJlKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNpbXVsZXIgbCd1cGxvYWQgZGUgZG9ubsOpZXMgZGUgdGV4dHVyZVxuICAgICAgICBjb25zdCBwaXhlbHMgPSBuZXcgVWludDhBcnJheSgyNTYgKiAyNTYgKiA0KTsgLy8gUkdCQSAyNTZ4MjU2XG4gICAgICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuUkdCQSwgMjU2LCAyNTYsIDAsIGdsLlJHQkEsIGdsLlVOU0lHTkVEX0JZVEUsIHBpeGVscyk7XG4gICAgICAgIFxuICAgICAgICB0ZXh0dXJlcy5wdXNoKHRleHR1cmUpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnQ7XG4gICAgICBcbiAgICAgIGV4cGVjdCh0ZXh0dXJlcykudG9IYXZlTGVuZ3RoKHRleHR1cmVDb3VudCk7XG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbig1MDApOyAvLyBNb2lucyBkZSA1MDBtcyBwb3VyIDE2IHRleHR1cmVzXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdHZXN0aW9uIG3DqW1vaXJlJywgKCkgPT4ge1xuICAgIGl0KCdsaWLDqHJlIGNvcnJlY3RlbWVudCBsZXMgcmVzc291cmNlcyBXZWJHTCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc291cmNlcyA9IHtcbiAgICAgICAgYnVmZmVyczogW10sXG4gICAgICAgIHRleHR1cmVzOiBbXSxcbiAgICAgICAgcHJvZ3JhbXM6IFtdLFxuICAgICAgICBzaGFkZXJzOiBbXVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgLy8gQ3LDqWVyIGRlcyByZXNzb3VyY2VzXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgICAgY29uc3QgYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7XG4gICAgICAgIGNvbnN0IHRleHR1cmUgPSBnbC5jcmVhdGVUZXh0dXJlKCk7XG4gICAgICAgIGNvbnN0IHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7XG4gICAgICAgIGNvbnN0IHNoYWRlciA9IGdsLmNyZWF0ZVNoYWRlcihnbC5WRVJURVhfU0hBREVSKTtcbiAgICAgICAgXG4gICAgICAgIHJlc291cmNlcy5idWZmZXJzLnB1c2goYnVmZmVyKTtcbiAgICAgICAgcmVzb3VyY2VzLnRleHR1cmVzLnB1c2godGV4dHVyZSk7XG4gICAgICAgIHJlc291cmNlcy5wcm9ncmFtcy5wdXNoKHByb2dyYW0pO1xuICAgICAgICByZXNvdXJjZXMuc2hhZGVycy5wdXNoKHNoYWRlcik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIExpYsOpcmVyIGxlcyByZXNzb3VyY2VzXG4gICAgICBjb25zdCBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgXG4gICAgICByZXNvdXJjZXMuYnVmZmVycy5mb3JFYWNoKGJ1ZmZlciA9PiBnbC5kZWxldGVCdWZmZXIoYnVmZmVyKSk7XG4gICAgICByZXNvdXJjZXMudGV4dHVyZXMuZm9yRWFjaCh0ZXh0dXJlID0+IGdsLmRlbGV0ZVRleHR1cmUodGV4dHVyZSkpO1xuICAgICAgcmVzb3VyY2VzLnByb2dyYW1zLmZvckVhY2gocHJvZ3JhbSA9PiBnbC5kZWxldGVQcm9ncmFtKHByb2dyYW0pKTtcbiAgICAgIHJlc291cmNlcy5zaGFkZXJzLmZvckVhY2goc2hhZGVyID0+IGdsLmRlbGV0ZVNoYWRlcihzaGFkZXIpKTtcbiAgICAgIFxuICAgICAgY29uc3QgZHVyYXRpb24gPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0O1xuICAgICAgXG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbigxMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2TDqXRlY3RlIGxlcyBmdWl0ZXMgbcOpbW9pcmUgcG90ZW50aWVsbGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5pdGlhbE1lbW9yeSA9IHBlcmZvcm1hbmNlLm1lbW9yeSA/IHBlcmZvcm1hbmNlLm1lbW9yeS51c2VkSlNIZWFwU2l6ZSA6IDA7XG4gICAgICBcbiAgICAgIC8vIENyw6llciBiZWF1Y291cCBkZSByZXNzb3VyY2VzIHNhbnMgbGVzIGxpYsOpcmVyXG4gICAgICBjb25zdCBsZWFreVJlc291cmNlcyA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHtcbiAgICAgICAgbGVha3lSZXNvdXJjZXMucHVzaCh7XG4gICAgICAgICAgYnVmZmVyOiBnbC5jcmVhdGVCdWZmZXIoKSxcbiAgICAgICAgICB0ZXh0dXJlOiBnbC5jcmVhdGVUZXh0dXJlKCksXG4gICAgICAgICAgZGF0YTogbmV3IEZsb2F0MzJBcnJheSgxMDAwKSAvLyA0S0IgZWFjaFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgYWZ0ZXJDcmVhdGlvbiA9IHBlcmZvcm1hbmNlLm1lbW9yeSA/IHBlcmZvcm1hbmNlLm1lbW9yeS51c2VkSlNIZWFwU2l6ZSA6IDA7XG4gICAgICBcbiAgICAgIC8vIExpYsOpcmVyIGxlcyByZXNzb3VyY2VzXG4gICAgICBsZWFreVJlc291cmNlcy5mb3JFYWNoKHJlc291cmNlID0+IHtcbiAgICAgICAgZ2wuZGVsZXRlQnVmZmVyKHJlc291cmNlLmJ1ZmZlcik7XG4gICAgICAgIGdsLmRlbGV0ZVRleHR1cmUocmVzb3VyY2UudGV4dHVyZSk7XG4gICAgICB9KTtcbiAgICAgIGxlYWt5UmVzb3VyY2VzLmxlbmd0aCA9IDA7XG4gICAgICBcbiAgICAgIGNvbnN0IGFmdGVyQ2xlYW51cCA9IHBlcmZvcm1hbmNlLm1lbW9yeSA/IHBlcmZvcm1hbmNlLm1lbW9yeS51c2VkSlNIZWFwU2l6ZSA6IDA7XG4gICAgICBcbiAgICAgIGlmIChwZXJmb3JtYW5jZS5tZW1vcnkpIHtcbiAgICAgICAgY29uc3QgbWVtb3J5SW5jcmVhc2UgPSBhZnRlckNyZWF0aW9uIC0gaW5pdGlhbE1lbW9yeTtcbiAgICAgICAgY29uc3QgbWVtb3J5QWZ0ZXJDbGVhbnVwID0gYWZ0ZXJDbGVhbnVwIC0gaW5pdGlhbE1lbW9yeTtcbiAgICAgICAgXG4gICAgICAgIGV4cGVjdChtZW1vcnlJbmNyZWFzZSkudG9CZUdyZWF0ZXJUaGFuKDApOyAvLyBNZW1vcnkgc2hvdWxkIGluY3JlYXNlXG4gICAgICAgIGV4cGVjdChtZW1vcnlBZnRlckNsZWFudXApLnRvQmVMZXNzVGhhbihtZW1vcnlJbmNyZWFzZSAqIDAuNSk7IC8vIFNob3VsZCBjbGVhbiB1cCBtb3N0IG1lbW9yeVxuICAgICAgfVxuICAgICAgXG4gICAgICBleHBlY3QobGVha3lSZXNvdXJjZXMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BlcmZvcm1hbmNlIGVuIGNvbmRpdGlvbnMgc3RyZXNzYW50ZXMnLCAoKSA9PiB7XG4gICAgaXQoJ21haW50aWVudCBsZXMgcGVyZm9ybWFuY2VzIGF2ZWMgYmVhdWNvdXAgZGUgZHJhdyBjYWxscycsICgpID0+IHtcbiAgICAgIGNvbnN0IGRyYXdDYWxsQ291bnQgPSAxMDAwO1xuICAgICAgXG4gICAgICBjb25zdCBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgXG4gICAgICBnbC52aWV3cG9ydCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7XG4gICAgICBcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZHJhd0NhbGxDb3VudDsgaSsrKSB7XG4gICAgICAgIC8vIFNpbXVsZXIgZGVzIGNoYW5nZW1lbnRzIGQnw6l0YXQgY2/Du3RldXhcbiAgICAgICAgZ2wudXNlUHJvZ3JhbShnbC5jcmVhdGVQcm9ncmFtKCkpO1xuICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgZ2wuY3JlYXRlQnVmZmVyKCkpO1xuICAgICAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFUywgMCwgMyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydDtcbiAgICAgIFxuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oMTAwMCk7IC8vIE1vaW5zIGQnMSBzZWNvbmRlIHBvdXIgMTAwMCBkcmF3IGNhbGxzXG4gICAgfSk7XG5cbiAgICBpdCgnZ8OocmUgbGVzIGNoYW5nZW1lbnRzIGRlIHZpZXdwb3J0IGZyw6lxdWVudHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2aWV3cG9ydENoYW5nZXMgPSAxMDA7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmlld3BvcnRDaGFuZ2VzOyBpKyspIHtcbiAgICAgICAgY29uc3Qgd2lkdGggPSAxMDAgKyAoaSAqIDEwKTtcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gMTAwICsgKGkgKiAxMCk7XG4gICAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUKTtcbiAgICAgICAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRVMsIDAsIDMpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnQ7XG4gICAgICBcbiAgICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUxlc3NUaGFuKDUwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdWYWxpZGF0aW9uIGRlcyBwZXJmb3JtYW5jZXMgcGFyIGZvbmN0aW9ubmFsaXTDqScsICgpID0+IHtcbiAgICBpdCgnV2ViR0wgQmF0Y2ggb3BlcmF0aW9ucyBwZXJmb3JtYW5jZScsICgpID0+IHtcbiAgICAgIC8vIFNpbXVsZXIgdW4gc3lzdMOobWUgZGUgYmF0Y2ggY29tbWUgV2ViR0xCYXRjaGVyXG4gICAgICBjb25zdCBiYXRjaFNpemUgPSAxMDA7XG4gICAgICBjb25zdCBiYXRjaGVzID0gMTA7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIGZvciAobGV0IGJhdGNoID0gMDsgYmF0Y2ggPCBiYXRjaGVzOyBiYXRjaCsrKSB7XG4gICAgICAgIC8vIFByw6lwYXJlciB1biBiYXRjaFxuICAgICAgICBjb25zdCB2ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkoYmF0Y2hTaXplICogMyAqIDMpOyAvLyAxMDAgdHJpYW5nbGVzXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydGljZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICB2ZXJ0aWNlc1tpXSA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFVwbG9hZCBldCByZW5kdSBkdSBiYXRjaFxuICAgICAgICBjb25zdCBidWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcik7XG4gICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCB2ZXJ0aWNlcywgZ2wuU1RBVElDX0RSQVcpO1xuICAgICAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFUywgMCwgYmF0Y2hTaXplICogMyk7XG4gICAgICAgIFxuICAgICAgICBnbC5kZWxldGVCdWZmZXIoYnVmZmVyKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgZHVyYXRpb24gPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0O1xuICAgICAgXG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbigyMDApOyAvLyBCYXRjaGluZyBkb2l0IMOqdHJlIGVmZmljYWNlXG4gICAgfSk7XG5cbiAgICBpdCgnT3JnYW5pc20gcmVuZGVyaW5nIHBlcmZvcm1hbmNlJywgKCkgPT4ge1xuICAgICAgLy8gU2ltdWxlciBsZSByZW5kdSBkJ3VuIG9yZ2FuaXNtZSBjb21wbGV4ZVxuICAgICAgY29uc3Qgb3JnYW5pc21Db21wbGV4aXR5ID0gNTA7IC8vIE5vbWJyZSBkZSBjb21wb3NhbnRzXG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUIHwgZ2wuREVQVEhfQlVGRkVSX0JJVCk7XG4gICAgICBcbiAgICAgIGZvciAobGV0IGNvbXBvbmVudCA9IDA7IGNvbXBvbmVudCA8IG9yZ2FuaXNtQ29tcGxleGl0eTsgY29tcG9uZW50KyspIHtcbiAgICAgICAgLy8gU2ltdWxlciBsZSByZW5kdSBkJ3VuIGNvbXBvc2FudCBkJ29yZ2FuaXNtZVxuICAgICAgICBnbC51c2VQcm9ncmFtKGdsLmNyZWF0ZVByb2dyYW0oKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBNYXRyaWNlcyBkZSB0cmFuc2Zvcm1hdGlvblxuICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KGdsLmdldFVuaWZvcm1Mb2NhdGlvbihudWxsLCAndV9tYXRyaXgnKSwgZmFsc2UsIG5ldyBGbG9hdDMyQXJyYXkoMTYpKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENvdWxldXIgZHUgY29tcG9zYW50XG4gICAgICAgIGdsLnVuaWZvcm00ZihnbC5nZXRVbmlmb3JtTG9jYXRpb24obnVsbCwgJ3VfY29sb3InKSwgTWF0aC5yYW5kb20oKSwgTWF0aC5yYW5kb20oKSwgTWF0aC5yYW5kb20oKSwgMS4wKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEfDqW9tw6l0cmllIGR1IGNvbXBvc2FudFxuICAgICAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFUywgMCwgNik7IC8vIFF1YWQgPSAyIHRyaWFuZ2xlc1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnQ7XG4gICAgICBcbiAgICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUxlc3NUaGFuKDE2KTsgLy8gNjAgRlBTID0gMTYuNjdtcyBwYXIgZnJhbWVcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=