97613bf2fad6edc46c67d70a71ed1ba7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const OrganismFactory_1 = require("../src/core/factories/OrganismFactory");
const NeuralMesh_1 = require("../src/core/NeuralMesh");
// Mock NeuralMesh pour les tests
class MockNeuralMesh {
    constructor() {
        this.nodes = new Map();
        this.activations = new Map();
    }
    async initialize() {
        return Promise.resolve();
    }
    addNode(id, type, bias) {
        this.nodes.set(id, { id, type, bias: bias || 0 });
        this.activations.set(id, 0);
    }
    addConnection(fromId, toId, weight) {
        // Mock implementation
    }
    stimulate(nodeId, value) {
        this.activations.set(nodeId, value);
    }
    propagate() {
        // Mock propagation
    }
    getActivation(nodeId) {
        return this.activations.get(nodeId) || 0;
    }
    mutate(rate) {
        // Mock mutation
    }
    getNeuralActivity() {
        return 0.5;
    }
    getConnectionStrength() {
        return 0.3;
    }
    async getCPUUsage() {
        return 0.1;
    }
    async getMemoryUsage() {
        return 0.05;
    }
    toJSON() {
        return { nodes: Array.from(this.nodes.values()) };
    }
    async suspend() {
        return Promise.resolve();
    }
}
describe('OrganismFactory', () => {
    beforeEach(() => {
        // Reset factory state before each test
        OrganismFactory_1.OrganismFactory.setDependencies({
            createNeuralMesh: () => new MockNeuralMesh()
        });
    });
    describe('Dependency Management', () => {
        it('should set and use dependencies correctly', () => {
            const mockMeshFactory = jest.fn(() => new MockNeuralMesh());
            OrganismFactory_1.OrganismFactory.setDependencies({
                createNeuralMesh: mockMeshFactory
            });
            const organism = OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG');
            expect(mockMeshFactory).toHaveBeenCalled();
            expect(organism).toBeDefined();
        });
        it('should throw error when dependencies not set', () => {
            // Reset dependencies to null
            OrganismFactory_1.OrganismFactory.dependencies = null;
            expect(() => {
                OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG');
            }).toThrow('OrganismFactory dependencies not set');
        });
        it('should create different organisms with same dependencies', () => {
            const organism1 = OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG', {
                creativity: 0.3
            });
            const organism2 = OrganismFactory_1.OrganismFactory.createOrganism('GCTAGCTAGCTAGCTA', {
                creativity: 0.7
            });
            expect(organism1).toBeDefined();
            expect(organism2).toBeDefined();
            expect(organism1).not.toBe(organism2);
        });
    });
    describe('Organism Creation', () => {
        it('should create organism with valid DNA', () => {
            const organism = OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG');
            expect(organism).toBeDefined();
            expect(typeof organism.boot).toBe('function');
            expect(typeof organism.mutate).toBe('function');
            expect(typeof organism.getTraits).toBe('function');
        });
        it('should create organism with custom traits', () => {
            const customTraits = {
                creativity: 0.8,
                focus: 0.3,
                energy: 0.9
            };
            const organism = OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG', customTraits);
            expect(organism).toBeDefined();
        });
        it('should handle short DNA sequences', () => {
            const shortDNA = 'ATCGATCGAT';
            const organism = OrganismFactory_1.OrganismFactory.createOrganism(shortDNA);
            expect(organism).toBeDefined();
        });
        it('should handle long DNA sequences', () => {
            const longDNA = 'ATCGATCGATCGATCG'.repeat(10);
            const organism = OrganismFactory_1.OrganismFactory.createOrganism(longDNA);
            expect(organism).toBeDefined();
        });
        it('should validate DNA format during creation', () => {
            expect(() => {
                OrganismFactory_1.OrganismFactory.createOrganism(''); // Empty DNA
            }).toThrow();
            expect(() => {
                OrganismFactory_1.OrganismFactory.createOrganism('INVALID'); // Too short
            }).toThrow();
            expect(() => {
                OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG'); // Valid
            }).not.toThrow();
        });
    });
    describe('NeuralMesh Creation', () => {
        it('should create neural mesh directly', () => {
            const mesh = OrganismFactory_1.OrganismFactory.createNeuralMesh();
            expect(mesh).toBeDefined();
            expect(typeof mesh.initialize).toBe('function');
            expect(typeof mesh.addNode).toBe('function');
            expect(typeof mesh.propagate).toBe('function');
        });
        it('should create different mesh instances', () => {
            const mesh1 = OrganismFactory_1.OrganismFactory.createNeuralMesh();
            const mesh2 = OrganismFactory_1.OrganismFactory.createNeuralMesh();
            expect(mesh1).not.toBe(mesh2);
        });
    });
    describe('Error Handling', () => {
        it('should handle invalid trait values gracefully', () => {
            const invalidTraits = {
                creativity: -0.5, // Invalid negative value
                focus: 1.5, // Invalid > 1 value
                energy: 0.5 // Valid value
            };
            expect(() => {
                OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG', invalidTraits);
            }).toThrow();
        });
        it('should handle DNA with invalid characters', () => {
            const invalidDNA = 'ATCGATCGXYZGATCG'; // Contains invalid characters
            expect(() => {
                OrganismFactory_1.OrganismFactory.createOrganism(invalidDNA);
            }).toThrow();
        });
        it('should handle null/undefined parameters', () => {
            expect(() => {
                OrganismFactory_1.OrganismFactory.createOrganism(null);
            }).toThrow();
            expect(() => {
                OrganismFactory_1.OrganismFactory.createOrganism(undefined);
            }).toThrow();
        });
    });
    describe('Integration with Real Components', () => {
        it('should work with real NeuralMesh', () => {
            OrganismFactory_1.OrganismFactory.setDependencies({
                createNeuralMesh: () => new NeuralMesh_1.NeuralMesh()
            });
            const organism = OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG');
            expect(organism).toBeDefined();
        });
        it('should maintain mesh independence between organisms', async () => {
            const organism1 = OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG');
            const organism2 = OrganismFactory_1.OrganismFactory.createOrganism('GCTAGCTAGCTAGCTA');
            await organism1.boot();
            await organism2.boot();
            // Stimulate one organism
            organism1.stimulate('sensory_input', 0.8);
            // Should not affect the other
            const traits1 = organism1.getTraits();
            const traits2 = organism2.getTraits();
            // They might be the same initially, but should be independent instances
            expect(organism1).not.toBe(organism2);
            await organism1.hibernate();
            await organism2.hibernate();
        });
    });
    describe('Memory Management', () => {
        it('should not leak memory when creating multiple organisms', () => {
            const organisms = [];
            // Create multiple organisms
            for (let i = 0; i < 10; i++) {
                const dna = 'ATCGATCGATCGATCG'.repeat(i + 1);
                organisms.push(OrganismFactory_1.OrganismFactory.createOrganism(dna));
            }
            expect(organisms.length).toBe(10);
            // All should be different instances
            const uniqueOrganisms = new Set(organisms);
            expect(uniqueOrganisms.size).toBe(10);
        });
    });
    describe('Factory State Management', () => {
        it('should maintain dependencies across multiple calls', () => {
            const mockFactory = jest.fn(() => new MockNeuralMesh());
            OrganismFactory_1.OrganismFactory.setDependencies({
                createNeuralMesh: mockFactory
            });
            // Create multiple organisms
            OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG');
            OrganismFactory_1.OrganismFactory.createOrganism('GCTAGCTAGCTAGCTA');
            OrganismFactory_1.OrganismFactory.createOrganism('TTAAGGCCTTAAGGCC');
            expect(mockFactory).toHaveBeenCalledTimes(3);
        });
        it('should allow dependency updates', () => {
            const firstFactory = jest.fn(() => new MockNeuralMesh());
            const secondFactory = jest.fn(() => new MockNeuralMesh());
            // Set first dependencies
            OrganismFactory_1.OrganismFactory.setDependencies({
                createNeuralMesh: firstFactory
            });
            OrganismFactory_1.OrganismFactory.createOrganism('ATCGATCGATCGATCG');
            expect(firstFactory).toHaveBeenCalledTimes(1);
            // Update dependencies
            OrganismFactory_1.OrganismFactory.setDependencies({
                createNeuralMesh: secondFactory
            });
            OrganismFactory_1.OrganismFactory.createOrganism('GCTAGCTAGCTAGCTA');
            expect(secondFactory).toHaveBeenCalledTimes(1);
            expect(firstFactory).toHaveBeenCalledTimes(1); // Should not be called again
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZXMvU1lNQklPTlQvX190ZXN0c19fL09yZ2FuaXNtRmFjdG9yeS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsMkVBQXdFO0FBR3hFLHVEQUFvRDtBQUVwRCxpQ0FBaUM7QUFDakMsTUFBTSxjQUFjO0lBQXBCO1FBQ1UsVUFBSyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7UUFDbEIsZ0JBQVcsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBc0RsQyxDQUFDO0lBcERDLEtBQUssQ0FBQyxVQUFVO1FBQ2QsT0FBTyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVELE9BQU8sQ0FBQyxFQUFVLEVBQUUsSUFBbUMsRUFBRSxJQUFhO1FBQ3BFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQsYUFBYSxDQUFDLE1BQWMsRUFBRSxJQUFZLEVBQUUsTUFBYztRQUN4RCxzQkFBc0I7SUFDeEIsQ0FBQztJQUVELFNBQVMsQ0FBQyxNQUFjLEVBQUUsS0FBYTtRQUNyQyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELFNBQVM7UUFDUCxtQkFBbUI7SUFDckIsQ0FBQztJQUVELGFBQWEsQ0FBQyxNQUFjO1FBQzFCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxNQUFNLENBQUMsSUFBYTtRQUNsQixnQkFBZ0I7SUFDbEIsQ0FBQztJQUVELGlCQUFpQjtRQUNmLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztJQUVE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T05UL19fdGVzdHNfXy9PcmdhbmlzbUZhY3RvcnkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPcmdhbmlzbUZhY3RvcnkgfSBmcm9tICcuLi9zcmMvY29yZS9mYWN0b3JpZXMvT3JnYW5pc21GYWN0b3J5JztcclxuaW1wb3J0IHsgSU5ldXJhbE1lc2ggfSBmcm9tICcuLi9zcmMvY29yZS9pbnRlcmZhY2VzL0lOZXVyYWxNZXNoJztcclxuaW1wb3J0IHsgSU9yZ2FuaXNtQ29yZSB9IGZyb20gJy4uL3NyYy9jb3JlL2ludGVyZmFjZXMvSU9yZ2FuaXNtQ29yZSc7XHJcbmltcG9ydCB7IE5ldXJhbE1lc2ggfSBmcm9tICcuLi9zcmMvY29yZS9OZXVyYWxNZXNoJztcclxuXHJcbi8vIE1vY2sgTmV1cmFsTWVzaCBwb3VyIGxlcyB0ZXN0c1xyXG5jbGFzcyBNb2NrTmV1cmFsTWVzaCBpbXBsZW1lbnRzIElOZXVyYWxNZXNoIHtcclxuICBwcml2YXRlIG5vZGVzID0gbmV3IE1hcCgpO1xyXG4gIHByaXZhdGUgYWN0aXZhdGlvbnMgPSBuZXcgTWFwKCk7XHJcblxyXG4gIGFzeW5jIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgfVxyXG5cclxuICBhZGROb2RlKGlkOiBzdHJpbmcsIHR5cGU6ICdpbnB1dCcgfCAnaGlkZGVuJyB8ICdvdXRwdXQnLCBiaWFzPzogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLm5vZGVzLnNldChpZCwgeyBpZCwgdHlwZSwgYmlhczogYmlhcyB8fCAwIH0pO1xyXG4gICAgdGhpcy5hY3RpdmF0aW9ucy5zZXQoaWQsIDApO1xyXG4gIH1cclxuXHJcbiAgYWRkQ29ubmVjdGlvbihmcm9tSWQ6IHN0cmluZywgdG9JZDogc3RyaW5nLCB3ZWlnaHQ6IG51bWJlcik6IHZvaWQge1xyXG4gICAgLy8gTW9jayBpbXBsZW1lbnRhdGlvblxyXG4gIH1cclxuXHJcbiAgc3RpbXVsYXRlKG5vZGVJZDogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLmFjdGl2YXRpb25zLnNldChub2RlSWQsIHZhbHVlKTtcclxuICB9XHJcblxyXG4gIHByb3BhZ2F0ZSgpOiB2b2lkIHtcclxuICAgIC8vIE1vY2sgcHJvcGFnYXRpb25cclxuICB9XHJcblxyXG4gIGdldEFjdGl2YXRpb24obm9kZUlkOiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuYWN0aXZhdGlvbnMuZ2V0KG5vZGVJZCkgfHwgMDtcclxuICB9XHJcblxyXG4gIG11dGF0ZShyYXRlPzogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAvLyBNb2NrIG11dGF0aW9uXHJcbiAgfVxyXG5cclxuICBnZXROZXVyYWxBY3Rpdml0eSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIDAuNTtcclxuICB9XHJcblxyXG4gIGdldENvbm5lY3Rpb25TdHJlbmd0aCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIDAuMztcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldENQVVVzYWdlKCk6IFByb21pc2U8bnVtYmVyPiB7XHJcbiAgICByZXR1cm4gMC4xO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0TWVtb3J5VXNhZ2UoKTogUHJvbWlzZTxudW1iZXI+IHtcclxuICAgIHJldHVybiAwLjA1O1xyXG4gIH1cclxuXHJcbiAgdG9KU09OKCk6IGFueSB7XHJcbiAgICByZXR1cm4geyBub2RlczogQXJyYXkuZnJvbSh0aGlzLm5vZGVzLnZhbHVlcygpKSB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgc3VzcGVuZCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICB9XHJcbn1cclxuXHJcbmRlc2NyaWJlKCdPcmdhbmlzbUZhY3RvcnknLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAvLyBSZXNldCBmYWN0b3J5IHN0YXRlIGJlZm9yZSBlYWNoIHRlc3RcclxuICAgIE9yZ2FuaXNtRmFjdG9yeS5zZXREZXBlbmRlbmNpZXMoe1xyXG4gICAgICBjcmVhdGVOZXVyYWxNZXNoOiAoKSA9PiBuZXcgTW9ja05ldXJhbE1lc2goKVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdEZXBlbmRlbmN5IE1hbmFnZW1lbnQnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHNldCBhbmQgdXNlIGRlcGVuZGVuY2llcyBjb3JyZWN0bHknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tNZXNoRmFjdG9yeSA9IGplc3QuZm4oKCkgPT4gbmV3IE1vY2tOZXVyYWxNZXNoKCkpO1xyXG4gICAgICBcclxuICAgICAgT3JnYW5pc21GYWN0b3J5LnNldERlcGVuZGVuY2llcyh7XHJcbiAgICAgICAgY3JlYXRlTmV1cmFsTWVzaDogbW9ja01lc2hGYWN0b3J5XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3Qgb3JnYW5pc20gPSBPcmdhbmlzbUZhY3RvcnkuY3JlYXRlT3JnYW5pc20oJ0FUQ0dBVENHQVRDR0FUQ0cnKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChtb2NrTWVzaEZhY3RvcnkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgZXhwZWN0KG9yZ2FuaXNtKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIGRlcGVuZGVuY2llcyBub3Qgc2V0JywgKCkgPT4ge1xyXG4gICAgICAvLyBSZXNldCBkZXBlbmRlbmNpZXMgdG8gbnVsbFxyXG4gICAgICAoT3JnYW5pc21GYWN0b3J5IGFzIGFueSkuZGVwZW5kZW5jaWVzID0gbnVsbDtcclxuXHJcbiAgICAgIGV4cGVjdCgoKSA9PiB7XHJcbiAgICAgICAgT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU9yZ2FuaXNtKCdBVENHQVRDR0FUQ0dBVENHJyk7XHJcbiAgICAgIH0pLnRvVGhyb3coJ09yZ2FuaXNtRmFjdG9yeSBkZXBlbmRlbmNpZXMgbm90IHNldCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgZGlmZmVyZW50IG9yZ2FuaXNtcyB3aXRoIHNhbWUgZGVwZW5kZW5jaWVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBvcmdhbmlzbTEgPSBPcmdhbmlzbUZhY3RvcnkuY3JlYXRlT3JnYW5pc20oJ0FUQ0dBVENHQVRDR0FUQ0cnLCB7XHJcbiAgICAgICAgY3JlYXRpdml0eTogMC4zXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgY29uc3Qgb3JnYW5pc20yID0gT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU9yZ2FuaXNtKCdHQ1RBR0NUQUdDVEFHQ1RBJywge1xyXG4gICAgICAgIGNyZWF0aXZpdHk6IDAuN1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChvcmdhbmlzbTEpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChvcmdhbmlzbTIpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChvcmdhbmlzbTEpLm5vdC50b0JlKG9yZ2FuaXNtMik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ09yZ2FuaXNtIENyZWF0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgb3JnYW5pc20gd2l0aCB2YWxpZCBETkEnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG9yZ2FuaXNtID0gT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU9yZ2FuaXNtKCdBVENHQVRDR0FUQ0dBVENHJyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3Qob3JnYW5pc20pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2Ygb3JnYW5pc20uYm9vdCkudG9CZSgnZnVuY3Rpb24nKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiBvcmdhbmlzbS5tdXRhdGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2Ygb3JnYW5pc20uZ2V0VHJhaXRzKS50b0JlKCdmdW5jdGlvbicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgb3JnYW5pc20gd2l0aCBjdXN0b20gdHJhaXRzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjdXN0b21UcmFpdHMgPSB7XHJcbiAgICAgICAgY3JlYXRpdml0eTogMC44LFxyXG4gICAgICAgIGZvY3VzOiAwLjMsXHJcbiAgICAgICAgZW5lcmd5OiAwLjlcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IG9yZ2FuaXNtID0gT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU9yZ2FuaXNtKCdBVENHQVRDR0FUQ0dBVENHJywgY3VzdG9tVHJhaXRzKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChvcmdhbmlzbSkudG9CZURlZmluZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNob3J0IEROQSBzZXF1ZW5jZXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNob3J0RE5BID0gJ0FUQ0dBVENHQVQnO1xyXG4gICAgICBcclxuICAgICAgY29uc3Qgb3JnYW5pc20gPSBPcmdhbmlzbUZhY3RvcnkuY3JlYXRlT3JnYW5pc20oc2hvcnRETkEpO1xyXG4gICAgICBleHBlY3Qob3JnYW5pc20pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBsb25nIEROQSBzZXF1ZW5jZXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxvbmdETkEgPSAnQVRDR0FUQ0dBVENHQVRDRycucmVwZWF0KDEwKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IG9yZ2FuaXNtID0gT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU9yZ2FuaXNtKGxvbmdETkEpO1xyXG4gICAgICBleHBlY3Qob3JnYW5pc20pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIEROQSBmb3JtYXQgZHVyaW5nIGNyZWF0aW9uJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoKCkgPT4ge1xyXG4gICAgICAgIE9yZ2FuaXNtRmFjdG9yeS5jcmVhdGVPcmdhbmlzbSgnJyk7IC8vIEVtcHR5IEROQVxyXG4gICAgICB9KS50b1Rocm93KCk7XHJcblxyXG4gICAgICBleHBlY3QoKCkgPT4ge1xyXG4gICAgICAgIE9yZ2FuaXNtRmFjdG9yeS5jcmVhdGVPcmdhbmlzbSgnSU5WQUxJRCcpOyAvLyBUb28gc2hvcnRcclxuICAgICAgfSkudG9UaHJvdygpO1xyXG5cclxuICAgICAgZXhwZWN0KCgpID0+IHtcclxuICAgICAgICBPcmdhbmlzbUZhY3RvcnkuY3JlYXRlT3JnYW5pc20oJ0FUQ0dBVENHQVRDR0FUQ0cnKTsgLy8gVmFsaWRcclxuICAgICAgfSkubm90LnRvVGhyb3coKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnTmV1cmFsTWVzaCBDcmVhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIG5ldXJhbCBtZXNoIGRpcmVjdGx5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtZXNoID0gT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU5ldXJhbE1lc2goKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChtZXNoKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QodHlwZW9mIG1lc2guaW5pdGlhbGl6ZSkudG9CZSgnZnVuY3Rpb24nKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiBtZXNoLmFkZE5vZGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XHJcbiAgICAgIGV4cGVjdCh0eXBlb2YgbWVzaC5wcm9wYWdhdGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBkaWZmZXJlbnQgbWVzaCBpbnN0YW5jZXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1lc2gxID0gT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU5ldXJhbE1lc2goKTtcclxuICAgICAgY29uc3QgbWVzaDIgPSBPcmdhbmlzbUZhY3RvcnkuY3JlYXRlTmV1cmFsTWVzaCgpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KG1lc2gxKS5ub3QudG9CZShtZXNoMik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCB0cmFpdCB2YWx1ZXMgZ3JhY2VmdWxseScsICgpID0+IHtcclxuICAgICAgY29uc3QgaW52YWxpZFRyYWl0cyA9IHtcclxuICAgICAgICBjcmVhdGl2aXR5OiAtMC41LCAvLyBJbnZhbGlkIG5lZ2F0aXZlIHZhbHVlXHJcbiAgICAgICAgZm9jdXM6IDEuNSwgICAgICAgLy8gSW52YWxpZCA+IDEgdmFsdWVcclxuICAgICAgICBlbmVyZ3k6IDAuNSAgICAgICAvLyBWYWxpZCB2YWx1ZVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgZXhwZWN0KCgpID0+IHtcclxuICAgICAgICBPcmdhbmlzbUZhY3RvcnkuY3JlYXRlT3JnYW5pc20oJ0FUQ0dBVENHQVRDR0FUQ0cnLCBpbnZhbGlkVHJhaXRzKTtcclxuICAgICAgfSkudG9UaHJvdygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgRE5BIHdpdGggaW52YWxpZCBjaGFyYWN0ZXJzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBpbnZhbGlkRE5BID0gJ0FUQ0dBVENHWFlaR0FUQ0cnOyAvLyBDb250YWlucyBpbnZhbGlkIGNoYXJhY3RlcnNcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdCgoKSA9PiB7XHJcbiAgICAgICAgT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU9yZ2FuaXNtKGludmFsaWRETkEpO1xyXG4gICAgICB9KS50b1Rocm93KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBudWxsL3VuZGVmaW5lZCBwYXJhbWV0ZXJzJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoKCkgPT4ge1xyXG4gICAgICAgIE9yZ2FuaXNtRmFjdG9yeS5jcmVhdGVPcmdhbmlzbShudWxsIGFzIGFueSk7XHJcbiAgICAgIH0pLnRvVGhyb3coKTtcclxuXHJcbiAgICAgIGV4cGVjdCgoKSA9PiB7XHJcbiAgICAgICAgT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU9yZ2FuaXNtKHVuZGVmaW5lZCBhcyBhbnkpO1xyXG4gICAgICB9KS50b1Rocm93KCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0ludGVncmF0aW9uIHdpdGggUmVhbCBDb21wb25lbnRzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggcmVhbCBOZXVyYWxNZXNoJywgKCkgPT4ge1xyXG4gICAgICBPcmdhbmlzbUZhY3Rvcnkuc2V0RGVwZW5kZW5jaWVzKHtcclxuICAgICAgICBjcmVhdGVOZXVyYWxNZXNoOiAoKSA9PiBuZXcgTmV1cmFsTWVzaCgpXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3Qgb3JnYW5pc20gPSBPcmdhbmlzbUZhY3RvcnkuY3JlYXRlT3JnYW5pc20oJ0FUQ0dBVENHQVRDR0FUQ0cnKTtcclxuICAgICAgZXhwZWN0KG9yZ2FuaXNtKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBtZXNoIGluZGVwZW5kZW5jZSBiZXR3ZWVuIG9yZ2FuaXNtcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgb3JnYW5pc20xID0gT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU9yZ2FuaXNtKCdBVENHQVRDR0FUQ0dBVENHJyk7XHJcbiAgICAgIGNvbnN0IG9yZ2FuaXNtMiA9IE9yZ2FuaXNtRmFjdG9yeS5jcmVhdGVPcmdhbmlzbSgnR0NUQUdDVEFHQ1RBR0NUQScpO1xyXG5cclxuICAgICAgYXdhaXQgb3JnYW5pc20xLmJvb3QoKTtcclxuICAgICAgYXdhaXQgb3JnYW5pc20yLmJvb3QoKTtcclxuXHJcbiAgICAgIC8vIFN0aW11bGF0ZSBvbmUgb3JnYW5pc21cclxuICAgICAgb3JnYW5pc20xLnN0aW11bGF0ZSgnc2Vuc29yeV9pbnB1dCcsIDAuOCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBTaG91bGQgbm90IGFmZmVjdCB0aGUgb3RoZXJcclxuICAgICAgY29uc3QgdHJhaXRzMSA9IG9yZ2FuaXNtMS5nZXRUcmFpdHMoKTtcclxuICAgICAgY29uc3QgdHJhaXRzMiA9IG9yZ2FuaXNtMi5nZXRUcmFpdHMoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFRoZXkgbWlnaHQgYmUgdGhlIHNhbWUgaW5pdGlhbGx5LCBidXQgc2hvdWxkIGJlIGluZGVwZW5kZW50IGluc3RhbmNlc1xyXG4gICAgICBleHBlY3Qob3JnYW5pc20xKS5ub3QudG9CZShvcmdhbmlzbTIpO1xyXG5cclxuICAgICAgYXdhaXQgb3JnYW5pc20xLmhpYmVybmF0ZSgpO1xyXG4gICAgICBhd2FpdCBvcmdhbmlzbTIuaGliZXJuYXRlKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ01lbW9yeSBNYW5hZ2VtZW50JywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBub3QgbGVhayBtZW1vcnkgd2hlbiBjcmVhdGluZyBtdWx0aXBsZSBvcmdhbmlzbXMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG9yZ2FuaXNtczogSU9yZ2FuaXNtQ29yZVtdID0gW107XHJcbiAgICAgIFxyXG4gICAgICAvLyBDcmVhdGUgbXVsdGlwbGUgb3JnYW5pc21zXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IGRuYSA9ICdBVENHQVRDR0FUQ0dBVENHJy5yZXBlYXQoaSArIDEpO1xyXG4gICAgICAgIG9yZ2FuaXNtcy5wdXNoKE9yZ2FuaXNtRmFjdG9yeS5jcmVhdGVPcmdhbmlzbShkbmEpKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZXhwZWN0KG9yZ2FuaXNtcy5sZW5ndGgpLnRvQmUoMTApO1xyXG4gICAgICBcclxuICAgICAgLy8gQWxsIHNob3VsZCBiZSBkaWZmZXJlbnQgaW5zdGFuY2VzXHJcbiAgICAgIGNvbnN0IHVuaXF1ZU9yZ2FuaXNtcyA9IG5ldyBTZXQob3JnYW5pc21zKTtcclxuICAgICAgZXhwZWN0KHVuaXF1ZU9yZ2FuaXNtcy5zaXplKS50b0JlKDEwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnRmFjdG9yeSBTdGF0ZSBNYW5hZ2VtZW50JywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBkZXBlbmRlbmNpZXMgYWNyb3NzIG11bHRpcGxlIGNhbGxzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrRmFjdG9yeSA9IGplc3QuZm4oKCkgPT4gbmV3IE1vY2tOZXVyYWxNZXNoKCkpO1xyXG4gICAgICBcclxuICAgICAgT3JnYW5pc21GYWN0b3J5LnNldERlcGVuZGVuY2llcyh7XHJcbiAgICAgICAgY3JlYXRlTmV1cmFsTWVzaDogbW9ja0ZhY3RvcnlcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBDcmVhdGUgbXVsdGlwbGUgb3JnYW5pc21zXHJcbiAgICAgIE9yZ2FuaXNtRmFjdG9yeS5jcmVhdGVPcmdhbmlzbSgnQVRDR0FUQ0dBVENHQVRDRycpO1xyXG4gICAgICBPcmdhbmlzbUZhY3RvcnkuY3JlYXRlT3JnYW5pc20oJ0dDVEFHQ1RBR0NUQUdDVEEnKTtcclxuICAgICAgT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU9yZ2FuaXNtKCdUVEFBR0dDQ1RUQUFHR0NDJyk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja0ZhY3RvcnkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygzKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgYWxsb3cgZGVwZW5kZW5jeSB1cGRhdGVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBmaXJzdEZhY3RvcnkgPSBqZXN0LmZuKCgpID0+IG5ldyBNb2NrTmV1cmFsTWVzaCgpKTtcclxuICAgICAgY29uc3Qgc2Vjb25kRmFjdG9yeSA9IGplc3QuZm4oKCkgPT4gbmV3IE1vY2tOZXVyYWxNZXNoKCkpO1xyXG5cclxuICAgICAgLy8gU2V0IGZpcnN0IGRlcGVuZGVuY2llc1xyXG4gICAgICBPcmdhbmlzbUZhY3Rvcnkuc2V0RGVwZW5kZW5jaWVzKHtcclxuICAgICAgICBjcmVhdGVOZXVyYWxNZXNoOiBmaXJzdEZhY3RvcnlcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBPcmdhbmlzbUZhY3RvcnkuY3JlYXRlT3JnYW5pc20oJ0FUQ0dBVENHQVRDR0FUQ0cnKTtcclxuICAgICAgZXhwZWN0KGZpcnN0RmFjdG9yeSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xyXG5cclxuICAgICAgLy8gVXBkYXRlIGRlcGVuZGVuY2llc1xyXG4gICAgICBPcmdhbmlzbUZhY3Rvcnkuc2V0RGVwZW5kZW5jaWVzKHtcclxuICAgICAgICBjcmVhdGVOZXVyYWxNZXNoOiBzZWNvbmRGYWN0b3J5XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgT3JnYW5pc21GYWN0b3J5LmNyZWF0ZU9yZ2FuaXNtKCdHQ1RBR0NUQUdDVEFHQ1RBJyk7XHJcbiAgICAgIGV4cGVjdChzZWNvbmRGYWN0b3J5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XHJcbiAgICAgIGV4cGVjdChmaXJzdEZhY3RvcnkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTsgLy8gU2hvdWxkIG5vdCBiZSBjYWxsZWQgYWdhaW5cclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsgIl0sInZlcnNpb24iOjN9